# IEClub 项目结构详解

## 📁 完整目录结构

```
IEclub_dev/
├── ieclub-taro/                    # 前端项目（Taro跨平台）
│   ├── config/                     # 构建配置
│   │   ├── index.js                # 主配置文件（Webpack、代理、路径）
│   │   ├── dev.js                  # 开发环境配置
│   │   └── prod.js                 # 生产环境配置
│   │
│   ├── public/                     # 公共资源
│   │   ├── index.html              # H5入口HTML（必须包含Iconify CDN）
│   │   └── favicon.ico             # 网站图标
│   │
│   ├── src/                        # 源代码目录
│   │   ├── app.tsx                 # 应用入口（根组件）
│   │   ├── app.config.ts           # 应用配置（页面路由、TabBar）
│   │   ├── app.scss                # 全局样式
│   │   │
│   │   ├── config/                 # 配置文件
│   │   │   ├── index.ts            # 统一配置导出
│   │   │   ├── icons.ts            # 图标配置（Iconify映射表）
│   │   │   └── constants.ts        # 常量定义
│   │   │
│   │   ├── pages/                  # 页面目录
│   │   │   ├── square/             # 📱 话题广场（首页）
│   │   │   │   ├── index.tsx       # 页面逻辑
│   │   │   │   ├── index.scss      # 页面样式
│   │   │   │   └── index.config.ts # 页面配置
│   │   │   │
│   │   │   ├── community/          # 👥 社区
│   │   │   │   ├── index.tsx       # 社区首页（用户列表）
│   │   │   │   ├── index.scss
│   │   │   │   ├── index.config.ts
│   │   │   │   ├── ranking/        # 排行榜
│   │   │   │   │   ├── index.tsx
│   │   │   │   │   ├── index.scss
│   │   │   │   │   └── index.config.ts
│   │   │   │   └── matching/       # 智能匹配
│   │   │   │       ├── index.tsx
│   │   │   │       ├── index.scss
│   │   │   │       └── index.config.ts
│   │   │   │
│   │   │   ├── publish/            # ➕ 发布中心
│   │   │   │   ├── index.tsx       # 发布类型选择
│   │   │   │   ├── index.scss
│   │   │   │   └── index.config.ts
│   │   │   │
│   │   │   ├── activities/         # 🎉 活动
│   │   │   │   ├── index.tsx       # 活动列表
│   │   │   │   ├── index.scss
│   │   │   │   ├── index.config.ts
│   │   │   │   ├── detail/         # 活动详情
│   │   │   │   │   ├── index.tsx
│   │   │   │   │   ├── index.scss
│   │   │   │   │   └── index.config.ts
│   │   │   │   └── create/         # 创建活动
│   │   │   │       ├── index.tsx
│   │   │   │       ├── index.scss
│   │   │   │       └── index.config.ts
│   │   │   │
│   │   │   ├── profile/            # 👤 个人中心
│   │   │   │   ├── index.tsx       # 个人主页
│   │   │   │   ├── index.scss
│   │   │   │   ├── index.config.ts
│   │   │   │   ├── user/           # 查看他人主页
│   │   │   │   │   ├── index.tsx
│   │   │   │   │   ├── index.scss
│   │   │   │   │   └── index.config.ts
│   │   │   │   ├── edit/           # 编辑资料
│   │   │   │   │   ├── index.tsx
│   │   │   │   │   ├── index.scss
│   │   │   │   │   └── index.config.ts
│   │   │   │   └── settings/       # 设置
│   │   │   │       ├── index.tsx
│   │   │   │       ├── index.scss
│   │   │   │       └── index.config.ts
│   │   │   │
│   │   │   ├── topics/             # 💬 话题
│   │   │   │   ├── detail/         # 话题详情
│   │   │   │   │   ├── index.tsx
│   │   │   │   │   ├── index.scss
│   │   │   │   │   └── index.config.ts
│   │   │   │   └── create/         # 创建话题
│   │   │   │       ├── index.tsx
│   │   │   │       ├── index.scss
│   │   │   │       └── index.config.ts
│   │   │   │
│   │   │   ├── search/             # 🔍 搜索
│   │   │   │   ├── index.tsx
│   │   │   │   ├── index.scss
│   │   │   │   └── index.config.ts
│   │   │   │
│   │   │   ├── notifications/      # 🔔 通知
│   │   │   │   ├── index.tsx
│   │   │   │   ├── index.scss
│   │   │   │   └── index.config.ts
│   │   │   │
│   │   │   └── login/              # 🔐 登录
│   │   │       ├── index.tsx
│   │   │       ├── index.scss
│   │   │       └── index.config.ts
│   │   │
│   │   ├── components/             # 公共组件
│   │   │   ├── Icon/               # 图标组件（封装Iconify）
│   │   │   │   ├── index.tsx
│   │   │   │   └── index.scss
│   │   │   │
│   │   │   ├── TopicCard/          # 话题卡片
│   │   │   │   ├── index.tsx
│   │   │   │   └── index.scss
│   │   │   │
│   │   │   ├── UserCard/           # 用户卡片
│   │   │   │   ├── index.tsx
│   │   │   │   └── index.scss
│   │   │   │
│   │   │   ├── ActivityCard/       # 活动卡片
│   │   │   │   ├── index.tsx
│   │   │   │   └── index.scss
│   │   │   │
│   │   │   ├── CommentList/        # 评论列表
│   │   │   │   ├── index.tsx
│   │   │   │   └── index.scss
│   │   │   │
│   │   │   ├── SearchBar/          # 搜索栏
│   │   │   │   ├── index.tsx
│   │   │   │   └── index.scss
│   │   │   │
│   │   │   ├── TabBar/             # 标签栏
│   │   │   │   ├── index.tsx
│   │   │   │   └── index.scss
│   │   │   │
│   │   │   ├── Empty/              # 空状态
│   │   │   │   ├── index.tsx
│   │   │   │   └── index.scss
│   │   │   │
│   │   │   └── Loading/            # 加载状态
│   │   │       ├── index.tsx
│   │   │       └── index.scss
│   │   │
│   │   ├── services/               # API服务层
│   │   │   ├── request.ts          # HTTP请求封装
│   │   │   ├── auth.ts             # 认证服务
│   │   │   ├── topic.ts            # 话题服务
│   │   │   ├── user.ts             # 用户服务
│   │   │   ├── comment.ts          # 评论服务
│   │   │   ├── activity.ts         # 活动服务
│   │   │   ├── search.ts           # 搜索服务
│   │   │   └── upload.ts           # 上传服务
│   │   │
│   │   ├── store/                  # Zustand状态管理
│   │   │   ├── user.ts             # 用户状态
│   │   │   ├── topic.ts            # 话题状态
│   │   │   ├── app.ts              # 应用状态
│   │   │   └── index.ts            # 状态导出
│   │   │
│   │   ├── hooks/                  # 自定义Hooks
│   │   │   ├── useRequest.ts       # 请求Hook
│   │   │   ├── usePagination.ts    # 分页Hook
│   │   │   └── useDebounce.ts      # 防抖Hook
│   │   │
│   │   ├── utils/                  # 工具函数
│   │   │   ├── api-config.ts       # API配置
│   │   │   ├── format.ts           # 格式化工具
│   │   │   ├── validate.ts         # 验证工具
│   │   │   └── storage.ts          # 本地存储
│   │   │
│   │   ├── types/                  # TypeScript类型
│   │   │   ├── index.ts            # 通用类型
│   │   │   ├── user.ts             # 用户类型
│   │   │   ├── topic.ts            # 话题类型
│   │   │   └── activity.ts         # 活动类型
│   │   │
│   │   ├── styles/                 # 全局样式
│   │   │   ├── variables.scss      # SCSS变量
│   │   │   ├── mixins.scss         # SCSS Mixins
│   │   │   └── common.scss         # 公共样式
│   │   │
│   │   └── custom-tab-bar/         # 自定义TabBar
│   │       ├── index.tsx
│   │       ├── index.scss
│   │       └── index.config.ts
│   │
│   ├── dist/                       # 构建输出目录
│   │   ├── h5/                     # H5构建产物
│   │   └── weapp/                  # 小程序构建产物
│   │
│   ├── package.json                # 依赖配置
│   ├── tsconfig.json               # TypeScript配置
│   ├── project.config.json         # 小程序配置
│   └── README.md                   # 项目文档
│
├── ieclub-backend/                 # 后端项目（Node.js + Express）
│   ├── src/
│   │   ├── server.js               # 服务器入口
│   │   ├── app.js                  # Express应用配置
│   │   │
│   │   ├── config/                 # 配置
│   │   │   ├── index.js            # 统一配置
│   │   │   └── constants.js        # 常量
│   │   │
│   │   ├── controllers/            # 控制器
│   │   │   ├── authController.js
│   │   │   ├── topicController.js
│   │   │   ├── userController.js
│   │   │   ├── commentController.js
│   │   │   └── activityController.js
│   │   │
│   │   ├── routes/                 # 路由
│   │   │   ├── index.js
│   │   │   ├── auth.js
│   │   │   ├── topics.js
│   │   │   ├── users.js
│   │   │   └── activities.js
│   │   │
│   │   ├── services/               # 业务逻辑
│   │   │   ├── algorithmService.js
│   │   │   ├── websocketService.js
│   │   │   └── uploadService.js
│   │   │
│   │   ├── middleware/             # 中间件
│   │   │   ├── auth.js
│   │   │   ├── errorHandler.js
│   │   │   └── validation.js
│   │   │
│   │   └── utils/                  # 工具
│   │       ├── logger.js
│   │       ├── redis.js
│   │       └── response.js
│   │
│   ├── prisma/
│   │   └── schema.prisma           # 数据库模型
│   │
│   ├── uploads/                    # 上传文件
│   ├── logs/                       # 日志文件
│   ├── package.json
│   ├── .env                        # 环境变量
│   └── README.md
│
├── scripts/                        # 部署脚本
│   ├── deploy-local.ps1            # 本地打包上传
│   └── deploy-server.sh            # 服务器部署
│
└── README.md                       # 项目总文档
```

---

## 🔑 关键文件说明

### 前端核心文件

| 文件 | 作用 | 重要性 |
|------|------|--------|
| `public/index.html` | H5入口，**必须包含Iconify CDN** | ⭐⭐⭐⭐⭐ |
| `src/app.tsx` | 应用根组件，初始化逻辑 | ⭐⭐⭐⭐⭐ |
| `src/app.config.ts` | 页面路由配置、TabBar配置 | ⭐⭐⭐⭐⭐ |
| `config/index.js` | Webpack配置、代理配置 | ⭐⭐⭐⭐⭐ |
| `src/config/icons.ts` | 图标映射表（Iconify） | ⭐⭐⭐⭐ |
| `src/utils/api-config.ts` | API地址配置 | ⭐⭐⭐⭐ |
| `src/services/request.ts` | HTTP请求封装 | ⭐⭐⭐⭐ |
| `src/custom-tab-bar/` | 自定义底部导航 | ⭐⭐⭐ |

### 后端核心文件

| 文件 | 作用 | 重要性 |
|------|------|--------|
| `src/app.js` | Express配置、**CORS配置** | ⭐⭐⭐⭐⭐ |
| `prisma/schema.prisma` | 数据库模型定义 | ⭐⭐⭐⭐⭐ |
| `.env` | 环境变量（数据库、JWT等） | ⭐⭐⭐⭐⭐ |
| `src/routes/index.js` | API路由聚合 | ⭐⭐⭐⭐ |
| `src/middleware/auth.js` | JWT认证中间件 | ⭐⭐⭐⭐ |

---

## 🎯 页面路由映射

| 路径 | 页面 | TabBar | 说明 |
|------|------|--------|------|
| `/pages/square/index` | 话题广场 | ✅ Tab1 | 首页，展示推荐话题 |
| `/pages/community/index` | 社区 | ✅ Tab2 | 用户列表、排行榜 |
| `/pages/publish/index` | 发布 | ✅ Tab3 | 发布类型选择（特殊样式）|
| `/pages/activities/index` | 活动 | ✅ Tab4 | 活动列表 |
| `/pages/profile/index` | 我的 | ✅ Tab5 | 个人主页 |
| `/pages/search/index` | 搜索 | ❌ | 全局搜索 |
| `/pages/notifications/index` | 通知 | ❌ | 通知中心 |
| `/pages/topics/detail/index` | 话题详情 | ❌ | 查看话题 |
| `/pages/topics/create/index` | 创建话题 | ❌ | 发布话题 |
| `/pages/activities/detail/index` | 活动详情 | ❌ | 查看活动 |
| `/pages/profile/user/index` | 他人主页 | ❌ | 查看他人资料 |
| `/pages/profile/edit/index` | 编辑资料 | ❌ | 编辑个人信息 |
| `/pages/login/index` | 登录 | ❌ | 登录/注册 |

---

## 🔄 数据流向图

```
┌─────────────┐
│   前端H5    │
│ (Taro React)│
└──────┬──────┘
       │
       │ HTTP请求
       │ (fetch/Taro.request)
       ↓
┌─────────────┐
│   Nginx     │
│  (端口80)    │
└──────┬──────┘
       │
       │ 反向代理
       │ /api → http://localhost:3000
       ↓
┌─────────────┐
│  后端API    │
│ (Express.js)│
│  (端口3000)  │
└──────┬──────┘
       │
       ├─→ MySQL (数据存储)
       ├─→ Redis (缓存/会话)
       └─→ WebSocket (实时通知)
```

---

## 🚨 常见问题排查

### 问题1: H5页面空白

**可能原因**：
1. ❌ `public/index.html` 缺少Iconify CDN
2. ❌ `app.config.ts` 路由配置错误
3. ❌ `config/index.js` 构建配置有误
4. ❌ 组件渲染错误（console有报错）

**排查步骤**：
```bash
# 1. 检查浏览器Console
F12 → Console → 查看报错信息

# 2. 检查Network
F12 → Network → 查看请求是否正常

# 3. 检查dist目录
ls -la ieclub-taro/dist/
# 应该有index.html、js/、css/

# 4. 测试基础HTML
# 访问 http://localhost:10086/test.html
```

### 问题2: 图标不显示

**原因**：Iconify CDN未加载

**解决方案**：
```html
<!-- public/index.html 中必须有 -->
<script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>

<!-- 如果CDN被墙，使用国内镜像 -->
<script src="https://cdn.jsdelivr.net/npm/@iconify/iconify@3.1.0/dist/iconify.min.js"></script>
```

### 问题3: API请求失败

**排查步骤**：
```bash
# 1. 检查后端是否运行
curl http://localhost:3000/health

# 2. 检查代理配置
# config/index.js 中的 devServer.proxy

# 3. 检查CORS配置
# ieclub-backend/src/app.js 中的 cors()
```

---

## ✅ 启动检查清单

### 启动前必查

- [ ] Node.js >= 18.0.0
- [ ] MySQL 已启动并创建数据库
- [ ] Redis 已启动
- [ ] `.env` 文件已配置
- [ ] `npm install` 已执行

### 后端启动验证

```bash
cd ieclub-backend
npm run dev

# 验证
curl http://localhost:3000/health
# 应返回: {"success":true,"message":"IEClub API is running"}
```

### 前端启动验证

```bash
cd ieclub-taro
npm run dev:h5

# 验证
# 1. 浏览器自动打开 http://localhost:10086
# 2. Console 无报错
# 3. 能看到页面内容
```

---

## 📝 代码规范

### 文件命名

- 页面: `index.tsx`, `index.scss`, `index.config.ts`
- 组件: `ComponentName/index.tsx`
- 工具: `utilName.ts`
- 类型: `TypeName.ts`

### 导入顺序

```typescript
// 1. React相关
import { useState, useEffect } from 'react'
import { View, Text } from '@tarojs/components'
import Taro from '@tarojs/taro'

// 2. 第三方库
import dayjs from 'dayjs'

// 3. 本地模块
import { IconConfig } from '@/config/icons'
import { formatTime } from '@/utils/format'
import './index.scss'
```

### 样式命名（BEM）

```scss
.topic-card {
  &__header { }
  &__body { }
  &__footer { }
  &--active { }
}
```

---

## 🎓 学习资源

- [Taro官方文档](https://taro.zone/)
- [React官方文档](https://react.dev/)
- [Iconify图标库](https://icon-sets.iconify.design/)
- [Prisma文档](https://www.prisma.io/docs)