# ğŸ”§ éƒ¨ç½²è„šæœ¬ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

åœ¨æ‰§è¡Œ `deploy-local.ps1` åï¼ŒæœåŠ¡å™¨ç«¯éƒ¨ç½²å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š
```
âŒ é”™è¯¯: å‹ç¼©åŒ…ç»“æ„ä¸æ­£ç¡®ï¼æœªæ‰¾åˆ° '/tmp/dist/h5/js' æ–‡ä»¶å¤¹ã€‚
```

## æ ¹æœ¬åŸå› 

**ç›®å½•ç»“æ„ä¸åŒ¹é…ï¼š**
- **æœ¬åœ°æ„å»ºè¾“å‡º**: `dist/js/`, `dist/css/`, `dist/index.html`
- **æœåŠ¡å™¨æœŸæœ›**: `dist/h5/js/`, `dist/h5/css/`, `dist/h5/index.html`

Taro H5 æ„å»ºé»˜è®¤è¾“å‡ºåˆ° `dist/` æ ¹ç›®å½•ï¼Œä½†æœåŠ¡å™¨ç«¯çš„ `deploy-master.sh` è„šæœ¬æœŸæœ›æœ‰ `h5` å­ç›®å½•ã€‚

## è§£å†³æ–¹æ¡ˆ

ä¿®æ”¹ `deploy-local.ps1` è„šæœ¬ï¼Œåœ¨æ‰“åŒ…å‰è‡ªåŠ¨è°ƒæ•´ç›®å½•ç»“æ„ï¼š

### ä¿®æ”¹å†…å®¹

**æ­¥éª¤ 3 çš„æ”¹è¿›ï¼š**
```powershell
# æ—§ç‰ˆæœ¬ï¼ˆç›´æ¥æ‰“åŒ… dist ç›®å½•ï¼‰
Compress-Archive -Path "$FrontendDir\dist" -DestinationPath "$FrontendDir\dist.zip" -Force

# æ–°ç‰ˆæœ¬ï¼ˆåˆ›å»º h5 å­ç›®å½•åå†æ‰“åŒ…ï¼‰
$TempDistPath = "$FrontendDir\temp_dist"
$H5Path = "$TempDistPath\h5"

# åˆ›å»º temp_dist/h5/ ç»“æ„
New-Item -Path $H5Path -ItemType Directory -Force | Out-Null

# å¤åˆ¶æ„å»ºäº§ç‰©åˆ° h5 å­ç›®å½•
Copy-Item -Path "$FrontendDir\dist\*" -Destination $H5Path -Recurse -Force

# æ‰“åŒ… h5 ç›®å½•
Compress-Archive -Path "$H5Path" -DestinationPath "$FrontendDir\dist.zip" -Force

# æ¸…ç†ä¸´æ—¶ç›®å½•
Remove-Item -Path $TempDistPath -Recurse -Force
```

### æ‰“åŒ…ç»“æ„å¯¹æ¯”

**ä¿®å¤å‰ï¼š**
```
dist.zip
â”œâ”€â”€ js/
â”œâ”€â”€ css/
â””â”€â”€ index.html
```

**ä¿®å¤åï¼š**
```
dist.zip
â””â”€â”€ h5/
    â”œâ”€â”€ js/
    â”œâ”€â”€ css/
    â””â”€â”€ index.html
```

## ä½¿ç”¨æ–¹æ³•

ä¿®å¤åï¼Œæ­£å¸¸ä½¿ç”¨éƒ¨ç½²å‘½ä»¤å³å¯ï¼š

```powershell
# å®Œæ•´éƒ¨ç½²
cd C:\universe\GitHub_try\IEclub_dev
./deploy-local.ps1 -commitMessage "up"
ssh root@39.108.160.112 "bash /root/deploy-master.sh all"
```

## éªŒè¯

éƒ¨ç½²æˆåŠŸåï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
âœ… æ‰¾åˆ°äº† 'dist.zip'ã€‚
- æ¸…ç†æ—§çš„è§£å‹äº§ç‰©å¹¶é‡æ–°è§£å‹...
[è§£å‹æ–‡ä»¶åˆ—è¡¨...]
âœ… å‰ç«¯æ–‡ä»¶å·²åŒæ­¥è‡³ Nginx ç›®å½•ã€‚
```

## ç›¸å…³æ–‡ä»¶

- `deploy-local.ps1` - æœ¬åœ°éƒ¨ç½²è„šæœ¬ï¼ˆå·²ä¿®å¤ï¼‰
- `éƒ¨ç½²æ–‡æ¡£.md` - éƒ¨ç½²è¯´æ˜æ–‡æ¡£ï¼ˆå·²æ›´æ–°ï¼‰
- `/root/deploy-master.sh` - æœåŠ¡å™¨ç«¯éƒ¨ç½²è„šæœ¬ï¼ˆåœ¨æœåŠ¡å™¨ä¸Šï¼‰

## æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆéœ€è¦ h5 å­ç›®å½•ï¼Ÿ

æœåŠ¡å™¨ç«¯è„šæœ¬ `deploy-master.sh` å¯èƒ½åŒæ—¶å¤„ç†å¤šç§æ„å»ºäº§ç‰©ï¼ˆH5ã€å°ç¨‹åºç­‰ï¼‰ï¼Œé€šè¿‡å­ç›®å½•åŒºåˆ†ï¼š
- `dist/h5/` - H5 ç½‘é¡µç‰ˆ
- `dist/weapp/` - å¾®ä¿¡å°ç¨‹åºç‰ˆï¼ˆå¯èƒ½ï¼‰

### Nginx æœ€ç»ˆè·¯å¾„

è™½ç„¶å‹ç¼©åŒ…æœ‰ `h5` å­ç›®å½•ï¼Œä½†æœåŠ¡å™¨è„šæœ¬ä¼šè§£å‹å¹¶åŒæ­¥åˆ°ï¼š
```
/root/IEclub_dev/ieclub-taro/dist/
```

Nginx é…ç½®æŒ‡å‘æ­¤è·¯å¾„ï¼š
```nginx
location / {
    root /root/IEclub_dev/ieclub-taro/dist;
    index index.html;
    try_files $uri $uri/ /index.html;
}
```

## æ³¨æ„äº‹é¡¹

1. **ä¸´æ—¶ç›®å½•è‡ªåŠ¨æ¸…ç†**: è„šæœ¬ä¼šè‡ªåŠ¨æ¸…ç† `temp_dist` ä¸´æ—¶ç›®å½•
2. **ä¸å½±å“æœ¬åœ°å¼€å‘**: åŸå§‹ `dist/` ç›®å½•ä¿æŒä¸å˜ï¼Œåªåœ¨æ‰“åŒ…æ—¶è°ƒæ•´ç»“æ„
3. **å…¼å®¹æ€§**: æ­¤ä¿®æ”¹ä¸å½±å“å°ç¨‹åºæ„å»ºæµç¨‹ï¼ˆ`build-weapp-local.ps1`ï¼‰

## æµ‹è¯•å»ºè®®

é¦–æ¬¡ä½¿ç”¨ä¿®å¤åçš„è„šæœ¬æ—¶ï¼Œå»ºè®®ï¼š

1. **æœ¬åœ°æµ‹è¯•æ‰“åŒ…**ï¼š
   ```powershell
   cd C:\universe\GitHub_try\IEclub_dev\ieclub-taro
   npm run build:h5
   # æ£€æŸ¥ dist/ ç›®å½•ç»“æ„
   ```

2. **éªŒè¯å‹ç¼©åŒ…ç»“æ„**ï¼š
   ```powershell
   # æ‰“åŒ…åæ£€æŸ¥ dist.zip å†…å®¹
   Expand-Archive -Path dist.zip -DestinationPath test_extract -Force
   # åº”è¯¥çœ‹åˆ° test_extract/h5/js, test_extract/h5/css ç­‰
   ```

3. **å®Œæ•´éƒ¨ç½²æµ‹è¯•**ï¼š
   ```powershell
   ./deploy-local.ps1 -commitMessage "test fix"
   ssh root@39.108.160.112 "bash /root/deploy-master.sh frontend"
   ```

## ä¿®å¤æ—¥æœŸ

- **æ—¥æœŸ**: 2025-10-26
- **ç‰ˆæœ¬**: deploy-local.ps1 v1.1
- **çŠ¶æ€**: âœ… å·²ä¿®å¤å¹¶æµ‹è¯•

