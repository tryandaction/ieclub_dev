# IEClub 双端开发指南

**网页版 + 小程序 统一架构方案**

---

## 📊 架构总览

```
┌─────────────────────────────────────────────────────────┐
│                    用户层                                │
├──────────────────────┬──────────────────────────────────┤
│   浏览器 (Web)       │   微信 (WeChat Mini Program)     │
│   • Chrome           │   • iOS 微信                      │
│   • Safari           │   • Android 微信                  │
│   • Edge             │                                   │
└──────────┬───────────┴────────────────┬─────────────────┘
           │                            │
           │                            │
┌──────────▼───────────┐    ┌──────────▼──────────────────┐
│    网页版 (Web)      │    │   小程序版 (MiniProgram)     │
│  ┌──────────────────┐│    │   ┌──────────────────────┐  │
│  │ React + Vite     ││    │   │ 原生微信小程序       │  │
│  │ Tailwind CSS     ││    │   │ WXML + WXSS + JS     │  │
│  │ React Router     ││    │   │ 原生组件 + API       │  │
│  └──────────────────┘│    │   └──────────────────────┘  │
└──────────┬───────────┘    └────────────┬────────────────┘
           │                              │
           │                              │
           └──────────────┬───────────────┘
                          │
                   ┌──────▼────────┐
                   │  统一后端 API  │
                   │  (Node.js)    │
                   └──────┬────────┘
                          │
           ┌──────────────┼──────────────┐
           │              │              │
      ┌────▼───┐     ┌───▼───┐     ┌───▼────┐
      │ MySQL  │     │ Redis │     │ Storage│
      └────────┘     └───────┘     └────────┘
```

---

## 🎯 核心原则

### 1. 数据统一

**所有数据由同一后端提供**

- ✅ 用户信息统一
- ✅ 话题内容统一
- ✅ 活动数据统一
- ✅ 评论互动统一

### 2. 功能同步

**两端功能保持一致**

- ✅ 相同的核心功能
- ✅ 相同的业务逻辑
- ✅ 相同的用户体验

### 3. 设计统一

**相同的设计语言**

- ✅ 统一的色彩系统
- ✅ 统一的组件样式
- ✅ 统一的交互方式

---

## 📱 双端对比

| 特性 | 网页版 | 小程序版 | 说明 |
|------|--------|----------|------|
| **技术栈** | React + Vite | 原生微信小程序 | 不同技术实现相同功能 |
| **样式方案** | Tailwind CSS | WXSS | 相同的设计效果 |
| **路由方案** | React Router | 原生导航 | 不同实现，相同体验 |
| **状态管理** | Zustand | 页面 data | 根据需要选择 |
| **HTTP 请求** | Axios | wx.request | 统一封装 |
| **本地存储** | localStorage | wx.storage | 统一接口 |
| **用户认证** | JWT Token | JWT Token | 完全统一 |
| **后端 API** | ✅ 统一 | ✅ 统一 | **核心！** |

---

## 🔌 统一后端 API

### API 基础地址

```
开发环境: http://localhost:3000/api
生产环境: https://api.ieclub.online/api
```

### 核心接口

#### 1. 用户模块

```javascript
// 登录
POST /api/auth/login
Body: { phone, code }
Response: { token, user }

// 获取用户信息
GET /api/users/:id
Headers: { Authorization: Bearer <token> }
Response: { id, name, avatar, ... }
```

#### 2. 话题模块

```javascript
// 获取话题列表
GET /api/topics?type=all&page=1&limit=20
Response: { topics: [...], total, page }

// 获取话题详情
GET /api/topics/:id
Response: { id, title, content, ... }

// 发布话题
POST /api/topics
Body: { type, title, content, tags }
Response: { id, ... }
```

#### 3. 社区模块

```javascript
// 获取用户列表
GET /api/users?page=1&limit=20
Response: { users: [...], total }

// 关注用户
POST /api/users/:id/follow
Response: { success: true }
```

#### 4. 活动模块

```javascript
// 获取活动列表
GET /api/activities
Response: { activities: [...] }

// 报名活动
POST /api/activities/:id/register
Response: { success: true }
```

---

## 💻 网页版实现

### 目录结构

```
ieclub-web/
├── src/
│   ├── api/              # API 封装
│   │   ├── request.js   # 请求封装
│   │   ├── auth.js      # 认证接口
│   │   ├── topic.js     # 话题接口
│   │   └── ...
│   ├── components/       # 组件
│   ├── pages/           # 页面
│   ├── store/           # 状态管理
│   ├── utils/           # 工具函数
│   └── App.jsx
```

### API 封装示例

```javascript
// src/api/request.js
import axios from 'axios'

const request = axios.create({
  baseURL: '/api',
  timeout: 10000
})

// 请求拦截器
request.interceptors.request.use(config => {
  const token = localStorage.getItem('token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// 响应拦截器
request.interceptors.response.use(
  response => response.data,
  error => Promise.reject(error)
)

export default request
```

```javascript
// src/api/topic.js
import request from './request'

export const getTopics = (params) => {
  return request.get('/topics', { params })
}

export const getTopic = (id) => {
  return request.get(`/topics/${id}`)
}

export const createTopic = (data) => {
  return request.post('/topics', data)
}
```

---

## 📱 小程序实现

### 目录结构

```
ieclub-taro/
├── utils/
│   └── request.js       # 请求封装
├── api/
│   ├── auth.js         # 认证接口
│   ├── topic.js        # 话题接口
│   └── ...
├── pages/              # 页面
└── app.js
```

### API 封装示例

```javascript
// utils/request.js
const request = (url, options = {}) => {
  return new Promise((resolve, reject) => {
    const app = getApp()
    
    wx.request({
      url: app.globalData.apiBase + url,
      method: options.method || 'GET',
      data: options.data,
      header: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + wx.getStorageSync('token')
      },
      success: (res) => {
        if (res.statusCode === 200) {
          resolve(res.data)
        } else {
          reject(res)
        }
      },
      fail: reject
    })
  })
}

export default request
```

```javascript
// api/topic.js
import request from '../utils/request'

export const getTopics = (params) => {
  return request('/topics', {
    method: 'GET',
    data: params
  })
}

export const getTopic = (id) => {
  return request(`/topics/${id}`)
}

export const createTopic = (data) => {
  return request('/topics', {
    method: 'POST',
    data
  })
}
```

---

## 🔐 用户认证统一方案

### 流程

```
1. 用户登录 → 后端验证 → 返回 JWT Token
2. 前端存储 Token
   - 网页版: localStorage.setItem('token', token)
   - 小程序: wx.setStorageSync('token', token)
3. 每次请求携带 Token
   - Header: Authorization: Bearer <token>
4. 后端验证 Token → 返回用户信息
```

### Token 管理

**网页版**:
```javascript
// 保存 Token
localStorage.setItem('token', token)

// 获取 Token
const token = localStorage.getItem('token')

// 删除 Token
localStorage.removeItem('token')
```

**小程序版**:
```javascript
// 保存 Token
wx.setStorageSync('token', token)

// 获取 Token
const token = wx.getStorageSync('token')

// 删除 Token
wx.removeStorageSync('token')
```

---

## 📦 数据同步机制

### 实时同步

用户在任一端的操作都会立即反映到另一端：

1. **用户在网页发布话题** → 后端创建 → 小程序刷新可见
2. **用户在小程序关注他人** → 后端更新 → 网页刷新可见
3. **用户在网页修改资料** → 后端更新 → 小程序同步显示

### 缓存策略

**网页版**:
```javascript
// 使用 localStorage + Redis
// 首次加载从服务器获取
// 后续访问先读缓存
// 后台异步更新
```

**小程序版**:
```javascript
// 使用 wx.storage + Redis
// 与网页版相同策略
```

---

## 🎨 UI 统一规范

### 色彩系统

```css
/* 两端使用相同的色值 */
--primary: #8b5cf6;
--gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
--text-primary: #333;
--text-secondary: #666;
--text-tertiary: #999;
--background: #f5f5f5;
```

### 组件对照

| 功能 | 网页版 | 小程序版 |
|------|--------|----------|
| 话题卡片 | `TopicCard.jsx` | `<view class="topic-card">` |
| 用户卡片 | `UserCard.jsx` | `<view class="user-card">` |
| 导航栏 | `<Layout>` | `<tabBar>` |
| 按钮 | `<button className="btn-primary">` | `<button class="btn-primary">` |

---

## 📝 开发流程

### 新增功能

1. **后端开发** (优先)
   ```bash
   # 在 ieclub-backend 中开发
   # 添加路由、控制器、服务
   # 测试 API
   ```

2. **网页版开发**
   ```bash
   cd ieclub-web
   # 创建页面/组件
   # 对接 API
   # 测试功能
   ```

3. **小程序开发**
   ```bash
   cd ieclub-taro
   # 创建页面
   # 对接 API
   # 测试功能
   ```

### 调试

**同时启动三个服务**:

```bash
# Terminal 1: 后端
cd ieclub-backend
npm run dev

# Terminal 2: 网页版
cd ieclub-web
npm run dev

# Terminal 3: 小程序
# 打开微信开发者工具
# 导入 ieclub-taro 目录
```

---

## 🚀 部署方案

### 后端

```bash
# 部署到服务器
docker-compose up -d
```

### 网页版

```bash
# 构建
cd ieclub-web
npm run build

# 部署到 Nginx
cp -r dist/* /var/www/ieclub-web/
```

### 小程序

```
# 使用微信开发者工具
1. 点击"上传"
2. 填写版本号和备注
3. 提交审核
4. 审核通过后发布
```

---

## 📊 开发优先级

### Phase 1: 基础功能 ✅

- ✅ 后端 API 完整
- ✅ 网页版基础页面
- ✅ 小程序基础页面

### Phase 2: 数据对接 🔄

- 🔄 统一 API 封装
- 🔄 用户认证统一
- 🔄 数据实时同步

### Phase 3: 功能完善 ⏳

- ⏳ 详情页
- ⏳ 搜索功能
- ⏳ 消息通知

---

## 🎯 下一步行动

### 立即可做

1. **启动网页版**
   ```bash
   cd ieclub-web
   npm install
   npm run dev
   ```

2. **同时测试小程序**
   - 打开微信开发者工具
   - 导入 ieclub-taro
   - 点击编译

3. **确认后端运行**
   ```bash
   cd ieclub-backend
   npm run dev
   ```

### 本周目标

- [ ] 网页版和小程序都对接登录接口
- [ ] 实现 Token 统一管理
- [ ] 完成话题列表数据同步

---

Made with ❤️ by IEClub Team

