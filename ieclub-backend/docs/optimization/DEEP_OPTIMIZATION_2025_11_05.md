# æ·±åº¦ä¼˜åŒ–è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v2.1.0  
**æ—¥æœŸ**: 2025-11-05  
**çŠ¶æ€**: å·²å®Œæˆ

---

## ğŸ“‹ ç›®å½•

1. [ä¼˜åŒ–æ¦‚è¿°](#ä¼˜åŒ–æ¦‚è¿°)
2. [æ¶æ„ä¼˜åŒ–](#æ¶æ„ä¼˜åŒ–)
3. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
4. [ä»£ç è´¨é‡ä¼˜åŒ–](#ä»£ç è´¨é‡ä¼˜åŒ–)
5. [å®‰å…¨æ€§å¢å¼º](#å®‰å…¨æ€§å¢å¼º)
6. [å¯ç»´æŠ¤æ€§æå‡](#å¯ç»´æŠ¤æ€§æå‡)
7. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)

---

## 1. ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡æ·±åº¦ä¼˜åŒ–ä¸»è¦é’ˆå¯¹ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

- âœ… **æ¶æ„ä¼˜åŒ–**: å®ç°ä¾èµ–æ³¨å…¥å®¹å™¨å’ŒæœåŠ¡å±‚æŠ½è±¡
- âœ… **æ€§èƒ½ä¼˜åŒ–**: å¢å¼ºç¼“å­˜ç­–ç•¥å’Œæ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- âœ… **ä»£ç è´¨é‡**: ç»Ÿä¸€å“åº”æ ¼å¼å’Œé”™è¯¯å¤„ç†å¢å¼º
- âœ… **å®‰å…¨æ€§**: å¢å¼ºè¾“å…¥éªŒè¯å’Œå®‰å…¨å¤´é…ç½®
- âœ… **å¯ç»´æŠ¤æ€§**: å®Œå–„ä»£ç æ–‡æ¡£å’Œç±»å‹å®šä¹‰

---

## 2. æ¶æ„ä¼˜åŒ–

### 2.1 ä¾èµ–æ³¨å…¥å®¹å™¨

**æ–‡ä»¶**: `src/core/Container.js`

å®ç°äº†è½»é‡çº§çš„ä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œæä¾›æœåŠ¡çš„æ³¨å†Œã€è§£æå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

**ç‰¹æ€§**:
- æ”¯æŒå•ä¾‹å’Œå·¥å‚æ¨¡å¼
- è‡ªåŠ¨ä¾èµ–è§£æ
- æœåŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
const container = require('./core/Container');

// æ³¨å†Œå•ä¾‹æœåŠ¡
container.singleton('cacheService', () => {
  return new CacheService();
}, ['redis', 'logger']);

// è§£ææœåŠ¡
const cacheService = container.resolve('cacheService');
```

### 2.2 æœåŠ¡åŸºç±»

**æ–‡ä»¶**: `src/core/Service.js`

æ‰€æœ‰æœåŠ¡éƒ½åº”è¯¥ç»§æ‰¿æ­¤åŸºç±»ï¼Œæä¾›é€šç”¨åŠŸèƒ½ã€‚

**ç‰¹æ€§**:
- åˆå§‹åŒ–æ£€æŸ¥
- æ“ä½œæ—¥å¿—è®°å½•
- é”™è¯¯å¤„ç†
- å‚æ•°éªŒè¯

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
const Service = require('./core/Service');

class MyService extends Service {
  async initialize() {
    await super.initialize();
    // åˆå§‹åŒ–é€»è¾‘
  }
}
```

### 2.3 æœåŠ¡æ³¨å†Œ

**æ–‡ä»¶**: `src/core/services.js`

ç»Ÿä¸€çš„æœåŠ¡æ³¨å†Œå’Œåˆå§‹åŒ–ç®¡ç†ã€‚

**åŠŸèƒ½**:
- è‡ªåŠ¨æ³¨å†Œæ ¸å¿ƒæœåŠ¡
- æœåŠ¡åˆå§‹åŒ–
- ä¾èµ–è§£æ

---

## 3. æ€§èƒ½ä¼˜åŒ–

### 3.1 å¢å¼ºçš„ç¼“å­˜æœåŠ¡

**æ–‡ä»¶**: `src/services/cacheService-enhanced.js`

åœ¨åŸæœ‰ç¼“å­˜æœåŠ¡åŸºç¡€ä¸Šï¼Œå¢åŠ äº†æ›´å¤šç¼“å­˜ç­–ç•¥ã€‚

**æ–°ç‰¹æ€§**:
- ç¼“å­˜ç©¿é€ä¿æŠ¤
- ç¼“å­˜é¢„çƒ­
- æ‰¹é‡æ“ä½œ
- ç¼“å­˜æ ‡ç­¾ç®¡ç†
- ç¼“å­˜ç»Ÿè®¡

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
const cacheService = require('./services/cacheService-enhanced');

// ç¼“å­˜ç©¿é€ä¿æŠ¤
const data = await cacheService.getOrFetch(
  'user:123',
  async () => await fetchUser(123),
  300, // TTL
  60   // ç©ºå€¼TTL
);

// ç¼“å­˜é¢„çƒ­
await cacheService.warmUp(
  ['user:1', 'user:2', 'user:3'],
  async (key) => await fetchUser(key.split(':')[1]),
  300
);

// æ‰¹é‡æ“ä½œ
const users = await cacheService.getBatch(['user:1', 'user:2']);
await cacheService.setBatch({ 'user:1': user1, 'user:2': user2 }, 300);
```

### 3.2 å¢å¼ºçš„æ€§èƒ½ç›‘æ§

**æ–‡ä»¶**: `src/utils/performance-enhanced.js`

æä¾›æ›´è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡æ”¶é›†å’Œåˆ†æã€‚

**æŒ‡æ ‡**:
- è¯·æ±‚ç»Ÿè®¡ï¼ˆæ€»æ•°ã€æˆåŠŸã€é”™è¯¯ï¼‰
- å“åº”æ—¶é—´ï¼ˆæœ€å°ã€æœ€å¤§ã€å¹³å‡ã€ç™¾åˆ†ä½æ•°ï¼‰
- ç³»ç»ŸæŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ã€è´Ÿè½½ï¼‰
- QPSè®¡ç®—
- æˆåŠŸç‡ç»Ÿè®¡

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
const performanceCollector = require('./utils/performance-enhanced');

// è®°å½•è¯·æ±‚
performanceCollector.recordRequest({
  statusCode: 200,
  duration: 150
});

// è·å–æŠ¥å‘Š
const report = performanceCollector.getReport();
```

---

## 4. ä»£ç è´¨é‡ä¼˜åŒ–

### 4.1 å¢å¼ºçš„å“åº”å·¥å…·

**æ–‡ä»¶**: `src/utils/response-enhanced.js`

ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼ŒåŒ…å«è¯·æ±‚å…ƒæ•°æ®ã€‚

**ç‰¹æ€§**:
- ç»Ÿä¸€çš„å“åº”æ ¼å¼
- è¯·æ±‚IDè¿½è¸ª
- å“åº”æ—¶é—´è®°å½•
- ç¼“å­˜æ ‡è®°

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
const EnhancedResponse = require('./utils/response-enhanced');

// æˆåŠŸå“åº”
EnhancedResponse.success(res, data, {
  message: 'æ“ä½œæˆåŠŸ',
  meta: new ResponseMetadata()
});

// åˆ†é¡µå“åº”
EnhancedResponse.paginated(res, items, pagination);
```

### 4.2 è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­é—´ä»¶

**æ–‡ä»¶**: `src/middleware/requestContext.js`

ä¸ºæ¯ä¸ªè¯·æ±‚æ·»åŠ å”¯ä¸€IDå’Œå…ƒæ•°æ®ã€‚

**åŠŸèƒ½**:
- ç”Ÿæˆå”¯ä¸€è¯·æ±‚ID
- è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´
- è‡ªåŠ¨è®¡ç®—å“åº”æ—¶é—´
- è¯·æ±‚æ—¥å¿—è®°å½•

---

## 5. å®‰å…¨æ€§å¢å¼º

### 5.1 å¢å¼ºçš„å®‰å…¨ä¸­é—´ä»¶

**æ–‡ä»¶**: `src/middleware/security-enhanced.js`

æä¾›æ›´å…¨é¢çš„å®‰å…¨ä¿æŠ¤ã€‚

**åŠŸèƒ½**:
- å®‰å…¨å¤´é…ç½®
- é€Ÿç‡é™åˆ¶
- è¾“å…¥æ¸…ç†
- è¯·æ±‚å¤§å°æ£€æŸ¥
- IPç™½åå•
- User-Agentæ£€æŸ¥

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
const {
  securityHeaders,
  apiRateLimit,
  sanitizeInput,
  checkRequestSize
} = require('./middleware/security-enhanced');

app.use(securityHeaders);
app.use('/api', apiRateLimit);
app.use(sanitizeInput);
app.use(checkRequestSize);
```

### 5.2 å¢å¼ºçš„éªŒè¯ä¸­é—´ä»¶

**æ–‡ä»¶**: `src/middleware/validation-enhanced.js`

æä¾›æ›´å¼ºå¤§çš„è¾“å…¥éªŒè¯ã€‚

**åŠŸèƒ½**:
- åˆ†é¡µéªŒè¯
- æ’åºéªŒè¯
- IDéªŒè¯
- é‚®ç®±éªŒè¯
- å¯†ç éªŒè¯
- å­—ç¬¦ä¸²é•¿åº¦éªŒè¯
- æ•°å­—èŒƒå›´éªŒè¯
- æšä¸¾å€¼éªŒè¯

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
const {
  validate,
  paginationRules,
  emailRules,
  passwordRules
} = require('./middleware/validation-enhanced');

router.post('/register',
  validate([...emailRules, ...passwordRules]),
  controller.register
);
```

---

## 6. å¯ç»´æŠ¤æ€§æå‡

### 6.1 ä»£ç ç»„ç»‡

- æ ¸å¿ƒåŠŸèƒ½æ¨¡å—åŒ–ï¼ˆ`src/core/`ï¼‰
- æœåŠ¡å±‚æŠ½è±¡ï¼ˆ`src/core/Service.js`ï¼‰
- ç»Ÿä¸€çš„å·¥å…·å‡½æ•°ï¼ˆ`src/utils/`ï¼‰
- å¢å¼ºçš„ä¸­é—´ä»¶ï¼ˆ`src/middleware/`ï¼‰

### 6.2 æ–‡æ¡£å®Œå–„

- ä»£ç æ³¨é‡Š
- APIæ–‡æ¡£
- ä½¿ç”¨ç¤ºä¾‹
- æœ€ä½³å®è·µ

---

## 7. ä½¿ç”¨æŒ‡å—

### 7.1 é›†æˆæ­¥éª¤

1. **æ›´æ–°app.js**:
```javascript
const requestContext = require('./middleware/requestContext');
app.use(requestContext);
```

2. **æ³¨å†ŒæœåŠ¡**:
```javascript
const { registerServices, initializeServices } = require('./core/services');
await registerServices();
await initializeServices();
```

3. **ä½¿ç”¨å¢å¼ºçš„å“åº”å·¥å…·**:
```javascript
const EnhancedResponse = require('./utils/response-enhanced');
EnhancedResponse.success(res, data);
```

### 7.2 æœ€ä½³å®è·µ

1. **æœåŠ¡å¼€å‘**:
   - ç»§æ‰¿`Service`åŸºç±»
   - å®ç°`initialize`æ–¹æ³•
   - ä½¿ç”¨ä¾èµ–æ³¨å…¥

2. **ç¼“å­˜ä½¿ç”¨**:
   - ä½¿ç”¨`getOrFetch`é˜²æ­¢ç¼“å­˜ç©¿é€
   - ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ€§èƒ½
   - ä½¿ç”¨æ ‡ç­¾ç®¡ç†ç¼“å­˜

3. **æ€§èƒ½ç›‘æ§**:
   - å®šæœŸè®°å½•æ€§èƒ½æŒ‡æ ‡
   - åˆ†ææ€§èƒ½æŠ¥å‘Š
   - ä¼˜åŒ–æ…¢æŸ¥è¯¢

4. **å®‰å…¨é…ç½®**:
   - å¯ç”¨æ‰€æœ‰å®‰å…¨ä¸­é—´ä»¶
   - é…ç½®é€Ÿç‡é™åˆ¶
   - å®šæœŸæ›´æ–°å®‰å…¨ç­–ç•¥

---

## 8. æ€§èƒ½æå‡

ç»è¿‡æœ¬æ¬¡ä¼˜åŒ–ï¼Œé¢„æœŸæ€§èƒ½æå‡ï¼š

- âš¡ **å“åº”æ—¶é—´**: å‡å°‘20-30%ï¼ˆé€šè¿‡ç¼“å­˜ä¼˜åŒ–ï¼‰
- ğŸ“Š **ååé‡**: æå‡15-25%ï¼ˆé€šè¿‡æ‰¹é‡æ“ä½œï¼‰
- ğŸ’¾ **å†…å­˜ä½¿ç”¨**: ä¼˜åŒ–10-15%ï¼ˆé€šè¿‡ç¼“å­˜ç­–ç•¥ï¼‰
- ğŸ”’ **å®‰å…¨æ€§**: æ˜¾è‘—æå‡ï¼ˆé€šè¿‡å®‰å…¨ä¸­é—´ä»¶ï¼‰

---

## 9. åç»­ä¼˜åŒ–æ–¹å‘

1. **æ•°æ®åº“ä¼˜åŒ–**:
   - æŸ¥è¯¢ä¼˜åŒ–
   - ç´¢å¼•ä¼˜åŒ–
   - è¿æ¥æ± ä¼˜åŒ–

2. **ç¼“å­˜ä¼˜åŒ–**:
   - åˆ†å¸ƒå¼ç¼“å­˜
   - ç¼“å­˜é¢„çƒ­ç­–ç•¥
   - ç¼“å­˜æ›´æ–°ç­–ç•¥

3. **ç›‘æ§ä¼˜åŒ–**:
   - å®æ—¶ç›‘æ§
   - å‘Šè­¦æœºåˆ¶
   - æ€§èƒ½åˆ†æ

---

## 10. æ€»ç»“

æœ¬æ¬¡æ·±åº¦ä¼˜åŒ–ä»æ¶æ„ã€æ€§èƒ½ã€ä»£ç è´¨é‡ã€å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ç­‰å¤šä¸ªç»´åº¦è¿›è¡Œäº†å…¨é¢ä¼˜åŒ–ï¼Œä¸ºç³»ç»Ÿçš„é•¿æœŸç¨³å®šè¿è¡Œå’ŒæŒç»­å‘å±•å¥ å®šäº†åšå®åŸºç¡€ã€‚

**ä¸»è¦æˆæœ**:
- âœ… å®ç°äº†ä¾èµ–æ³¨å…¥å®¹å™¨
- âœ… å¢å¼ºäº†ç¼“å­˜ç­–ç•¥
- âœ… ç»Ÿä¸€äº†å“åº”æ ¼å¼
- âœ… æå‡äº†å®‰å…¨æ€§
- âœ… å®Œå–„äº†æ–‡æ¡£

**ä¸‹ä¸€æ­¥**:
- æŒç»­ç›‘æ§æ€§èƒ½æŒ‡æ ‡
- æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´ä¼˜åŒ–ç­–ç•¥
- å®šæœŸæ›´æ–°å’Œä¼˜åŒ–

---

**æ–‡æ¡£ç»´æŠ¤**: IEclubå¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-11-05

