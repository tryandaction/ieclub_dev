# ğŸ¯ IEClub ä¸‹ä¸€é˜¶æ®µå¼€å‘è®¾è®¡è§„åˆ’

**åˆ›å»ºæ—¶é—´**: 2025-11-27  
**çŠ¶æ€**: è®¾è®¡è§„åˆ’ä¸­  
**ä¼˜å…ˆçº§**: é«˜ â†’ ä¸­ â†’ ä½

---

## ğŸ“Š å½“å‰çŠ¶æ€åˆ†æ

### âœ… å·²å®ŒæˆåŠŸèƒ½ï¼ˆç¨³å®šè¿è¡Œï¼‰

| æ¨¡å— | åŠŸèƒ½ | ç½‘é¡µ | å°ç¨‹åº | åç«¯ |
|------|------|------|--------|------|
| è®¤è¯ | é‚®ç®±ç™»å½•/æ³¨å†Œ | âœ… | âœ… | âœ… |
| è®¤è¯ | å¾®ä¿¡ç™»å½• | âœ… | âœ… | âœ… |
| è®¤è¯ | å¯†ç é‡ç½® | âœ… | âœ… | âœ… |
| è¯é¢˜ | è¯é¢˜å¹¿åœº | âœ… | âœ… | âœ… |
| è¯é¢˜ | è¯é¢˜è¯¦æƒ…/è¯„è®º | âœ… | âœ… | âœ… |
| è¯é¢˜ | å‘å¸ƒè¯é¢˜ | âœ… | âœ… | âœ… |
| ç¤¾åŒº | ç”¨æˆ·åˆ—è¡¨ | âœ… | âœ… | âœ… |
| ç¤¾åŒº | ä¸ªäººä¸»é¡µ | âœ… | âœ… | âœ… |
| ç¤¾åŒº | å…³æ³¨/ç²‰ä¸ | âœ… | âœ… | âœ… |
| æ´»åŠ¨ | æ´»åŠ¨åˆ—è¡¨ | âœ… | âœ… | âœ… |
| æ´»åŠ¨ | æŠ¥å/ç­¾åˆ° | âœ… | âœ… | âœ… |
| ä¸ªäºº | ç¼–è¾‘èµ„æ–™ | âœ… | âœ… | âœ… |
| ä¸ªäºº | æˆ‘çš„è¯é¢˜ | âœ… | âœ… | âœ… |
| ä¸ªäºº | æˆ‘çš„æ”¶è— | âœ… | âœ… | âœ… |
| æ¶ˆæ¯ | é€šçŸ¥åˆ—è¡¨ | âœ… | âœ… | âœ… |

### âš ï¸ å¾…å®Œå–„åŠŸèƒ½

| åŠŸèƒ½ | é—®é¢˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| **å›¾ç‰‡ä¸Šä¼ ** | è¿”å›501ï¼Œéœ€å®ç°å®Œæ•´ä¸Šä¼ æµç¨‹ | ğŸ”´ é«˜ |
| å¤´åƒ/å°é¢æ›´æ¢ | ä¾èµ–å›¾ç‰‡ä¸Šä¼  | ğŸ”´ é«˜ |
| è¯é¢˜å‘å¸ƒå›¾ç‰‡ | ä¾èµ–å›¾ç‰‡ä¸Šä¼  | ğŸ”´ é«˜ |
| ç”¨æˆ·åé¦ˆ | é¡µé¢å·²æœ‰ï¼Œéœ€éªŒè¯åŠŸèƒ½ | ğŸŸ¡ ä¸­ |

### ğŸ“ˆ æœåŠ¡å™¨èµ„æº

```
ç£ç›˜: 40GB (å·²ç”¨14GB, å‰©ä½™24GB) âœ… å……è¶³
å†…å­˜: 1.7GB (å·²ç”¨1.2GB, å‰©ä½™0.5GB) âš ï¸ åç´§
CPU: 2æ ¸
```

---

## ğŸš€ ä¸‹ä¸€é˜¶æ®µå¼€å‘è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šå›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼ˆä¼˜å…ˆçº§ï¼šğŸ”´ æœ€é«˜ï¼‰

**ç›®æ ‡**: å®ç°å®Œæ•´çš„å›¾ç‰‡ä¸Šä¼ ã€å‹ç¼©ã€å­˜å‚¨åŠŸèƒ½

#### æŠ€æœ¯æ–¹æ¡ˆé€‰æ‹©

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|--------|
| **æ–¹æ¡ˆA: æœ¬åœ°å­˜å‚¨** | ç®€å•ã€å…è´¹ã€æ— éœ€é…ç½® | ç£ç›˜ç©ºé—´æœ‰é™ã€æ— CDN | â­â­â­ |
| æ–¹æ¡ˆB: é˜¿é‡Œäº‘OSS | CDNåŠ é€Ÿã€æ— é™å­˜å‚¨ | éœ€ä»˜è´¹ã€é…ç½®å¤æ‚ | â­â­ |
| æ–¹æ¡ˆC: è…¾è®¯äº‘COS | åŒä¸Š | åŒä¸Š | â­â­ |
| æ–¹æ¡ˆD: å›¾åºŠæœåŠ¡ | ç®€å•ã€å…è´¹é¢åº¦ | ç¬¬ä¸‰æ–¹ä¾èµ– | â­ |

**æ¨èæ–¹æ¡ˆAï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰**ï¼ŒåŸå› ï¼š
1. æœåŠ¡å™¨æœ‰24GBå‰©ä½™ç©ºé—´ï¼Œè¶³å¤Ÿå­˜å‚¨å¤§é‡å›¾ç‰‡
2. æ— éœ€é¢å¤–ä»˜è´¹æˆ–é…ç½®
3. å·²æœ‰imageService.jså›¾ç‰‡å‹ç¼©æœåŠ¡
4. åæœŸå¯æ— ç¼è¿ç§»åˆ°OSS

#### è¯¦ç»†è®¾è®¡

##### 1. ç›®å½•ç»“æ„
```
/root/IEclub_dev/uploads/
â”œâ”€â”€ avatars/           # ç”¨æˆ·å¤´åƒ
â”‚   â”œâ”€â”€ original/      # åŸå›¾
â”‚   â””â”€â”€ compressed/    # å‹ç¼©å
â”œâ”€â”€ covers/            # ç”¨æˆ·å°é¢
â”‚   â”œâ”€â”€ original/
â”‚   â””â”€â”€ compressed/
â”œâ”€â”€ topics/            # è¯é¢˜å›¾ç‰‡
â”‚   â”œâ”€â”€ original/
â”‚   â”œâ”€â”€ compressed/
â”‚   â””â”€â”€ thumbnails/    # ç¼©ç•¥å›¾
â””â”€â”€ temp/              # ä¸´æ—¶æ–‡ä»¶ï¼ˆå®šæœŸæ¸…ç†ï¼‰
```

##### 2. æ•°æ®åº“è®¾è®¡
```prisma
model Image {
  id          String   @id @default(uuid())
  userId      String
  type        String   // avatar, cover, topic
  originalUrl String   // åŸå›¾URL
  compressedUrl String // å‹ç¼©åURL
  thumbnailUrl String? // ç¼©ç•¥å›¾URL
  size        Int      // æ–‡ä»¶å¤§å°(bytes)
  width       Int      // å®½åº¦
  height      Int      // é«˜åº¦
  mimeType    String   // image/jpeg, image/png
  createdAt   DateTime @default(now())
  
  user        User     @relation(fields: [userId], references: [id])
}
```

##### 3. APIè®¾è®¡
```
POST /api/upload/avatar       # ä¸Šä¼ å¤´åƒ
POST /api/upload/cover        # ä¸Šä¼ å°é¢
POST /api/upload/topic-images # ä¸Šä¼ è¯é¢˜å›¾ç‰‡ï¼ˆæ”¯æŒå¤šå›¾ï¼‰
DELETE /api/upload/:id        # åˆ é™¤å›¾ç‰‡
```

##### 4. å¤„ç†æµç¨‹
```
ç”¨æˆ·ä¸Šä¼  â†’ Multeræ¥æ”¶ â†’ éªŒè¯æ ¼å¼/å¤§å° â†’ Sharpå‹ç¼© â†’ å­˜å‚¨åˆ°æœ¬åœ° â†’ è¿”å›URL
```

##### 5. å®‰å…¨æªæ–½
- æ–‡ä»¶ç±»å‹ç™½åå•ï¼ˆjpg, png, webp, gifï¼‰
- æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆå•å›¾5MBï¼Œå¤´åƒ2MBï¼‰
- æ–‡ä»¶åéšæœºåŒ–ï¼ˆé˜²æ­¢è·¯å¾„éå†ï¼‰
- å®šæ—¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶

#### å¼€å‘ä»»åŠ¡æ¸…å•

```
â–¡ ä»»åŠ¡1: åˆ›å»ºuploadsç›®å½•ç»“æ„
â–¡ ä»»åŠ¡2: æ›´æ–°Nginxé…ç½®ï¼ˆé™æ€æ–‡ä»¶æœåŠ¡ï¼‰
â–¡ ä»»åŠ¡3: å®Œå–„uploadè·¯ç”±ï¼ˆæ›¿æ¢501å“åº”ï¼‰
â–¡ ä»»åŠ¡4: é›†æˆimageServiceå‹ç¼©åŠŸèƒ½
â–¡ ä»»åŠ¡5: æ›´æ–°Userè¡¨æ”¯æŒavatarUrlå­—æ®µ
â–¡ ä»»åŠ¡6: å‰ç«¯EditProfileé›†æˆçœŸå®ä¸Šä¼ 
â–¡ ä»»åŠ¡7: æµ‹è¯•å®Œæ•´ä¸Šä¼ æµç¨‹
â–¡ ä»»åŠ¡8: éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
```

**é¢„ä¼°å·¥æœŸ**: 1-2å¤©

---

### ç¬¬äºŒé˜¶æ®µï¼šä¸ªäººä¸­å¿ƒä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šğŸŸ¡ ä¸­ï¼‰

#### 2.1 è®¾ç½®é¡µé¢å®Œå–„

**å½“å‰çŠ¶æ€**: Settings.jsxå·²å­˜åœ¨ï¼Œéœ€éªŒè¯åŠŸèƒ½

**åŠŸèƒ½æ¸…å•**:
- [ ] æ¸…é™¤ç¼“å­˜
- [ ] è´¦å·å®‰å…¨ï¼ˆå¯†ç ä¿®æ”¹å…¥å£ï¼‰
- [ ] éšç§è®¾ç½®
- [ ] é€šçŸ¥è®¾ç½®
- [ ] æ·±è‰²æ¨¡å¼ï¼ˆå¯é€‰ï¼‰
- [ ] é€€å‡ºç™»å½•

#### 2.2 æ„è§åé¦ˆ

**å½“å‰çŠ¶æ€**: Feedback.jsxå·²å­˜åœ¨

**åŠŸèƒ½éœ€æ±‚**:
- [ ] æäº¤åé¦ˆè¡¨å•
- [ ] åé¦ˆç±»å‹é€‰æ‹©
- [ ] é™„ä»¶ä¸Šä¼ ï¼ˆä¾èµ–å›¾ç‰‡ä¸Šä¼ ï¼‰
- [ ] æŸ¥çœ‹æˆ‘çš„åé¦ˆ

#### 2.3 å…³äºæˆ‘ä»¬

**å½“å‰çŠ¶æ€**: About.jsxå·²å­˜åœ¨

**åŠŸèƒ½éœ€æ±‚**:
- [ ] ç‰ˆæœ¬ä¿¡æ¯
- [ ] è”ç³»æ–¹å¼
- [ ] éšç§æ”¿ç­–
- [ ] ç”¨æˆ·åè®®

**é¢„ä¼°å·¥æœŸ**: 2-3å¤©

---

### ç¬¬ä¸‰é˜¶æ®µï¼šV2.0æ ¸å¿ƒåŠŸèƒ½ï¼ˆä¼˜å…ˆçº§ï¼šğŸŸ¢ ä¸­é•¿æœŸï¼‰

#### 3.1 ç§ä¿¡èŠå¤©ç³»ç»Ÿ

**æŠ€æœ¯æ–¹æ¡ˆ**:
```
åç«¯: Socket.io + Redis PubSub
å‰ç«¯: å®æ—¶æ¶ˆæ¯æ¨é€
æ•°æ®åº“: Messageè¡¨ + Conversationè¡¨
```

**æ•°æ®åº“è®¾è®¡**:
```prisma
model Conversation {
  id           String    @id @default(uuid())
  participants String[]  // å‚ä¸è€…IDæ•°ç»„
  lastMessage  String?   // æœ€åä¸€æ¡æ¶ˆæ¯
  lastMessageAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  
  messages     Message[]
}

model Message {
  id             String       @id @default(uuid())
  conversationId String
  senderId       String
  content        String       @db.Text
  type           String       @default("text") // text, image, file
  readBy         String[]     // å·²è¯»ç”¨æˆ·ID
  createdAt      DateTime     @default(now())
  
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  sender         User         @relation(fields: [senderId], references: [id])
}
```

**é¢„ä¼°å·¥æœŸ**: 2å‘¨

#### 3.2 å°ç»„/åœˆå­åŠŸèƒ½

**æ•°æ®åº“è®¾è®¡**:
```prisma
model Group {
  id          String   @id @default(uuid())
  name        String
  description String?
  avatar      String?
  ownerId     String
  category    String?
  isPublic    Boolean  @default(true)
  memberCount Int      @default(0)
  createdAt   DateTime @default(now())
  
  owner       User     @relation("GroupOwner", fields: [ownerId], references: [id])
  members     GroupMember[]
  topics      GroupTopic[]
}

model GroupMember {
  id        String   @id @default(uuid())
  groupId   String
  userId    String
  role      String   @default("member") // owner, admin, member
  joinedAt  DateTime @default(now())
  
  group     Group    @relation(fields: [groupId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
  
  @@unique([groupId, userId])
}
```

**é¢„ä¼°å·¥æœŸ**: 2å‘¨

---

## ğŸ“‹ å¼€å‘ä¼˜å…ˆçº§æ€»ç»“

| ä¼˜å…ˆçº§ | åŠŸèƒ½ | å·¥æœŸ | çŠ¶æ€ |
|--------|------|------|------|
| ğŸ”´ P0 | å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ | 1-2å¤© | å¾…å¼€å‘ |
| ğŸŸ¡ P1 | ä¸ªäººä¸­å¿ƒä¼˜åŒ– | 2-3å¤© | å¾…å¼€å‘ |
| ğŸŸ¡ P2 | ç”¨æˆ·åé¦ˆå®Œå–„ | 1å¤© | å¾…éªŒè¯ |
| ğŸŸ¢ P3 | ç§ä¿¡èŠå¤©ç³»ç»Ÿ | 2å‘¨ | è§„åˆ’ä¸­ |
| ğŸŸ¢ P4 | å°ç»„åŠŸèƒ½ | 2å‘¨ | è§„åˆ’ä¸­ |

---

## ğŸ¯ ç«‹å³è¡ŒåŠ¨è®¡åˆ’

### ä»Šæ—¥ç›®æ ‡ï¼šå®ç°å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½

**æ­¥éª¤1**: åˆ›å»ºæœåŠ¡å™¨ç›®å½•ç»“æ„
```bash
ssh root@ieclub.online "mkdir -p /root/IEclub_dev/uploads/{avatars,covers,topics}/{original,compressed,thumbnails}"
```

**æ­¥éª¤2**: æ›´æ–°Nginxé…ç½®
```nginx
# æ·»åŠ é™æ€æ–‡ä»¶æœåŠ¡
location /uploads {
    alias /root/IEclub_dev/uploads;
    expires 7d;
    add_header Cache-Control "public, immutable";
}
```

**æ­¥éª¤3**: å®Œå–„upload.jsè·¯ç”±

**æ­¥éª¤4**: æµ‹è¯•å¹¶éƒ¨ç½²

---

## â“ éœ€è¦ç¡®è®¤çš„é—®é¢˜

1. **å›¾ç‰‡å­˜å‚¨æ–¹æ¡ˆç¡®è®¤**ï¼šæœ¬åœ°å­˜å‚¨ vs äº‘å­˜å‚¨ï¼Ÿ
2. **å›¾ç‰‡å¤§å°é™åˆ¶**ï¼šå¤´åƒ2MBï¼Œè¯é¢˜å›¾5MBæ˜¯å¦åˆé€‚ï¼Ÿ
3. **å‹ç¼©è´¨é‡**ï¼š80%è´¨é‡æ˜¯å¦å¯æ¥å—ï¼Ÿ
4. **ç§ä¿¡åŠŸèƒ½ä¼˜å…ˆçº§**ï¼šæ˜¯å¦éœ€è¦å°½å¿«å¼€å‘ï¼Ÿ
5. **å°ç¨‹åºåŒæ­¥**ï¼šå›¾ç‰‡ä¸Šä¼ æ˜¯å¦éœ€è¦åŒæ­¥åˆ°å°ç¨‹åºç«¯ï¼Ÿ

---

**ä¸‹ä¸€æ­¥**: è¯·ç¡®è®¤è®¾è®¡æ–¹æ¡ˆåï¼Œæˆ‘å°†å¼€å§‹å®ç°å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ã€‚
