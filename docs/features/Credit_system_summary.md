# ç§¯åˆ†ç³»ç»Ÿéƒ¨ç½²æ€»ç»“

## ğŸ“Š ç³»ç»Ÿæ¦‚è¿°

IEClub ç§¯åˆ†ç³»ç»Ÿå·²æˆåŠŸéƒ¨ç½²ä¸Šçº¿ï¼ŒåŒ…å«å®Œæ•´çš„ç­‰çº§ã€å‹‹ç« ã€ç­¾åˆ°å’Œæ’è¡Œæ¦œåŠŸèƒ½ã€‚

**éƒ¨ç½²æ—¥æœŸ**: 2025-10-31  
**çŠ¶æ€**: âœ… å…¨éƒ¨åŠŸèƒ½æ­£å¸¸è¿è¡Œ

---

## ğŸ—„ï¸ æ•°æ®åº“å˜æ›´

### 1. User è¡¨æ›´æ–°
æ–°å¢å­—æ®µï¼š
- `level` (Int, é»˜è®¤1) - ç”¨æˆ·ç­‰çº§
- `exp` (Int, é»˜è®¤0) - ç»éªŒå€¼
- `credits` (Int, é»˜è®¤0) - ç§¯åˆ†

### 2. æ–°å¢æ•°æ®è¡¨

#### Level (ç”¨æˆ·ç­‰çº§)
- 10ä¸ªç­‰çº§ä»æ–°æ‰‹åˆ°è£èª‰ä¼šå‘˜
- æ¯ä¸ªç­‰çº§æœ‰ä¸åŒçš„ç»éªŒå€¼è¦æ±‚å’Œæƒé™

#### Badge (å‹‹ç« )
- 13ç§å‹‹ç« æ¶µç›–æ´»è·ƒåº¦ã€å†…å®¹åˆ›ä½œã€ç¤¾äº¤äº’åŠ¨
- ç¨€æœ‰åº¦åˆ†çº§ï¼šcommonã€uncommonã€rareã€epicã€legendary

#### UserBadge (ç”¨æˆ·å‹‹ç« å…³è”)
- è®°å½•ç”¨æˆ·è·å¾—çš„å‹‹ç« å’Œè·å¾—æ—¶é—´

#### CheckIn (ç­¾åˆ°è®°å½•)
- æ¯æ—¥ç­¾åˆ°åŠŸèƒ½
- è¿ç»­ç­¾åˆ°å¤©æ•°ç»Ÿè®¡
- ç­¾åˆ°è·å¾—ç§¯åˆ†å¥–åŠ±

#### CreditLog (ç§¯åˆ†æ—¥å¿—)
- å®Œæ•´çš„ç§¯åˆ†å˜åŠ¨è®°å½•
- æ”¯æŒå¤šç§ç§¯åˆ†è·å–/æ¶ˆè€—åœºæ™¯
- åŒ…å«å…ƒæ•°æ®å’Œå…³è”ä¿¡æ¯

#### ExpLog (ç»éªŒå€¼æ—¥å¿—)
- ç»éªŒå€¼å˜åŠ¨è®°å½•
- æ”¯æŒç­‰çº§å‡çº§è¿½è¸ª

---

## ğŸš€ APIç«¯ç‚¹

### å…¬å¼€APIï¼ˆæ— éœ€è®¤è¯ï¼‰

#### 1. è·å–æ‰€æœ‰å‹‹ç« 
```
GET /api/credits/badges/all
```
**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è·å–å‹‹ç« åˆ—è¡¨æˆåŠŸ",
  "data": {
    "badges": [
      {
        "id": "badge_new",
        "code": "newcomer",
        "name": "æ–°äººæŠ¥åˆ°",
        "description": "å®Œæˆæ³¨å†Œå¹¶å®Œå–„ä¸ªäººä¿¡æ¯",
        "icon": "ğŸ‰",
        "category": "basic",
        "rarity": "common"
      }
      // ... æ›´å¤šå‹‹ç« 
    ]
  }
}
```

#### 2. ç­‰çº§æ’è¡Œæ¦œ
```
GET /api/credits/leaderboard/level?limit=50
```
**åŠŸèƒ½**: æŒ‰ç­‰çº§å’Œç»éªŒå€¼æ’åºçš„ç”¨æˆ·æ’è¡Œæ¦œ

#### 3. ç§¯åˆ†æ’è¡Œæ¦œ
```
GET /api/credits/leaderboard/credits?limit=50
```
**åŠŸèƒ½**: æŒ‰ç§¯åˆ†æ’åºçš„ç”¨æˆ·æ’è¡Œæ¦œ

---

### è®¤è¯APIï¼ˆéœ€è¦Bearer Tokenï¼‰

#### 4. è·å–ç”¨æˆ·ç§¯åˆ†ä¿¡æ¯
```
GET /api/credits/info
Authorization: Bearer <token>
```
**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "xxx",
      "nickname": "ç”¨æˆ·æ˜µç§°",
      "level": 1,
      "exp": 0,
      "credits": 0
    },
    "currentLevel": {
      "level": 1,
      "name": "æ–°æ‰‹",
      "minExp": 0,
      "maxExp": 99,
      "color": "#95A5A6"
    },
    "nextLevel": {
      "level": 2,
      "name": "åˆçº§ä¼šå‘˜",
      "minExp": 100,
      "maxExp": 299
    },
    "levelProgress": 0,
    "expToNextLevel": 100
  }
}
```

#### 5. è·å–ç­¾åˆ°çŠ¶æ€
```
GET /api/credits/check-in/status
Authorization: Bearer <token>
```
**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "checkedInToday": false,
    "consecutiveDays": 0,
    "totalCheckIns": 0,
    "todayCredits": 0
  }
}
```

#### 6. æ¯æ—¥ç­¾åˆ°
```
POST /api/credits/check-in
Authorization: Bearer <token>
```
**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç­¾åˆ°æˆåŠŸ",
  "data": {
    "id": "xxx",
    "checkInDate": "2025-10-31T00:00:00.000Z",
    "credits": 5,
    "consecutiveDays": 1,
    "totalCredits": 5
  }
}
```

#### 7. è·å–ç”¨æˆ·å‹‹ç« 
```
GET /api/credits/badges
GET /api/credits/badges/:userId
Authorization: Bearer <token>
```
**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "badges": [
      {
        "id": "xxx",
        "badgeId": "badge_new",
        "obtainedAt": "2025-10-31T07:00:00.000Z",
        "badge": {
          "name": "æ–°äººæŠ¥åˆ°",
          "icon": "ğŸ‰",
          "rarity": "common"
        }
      }
    ]
  }
}
```

#### 8. è·å–ç§¯åˆ†å†å²
```
GET /api/credits/history?limit=20&offset=0&action=daily_check_in
Authorization: Bearer <token>
```
**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "logs": [
      {
        "id": "xxx",
        "action": "daily_check_in",
        "amount": 5,
        "reason": "æ¯æ—¥ç­¾åˆ°",
        "createdAt": "2025-10-31T07:15:03.725Z"
      }
    ],
    "total": 1,
    "hasMore": false
  }
}
```

---

## ğŸ“ˆ ç§¯åˆ†è·å–æ–¹å¼

### æ¯æ—¥ç­¾åˆ°
- **åŸºç¡€å¥–åŠ±**: 5ç§¯åˆ†
- **è¿ç»­ç­¾åˆ°**: æ¯è¿ç»­ç­¾åˆ°7å¤©å¯è·å¾—é¢å¤–å¥–åŠ±
- **è‡ªåŠ¨è®¡ç®—**: ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—è¿ç»­ç­¾åˆ°å¤©æ•°

### å†…å®¹åˆ›ä½œ
- **å‘å¸ƒè¯é¢˜**: +10ç§¯åˆ† +5ç»éªŒ
- **å‘å¸ƒè¯„è®º**: +2ç§¯åˆ† +1ç»éªŒ

### ç¤¾äº¤äº’åŠ¨
- **è¢«ç‚¹èµ**: +1ç§¯åˆ†
- **æ”¶è—**: +3ç§¯åˆ†

### ç­‰çº§æå‡
- å‡çº§æ—¶è‡ªåŠ¨è®°å½•åˆ° ExpLog
- è¾¾åˆ°ç­‰çº§ä¸Šé™åï¼Œç»éªŒå€¼å¯ç»§ç»­ç´¯ç§¯

---

## ğŸ† ç­‰çº§ç³»ç»Ÿ

| ç­‰çº§ | åç§° | ç»éªŒå€¼èŒƒå›´ | é¢œè‰² | æƒé™ |
|------|------|------------|------|------|
| 1 | æ–°æ‰‹ | 0-99 | #95A5A6 | æ¯æ—¥5å¸–/20è¯„è®º |
| 2 | åˆçº§ä¼šå‘˜ | 100-299 | #3498DB | æ¯æ—¥10å¸–/50è¯„è®º |
| 3 | ä¸­çº§ä¼šå‘˜ | 300-599 | #2ECC71 | æ¯æ—¥15å¸–/100è¯„è®º |
| 4 | é«˜çº§ä¼šå‘˜ | 600-999 | #F39C12 | æ¯æ—¥20å¸–/200è¯„è®º |
| 5 | æ ¸å¿ƒä¼šå‘˜ | 1000-1999 | #E67E22 | æ¯æ—¥30å¸–/300è¯„è®º |
| 6 | èµ„æ·±ä¼šå‘˜ | 2000-3999 | #E74C3C | æ¯æ—¥50å¸–/500è¯„è®º |
| 7 | ä¸“å®¶ä¼šå‘˜ | 4000-7999 | #9B59B6 | æ¯æ—¥80å¸–/800è¯„è®º |
| 8 | å¤§å¸ˆä¼šå‘˜ | 8000-15999 | #1ABC9C | æ¯æ—¥100å¸–/1000è¯„è®º |
| 9 | ä¼ å¥‡ä¼šå‘˜ | 16000-31999 | #34495E | æ— é™åˆ¶ |
| 10 | è£èª‰ä¼šå‘˜ | 32000+ | #C0392B | æ— é™åˆ¶+ç‰¹æƒ |

---

## ğŸ–ï¸ å‹‹ç« ç³»ç»Ÿ

### åŸºç¡€å‹‹ç«  (Common)
- ğŸ‰ æ–°äººæŠ¥åˆ° - å®Œæˆæ³¨å†Œ
- ğŸ“ é¦–æ¬¡å‘å¸–
- ğŸ’¬ é¦–æ¬¡è¯„è®º

### ä¸å¸¸è§å‹‹ç«  (Uncommon)
- ğŸ“… å¸¸å®¢ - è¿ç»­ç­¾åˆ°7å¤©
- â¤ï¸ å—æ¬¢è¿ - è·å¾—100ä¸ªç‚¹èµ
- âœï¸ å¤šäº§ä½œè€… - å‘å¸ƒ10ä¸ªè¯é¢˜

### ç¨€æœ‰å‹‹ç«  (Rare)
- ğŸ”¥ æœˆåº¦æ´»è·ƒ - è¿ç»­ç­¾åˆ°30å¤©
- â­ ç¤¾åŒºä¹‹æ˜Ÿ - è·å¾—500ä¸ªç‚¹èµ
- ğŸ¨ å†…å®¹åˆ›ä½œè€… - å‘å¸ƒ50ä¸ªè¯é¢˜

### å²è¯—å‹‹ç«  (Epic)
- ğŸ’ ç™¾æ—¥åšæŒ - è¿ç»­ç­¾åˆ°100å¤©
- ğŸŒŸ ç¤¾åŒºåäºº - è·å¾—1000ä¸ªç‚¹èµ
- ğŸ‘‘ è¯é¢˜å¤§å¸ˆ - å‘å¸ƒ100ä¸ªè¯é¢˜

### ä¼ å¥‡å‹‹ç«  (Legendary)
- ğŸš€ æ—©æœŸç”¨æˆ· - å¹³å°ä¸Šçº¿åˆæœŸåŠ å…¥

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

1. **å…¬å¼€APIæµ‹è¯•**
   - âœ… è·å–æ‰€æœ‰å‹‹ç«  (13ä¸ªå‹‹ç« )
   - âœ… ç­‰çº§æ’è¡Œæ¦œ
   - âœ… ç§¯åˆ†æ’è¡Œæ¦œ

2. **è®¤è¯APIæµ‹è¯•**
   - âœ… ç”¨æˆ·ç§¯åˆ†ä¿¡æ¯æŸ¥è¯¢
   - âœ… ç­¾åˆ°çŠ¶æ€æŸ¥è¯¢
   - âœ… æ¯æ—¥ç­¾åˆ°åŠŸèƒ½
   - âœ… ç”¨æˆ·å‹‹ç« æŸ¥è¯¢
   - âœ… ç§¯åˆ†å†å²è®°å½•

3. **æ•°æ®å®Œæ•´æ€§**
   - âœ… æ•°æ®åº“è¿ç§»æˆåŠŸ
   - âœ… åˆå§‹æ•°æ®æ’å…¥æ­£ç¡®
   - âœ… å…³è”å…³ç³»æ­£å¸¸

---

## ğŸ“ æŠ€æœ¯å®ç°

### åç«¯æ¶æ„
- **Controller**: `creditController.js` - å¤„ç†æ‰€æœ‰ç§¯åˆ†ç›¸å…³è¯·æ±‚
- **Service**: `creditService.js` - ä¸šåŠ¡é€»è¾‘å®ç°
- **Routes**: `credits.js` - APIè·¯ç”±é…ç½®
- **Middleware**: `auth.js` - è®¤è¯ä¸­é—´ä»¶

### æ•°æ®åº“
- **ORM**: Prisma
- **æ•°æ®åº“**: MySQL
- **è¿ç§»æ–‡ä»¶**: `20251031000000_add_credit_system/migration.sql`

### å…³é”®ç‰¹æ€§
1. **äº‹åŠ¡å¤„ç†**: ç¡®ä¿ç§¯åˆ†å’Œç»éªŒå€¼å˜åŠ¨çš„åŸå­æ€§
2. **å¹¶å‘æ§åˆ¶**: é˜²æ­¢é‡å¤ç­¾åˆ°ç­‰é—®é¢˜
3. **è‡ªåŠ¨å‹‹ç« æˆäºˆ**: åç»­å¯å®ç°è‡ªåŠ¨æ£€æµ‹å¹¶æˆäºˆå‹‹ç« 
4. **çµæ´»çš„ç§¯åˆ†è§„åˆ™**: å¯é…ç½®ä¸åŒæ“ä½œçš„ç§¯åˆ†å¥–åŠ±

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

### 1. è‡ªåŠ¨å‹‹ç« æˆäºˆç³»ç»Ÿ
å®ç°åå°ä»»åŠ¡å®šæœŸæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ»¡è¶³å‹‹ç« æ¡ä»¶ï¼š
```javascript
// ç¤ºä¾‹ï¼šæ£€æŸ¥è¿ç»­ç­¾åˆ°å‹‹ç« 
async function checkCheckInBadges(userId) {
  const checkIns = await prisma.checkIn.findMany({
    where: { userId },
    orderBy: { checkInDate: 'desc' }
  });
  
  const consecutiveDays = calculateConsecutiveDays(checkIns);
  
  if (consecutiveDays >= 100) {
    await awardBadge(userId, 'badge_100_days');
  } else if (consecutiveDays >= 30) {
    await awardBadge(userId, 'badge_30_days');
  } else if (consecutiveDays >= 7) {
    await awardBadge(userId, 'badge_7_days');
  }
}
```

### 2. ç§¯åˆ†å•†åŸ
- ä½¿ç”¨ç§¯åˆ†å…‘æ¢è™šæ‹Ÿç‰©å“
- ç‰¹æ®Šæƒé™è´­ä¹°
- ç¤¾åŒºè£…é¥°å“

### 3. æˆå°±ä»»åŠ¡ç³»ç»Ÿ
- æ¯æ—¥ä»»åŠ¡
- æ¯å‘¨ä»»åŠ¡
- å­£åº¦æŒ‘æˆ˜

### 4. ç¤¾äº¤åŠŸèƒ½
- ç§¯åˆ†æ’è¡Œæ¦œå¥½å‹æ¯”è¾ƒ
- å‹‹ç« å±•ç¤ºå¢™
- æˆå°±åˆ†äº«

### 5. æ•°æ®åˆ†æ
- ç”¨æˆ·æ´»è·ƒåº¦åˆ†æ
- ç§¯åˆ†è·å–é€”å¾„ç»Ÿè®¡
- å‹‹ç« è·å¾—ç‡åˆ†æ

---

## ğŸ› ï¸ ç»´æŠ¤æŒ‡å—

### æ·»åŠ æ–°å‹‹ç« 
1. æ›´æ–° Prisma Schema
2. åˆ›å»ºæ•°æ®åº“è¿ç§»
3. åœ¨è¿ç§»ä¸­æ’å…¥æ–°å‹‹ç« æ•°æ®
4. å®ç°å‹‹ç« æˆäºˆé€»è¾‘

### è°ƒæ•´ç§¯åˆ†è§„åˆ™
ä¿®æ”¹ `creditService.js` ä¸­çš„ç§¯åˆ†å¥–åŠ±å€¼ï¼š
```javascript
// ç¤ºä¾‹
const CREDIT_REWARDS = {
  DAILY_CHECK_IN: 5,
  CREATE_TOPIC: 10,
  CREATE_COMMENT: 2,
  RECEIVE_LIKE: 1,
  // ... æ›´å¤šè§„åˆ™
};
```

### ç›‘æ§å’Œæ—¥å¿—
- ä½¿ç”¨ Winston è®°å½•æ‰€æœ‰ç§¯åˆ†å˜åŠ¨
- PM2 ç›‘æ§æœåŠ¡çŠ¶æ€
- å®šæœŸæ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æŸ¥çœ‹ï¼š
- APIæ–‡æ¡£: https://api.ieclub.online/docs
- é¡¹ç›®ä»“åº“: GitHub
- éƒ¨ç½²æ–‡æ¡£: `Deployment_guide.md`

---

**ğŸ‰ ç§¯åˆ†ç³»ç»Ÿéƒ¨ç½²æˆåŠŸï¼**

