<!--pages/plaza/index.wxml-->
<view class="plaza-page">
  <!-- æœªç™»å½•æç¤ºæ¨ªå¹… -->
  <view class="guest-banner" wx:if="{{!isLogin}}">
    <view class="guest-content">
      <view class="guest-left">
        <text class="guest-emoji">ğŸ‘‹</text>
        <view class="guest-info">
          <text class="guest-title">æ¬¢è¿æ¥åˆ° IEClub</text>
          <text class="guest-desc">ç™»å½•åå¯ä»¥å‘å¸ƒè¯é¢˜ã€å‚ä¸è®¨è®º</text>
        </view>
      </view>
      <view class="guest-actions">
        <button class="guest-btn login-btn" bindtap="goToLogin">ç™»å½•</button>
        <button class="guest-btn register-btn" bindtap="goToRegister">æ³¨å†Œ</button>
      </view>
    </view>
  </view>

  <!-- Tab åˆ‡æ¢æ  -->
  <view class="tab-bar">
    <view class="tab-container">
      <view 
        wx:for="{{tabs}}" 
        wx:key="id"
        class="tab-item {{activeTab === item.id ? 'active' : ''}}"
        data-tab="{{item.id}}"
        bindtap="switchTab"
      >
        <text class="tab-icon">{{item.icon}}</text>
        <text class="tab-label">{{item.label}}</text>
      </view>
    </view>
  </view>

  <!-- è¯é¢˜åˆ—è¡¨ -->
  <scroll-view 
    scroll-y 
    class="topic-list" 
    enable-back-to-top
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
    lower-threshold="100"
  >
    <!-- éª¨æ¶å±åŠ è½½ -->
    <view wx:if="{{loading && topics.length === 0}}" class="skeleton-container">
      <view wx:for="{{[1,2,3,4,5,6]}}" wx:key="*this" class="skeleton-card">
        <view class="skeleton-cover skeleton-shimmer"></view>
        <view class="skeleton-content">
          <view class="skeleton-title skeleton-shimmer"></view>
          <view class="skeleton-author">
            <view class="skeleton-avatar skeleton-shimmer"></view>
            <view class="skeleton-name skeleton-shimmer"></view>
          </view>
          <view class="skeleton-stats">
            <view class="skeleton-stat skeleton-shimmer"></view>
            <view class="skeleton-stat skeleton-shimmer"></view>
            <view class="skeleton-stat skeleton-shimmer"></view>
          </view>
        </view>
      </view>
    </view>

    <!-- è¯é¢˜åˆ—è¡¨ -->
    <view wx:else class="topic-grid">
      <view 
        wx:for="{{topics}}" 
        wx:key="id"
        class="topic-card"
        data-id="{{item.id}}"
        bindtap="onTopicTap"
        hover-class="topic-card-hover"
        hover-stay-time="100"
      >
        <!-- å°é¢ -->
        <view class="topic-cover topic-{{item.type}}">
          <text class="topic-emoji">{{item.cover}}</text>
          <!-- ç±»å‹æ ‡è¯† -->
          <view class="topic-type-badge">
            <text class="badge-icon">{{item.type === 'offer' ? 'ğŸ¤' : item.type === 'demand' ? 'ğŸ‘‚' : 'ğŸš€'}}</text>
            <text class="badge-label">{{item.type === 'offer' ? 'æˆ‘æ¥è®²' : item.type === 'demand' ? 'æƒ³å¬' : 'é¡¹ç›®'}}</text>
          </view>
        </view>

        <!-- å†…å®¹ -->
        <view class="topic-content">
          <text class="topic-title">{{item.title}}</text>
          
          <!-- ä½œè€…ä¿¡æ¯ -->
          <view class="topic-author">
            <text class="author-emoji">{{item.author.avatar || 'ğŸ‘¤'}}</text>
            <text class="author-name">{{item.author.name || 'åŒ¿åç”¨æˆ·'}}</text>
            <view class="author-level">
              <text class="level-text">LV{{item.author.level || 0}}</text>
            </view>
          </view>

          <!-- æ ‡ç­¾ -->
          <view class="topic-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <view wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag" class="tag-item">
              <text class="tag-text">{{tag}}</text>
            </view>
          </view>

          <!-- ç»Ÿè®¡ä¿¡æ¯ -->
          <view class="topic-footer">
            <view class="topic-stats">
              <view class="stat-item">
                <text class="stat-icon">ğŸ’¬</text>
                <text class="stat-text">{{item.stats.comments}}</text>
              </view>
              <view class="stat-item">
                <text class="stat-icon">ğŸ‘€</text>
                <text class="stat-text">{{item.stats.views}}</text>
              </view>
            </view>
            <!-- ç‚¹èµæŒ‰é’® -->
            <view 
              class="like-btn {{item.isLiked ? 'liked' : ''}}"
              data-id="{{item.id}}"
              data-index="{{index}}"
              catchtap="handleLike"
              hover-class="like-btn-hover"
            >
              <text class="like-icon">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
              <text class="like-count">{{item.stats.likes}}</text>
            </view>
          </view>

          <!-- æƒ³å¬è¿›åº¦æ¡ -->
          <view wx:if="{{item.type === 'demand' && item.stats.wantCount}}" class="want-progress">
            <view class="want-bar">
              <view class="want-fill" style="width: {{item.stats.wantCount / 15 * 100}}%"></view>
            </view>
            <text class="want-text">{{item.stats.wantCount}}/15äººæƒ³å¬</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{hasMore && !loading}}" class="load-more">
      <text class="load-more-text">åŠ è½½æ›´å¤š...</text>
    </view>
    
    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!hasMore && topics.length > 0}}" class="no-more">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && topics.length === 0}}" class="empty-state">
      <text class="empty-emoji">ğŸ“­</text>
      <text class="empty-title">æš‚æ— å†…å®¹</text>
      <text class="empty-desc">å¿«æ¥å‘å¸ƒç¬¬ä¸€ä¸ªè¯é¢˜å§ï¼</text>
      <button wx:if="{{isLogin}}" class="empty-btn" bindtap="goToPublish">å‘å¸ƒè¯é¢˜</button>
    </view>
  </scroll-view>
</view>

