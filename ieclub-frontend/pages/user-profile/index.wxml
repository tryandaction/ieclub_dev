<!--pages/user-profile/index.wxml-->
<view class="user-profile-page">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading-state">
    <text class="loading-icon">â³</text>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <view wx:else>
    <!-- å°é¢å’Œå¤´åƒ -->
    <view class="cover-section">
      <image 
        wx:if="{{profile.coverImage}}"
        class="cover-image" 
        src="{{profile.coverImage}}" 
        mode="aspectFill"
      />
      <view wx:else class="cover-placeholder"></view>
      
      <!-- ç¼–è¾‘æŒ‰é’®ï¼ˆä»…æœ¬äººå¯è§ï¼‰ -->
      <view wx:if="{{isOwner}}" class="edit-btn" bindtap="goToEditProfile">
        <text class="edit-icon">âœï¸</text>
        <text class="edit-text">ç¼–è¾‘èµ„æ–™</text>
      </view>
    </view>

    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="avatar-wrapper">
        <image 
          wx:if="{{profile.avatar}}"
          class="avatar" 
          src="{{profile.avatar}}" 
          mode="aspectFill"
        />
        <text wx:else class="avatar-placeholder">ğŸ‘¤</text>
      </view>

      <view class="user-info">
        <view class="name-row">
          <text class="nickname">{{profile.nickname}}</text>
          <text wx:if="{{profile.isCertified}}" class="cert-badge">âœ“ å·²è®¤è¯</text>
          <text class="level-badge">Lv.{{profile.level || 1}}</text>
        </view>

        <text wx:if="{{profile.motto}}" class="motto">"{{profile.motto}}"</text>
        <text wx:if="{{profile.bio}}" class="bio">{{profile.bio}}</text>

        <!-- å­¦æ ¡ä¿¡æ¯ -->
        <view wx:if="{{profile.school || profile.major || profile.grade}}" class="school-info">
          <text wx:if="{{profile.school}}" class="info-item">ğŸ« {{profile.school}}</text>
          <text wx:if="{{profile.major}}" class="info-item">ğŸ“š {{profile.major}}</text>
          <text wx:if="{{profile.grade}}" class="info-item">ğŸ“ {{profile.grade}}</text>
        </view>
      </view>

      <!-- ç»Ÿè®¡æ•°æ® -->
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-value">{{profile.topicsCount || 0}}</text>
          <text class="stat-label">å‘å¸ƒ</text>
        </view>
        <view class="stat-item" bindtap="goToFollowing">
          <text class="stat-value">{{profile.followsCount || 0}}</text>
          <text class="stat-label">å…³æ³¨</text>
        </view>
        <view class="stat-item" bindtap="goToFollowers">
          <text class="stat-value">{{profile.fansCount || 0}}</text>
          <text class="stat-label">ç²‰ä¸</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{profile.likesCount || 0}}</text>
          <text class="stat-label">è·èµ</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’®ï¼ˆéæœ¬äººï¼‰ -->
      <view wx:if="{{!isOwner}}" class="action-btns">
        <button class="follow-btn {{isFollowing ? 'following' : ''}}" bindtap="toggleFollow">
          <text wx:if="{{isFollowing}}">å·²å…³æ³¨</text>
          <text wx:else>+ å…³æ³¨</text>
        </button>
        <button class="message-btn" bindtap="sendMessage">
          <text class="btn-icon">ğŸ’¬</text>
          <text>ç§ä¿¡</text>
        </button>
      </view>
    </view>

    <!-- ç¤¾äº¤é“¾æ¥ -->
    <view wx:if="{{profile.website || profile.github || profile.bilibili || profile.wechat}}" class="social-section">
      <view class="section-title">ç¤¾äº¤é“¾æ¥</view>
      <view class="social-links">
        <view wx:if="{{profile.website}}" class="social-item" bindtap="copyText" data-text="{{profile.website}}" data-name="ç½‘ç«™é“¾æ¥">
          <text class="social-icon">ğŸŒ</text>
          <text class="social-text">ä¸ªäººç½‘ç«™</text>
        </view>
        <view wx:if="{{profile.github}}" class="social-item" bindtap="copyText" data-text="{{profile.github}}" data-name="GitHub">
          <text class="social-icon">ğŸ’»</text>
          <text class="social-text">GitHub</text>
        </view>
        <view wx:if="{{profile.bilibili}}" class="social-item" bindtap="copyText" data-text="{{profile.bilibili}}" data-name="Bç«™">
          <text class="social-icon">ğŸ“º</text>
          <text class="social-text">Bilibili</text>
        </view>
        <view wx:if="{{profile.wechat}}" class="social-item" bindtap="copyText" data-text="{{profile.wechat}}" data-name="å¾®ä¿¡å·">
          <text class="social-icon">ğŸ’¬</text>
          <text class="social-text">å¾®ä¿¡</text>
        </view>
      </view>
    </view>

    <!-- æŠ€èƒ½å’Œå…´è¶£ -->
    <view wx:if="{{(profile.skills && profile.skills.length > 0) || (profile.interests && profile.interests.length > 0)}}" class="tags-section">
      <view wx:if="{{profile.skills && profile.skills.length > 0}}" class="tag-group">
        <view class="section-title">âœ¨ æŠ€èƒ½</view>
        <view class="tags-container">
          <text 
            wx:for="{{profile.skills}}" 
            wx:key="*this"
            class="tag skill-tag"
          >{{item}}</text>
        </view>
      </view>

      <view wx:if="{{profile.interests && profile.interests.length > 0}}" class="tag-group">
        <view class="section-title">â¤ï¸ å…´è¶£</view>
        <view class="tags-container">
          <text 
            wx:for="{{profile.interests}}" 
            wx:key="*this"
            class="tag interest-tag"
          >{{item}}</text>
        </view>
      </view>
    </view>

    <!-- Tabå¯¼èˆª -->
    <view class="tabs-section">
      <view class="tab-header">
        <view 
          class="tab-item {{activeTab === 'posts' ? 'active' : ''}}"
          bindtap="switchTab"
          data-tab="posts"
        >
          <text class="tab-text">å‘å¸ƒå†…å®¹</text>
          <text class="tab-count">({{posts.length}})</text>
        </view>
        <view 
          class="tab-item {{activeTab === 'about' ? 'active' : ''}}"
          bindtap="switchTab"
          data-tab="about"
        >
          <text class="tab-text">å…³äºæˆ‘</text>
        </view>
        <view 
          class="tab-item {{activeTab === 'achievements' ? 'active' : ''}}"
          bindtap="switchTab"
          data-tab="achievements"
        >
          <text class="tab-text">æˆå°±</text>
        </view>
      </view>

      <!-- Tabå†…å®¹ -->
      <view class="tab-content">
        <!-- å‘å¸ƒå†…å®¹ -->
        <view wx:if="{{activeTab === 'posts'}}" class="posts-container">
          <view wx:if="{{posts.length > 0}}" class="posts-list">
            <view 
              wx:for="{{posts}}" 
              wx:key="id"
              class="post-item"
              bindtap="goToTopic"
              data-id="{{item.id}}"
            >
              <view class="post-title">{{item.title}}</view>
              <view class="post-meta">
                <text class="post-time">{{item.createdAt}}</text>
                <text class="post-stats">ğŸ‘ï¸ {{item.viewsCount}} Â· ğŸ‘ {{item.likesCount}} Â· ğŸ’¬ {{item.commentsCount}}</text>
              </view>
            </view>
          </view>
          <view wx:else class="empty-state">
            <text class="empty-icon">ğŸ“</text>
            <text class="empty-text">è¿˜æ²¡æœ‰å‘å¸ƒä»»ä½•å†…å®¹</text>
          </view>
        </view>

        <!-- å…³äºæˆ‘ -->
        <view wx:if="{{activeTab === 'about'}}" class="about-container">
          <view wx:if="{{profile.introduction}}" class="introduction">
            <text class="intro-text">{{profile.introduction}}</text>
          </view>
          <view wx:else class="empty-state">
            <text class="empty-icon">ğŸ“„</text>
            <text class="empty-text">è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡å†™</text>
          </view>
        </view>

        <!-- æˆå°± -->
        <view wx:if="{{activeTab === 'achievements'}}" class="achievements-container">
          <!-- å‹‹ç«  -->
          <view wx:if="{{profile.badges && profile.badges.length > 0}}" class="badges-grid">
            <view 
              wx:for="{{profile.badges}}" 
              wx:key="index"
              class="badge-item"
            >
              <text class="badge-icon">{{item.icon || 'ğŸ†'}}</text>
              <text class="badge-name">{{item.name}}</text>
              <text class="badge-date">{{item.awardedAt}}</text>
            </view>
          </view>

          <!-- ä¸ªäººæˆå°± -->
          <view wx:if="{{profile.achievements && profile.achievements.length > 0}}" class="achievements-list">
            <view class="section-title">ğŸ¯ ä¸ªäººæˆå°±</view>
            <view 
              wx:for="{{profile.achievements}}" 
              wx:key="index"
              class="achievement-item"
            >
              <text class="achievement-title">{{item.title}}</text>
              <text wx:if="{{item.description}}" class="achievement-desc">{{item.description}}</text>
            </view>
          </view>

          <view wx:if="{{(!profile.badges || profile.badges.length === 0) && (!profile.achievements || profile.achievements.length === 0)}}" class="empty-state">
            <text class="empty-icon">ğŸ…</text>
            <text class="empty-text">è¿˜æ²¡æœ‰è·å¾—ä»»ä½•æˆå°±</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
