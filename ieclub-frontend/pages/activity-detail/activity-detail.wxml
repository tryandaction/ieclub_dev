<!--pages/activity-detail/activity-detail.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ´»åŠ¨è¯¦æƒ… -->
  <view wx:else class="activity-detail">
    <!-- å°é¢å›¾ -->
    <view class="cover">
      <image 
        wx:if="{{activity.images && activity.images.length > 0}}"
        src="{{activity.images[0]}}" 
        mode="aspectFill"
        class="cover-image"
      />
      <view wx:else class="cover-placeholder">
        <text class="cover-icon">ğŸ‰</text>
      </view>
    </view>

    <!-- å†…å®¹åŒºåŸŸ -->}
    <view class="content">
      <!-- æ ‡é¢˜ -->
      <view class="title">{{activity.title}}</view>

      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <view class="info-grid">
        <view class="info-item">
          <text class="info-icon">ğŸ•</text>
          <view class="info-content">
            <text class="info-label">å¼€å§‹æ—¶é—´</text>
            <text class="info-value">{{activity.startTime}}</text>
          </view>
        </view>
        <view class="info-item">
          <text class="info-icon">ğŸ</text>
          <view class="info-content">
            <text class="info-label">ç»“æŸæ—¶é—´</text>
            <text class="info-value">{{activity.endTime}}</text>
          </view>
        </view>
        <view class="info-item">
          <text class="info-icon">ğŸ“</text>
          <view class="info-content">
            <text class="info-label">æ´»åŠ¨åœ°ç‚¹</text>
            <text class="info-value">{{activity.location}}</text>
          </view>
        </view>
        <view class="info-item">
          <text class="info-icon">ğŸ‘¥</text>
          <view class="info-content">
            <text class="info-label">å‚ä¸äººæ•°</text>
            <text class="info-value">{{activity.participantsCount || 0}}/{{activity.maxParticipants || 'ä¸é™'}}</text>
          </view>
        </view>
      </view>

      <!-- æ´»åŠ¨æè¿° -->
      <view class="section">
        <view class="section-title">æ´»åŠ¨ä»‹ç»</view>
        <text class="description">{{activity.description}}</text>
      </view>

      <!-- ç»„ç»‡è€…ä¿¡æ¯ -->
      <view wx:if="{{activity.organizer}}" class="organizer">
        <view class="section-title">ç»„ç»‡è€…</view>
        <view class="organizer-info">
          <block wx:if="{{activity.organizer.avatar && activity.organizer.avatar.length > 2}}">
            <image 
              src="{{activity.organizer.avatar.indexOf('http') === 0 ? activity.organizer.avatar : 'https://ieclub.online' + activity.organizer.avatar}}" 
              class="organizer-avatar"
              mode="aspectFill"
            />
          </block>
          <view wx:else class="organizer-avatar-placeholder">ğŸ‘¤</view>
          <view class="organizer-details">
            <text class="organizer-name">{{activity.organizer.nickname || 'æœªçŸ¥ç”¨æˆ·'}}</text>
            <text wx:if="{{activity.organizer.bio}}" class="organizer-bio">{{activity.organizer.bio}}</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="actions">
        <!-- æ™®é€šç”¨æˆ·æ“ä½œ -->
        <block wx:if="{{!isOrganizer}}">
          <button 
            class="btn {{isParticipating ? 'btn-secondary' : 'btn-primary'}}"
            bindtap="handleParticipate"
          >
            {{isParticipating ? 'å·²æŠ¥å' : 'ç«‹å³æŠ¥å'}}
          </button>

          <button 
            wx:if="{{isParticipating && !hasCheckedIn}}"
            class="btn btn-success"
            bindtap="handleScanCheckIn"
          >
            æ‰«ç ç­¾åˆ° âœ…
          </button>

          <view wx:if="{{hasCheckedIn}}" class="checked-in-badge">
            å·²ç­¾åˆ° âœ…
          </view>
        </block>

        <!-- ç»„ç»‡è€…æ“ä½œ -->
        <block wx:else>
          <button 
            class="btn btn-primary"
            bindtap="handleGenerateQRCode"
          >
            ç”Ÿæˆç­¾åˆ°äºŒç»´ç  ğŸ“±
          </button>
          <button 
            class="btn btn-info"
            bindtap="handleViewStats"
          >
            æŸ¥çœ‹ç­¾åˆ°ç»Ÿè®¡ ğŸ“Š
          </button>
        </block>
      </view>
    </view>
  </view>
</view>

