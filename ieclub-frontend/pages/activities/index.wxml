<!--pages/activities/index.wxml-->
<view class="activities-page">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <text class="title">ç²¾å½©æ´»åŠ¨</text>
  </view>

  <!-- çŠ¶æ€æ ‡ç­¾ -->
  <view class="tabs">
    <view 
      wx:for="{{statusTabs}}" 
      wx:key="key" 
      class="tab-item {{currentTab === index ? 'active' : ''}}"
      data-index="{{index}}"
      bindtap="switchTab"
    >
      {{item.label}}
    </view>
  </view>

  <!-- æ´»åŠ¨åˆ—è¡¨ -->
  <scroll-view 
    scroll-y 
    class="content"
    enable-back-to-top
    refresher-enabled
    refresher-triggered="{{loading && page === 1}}"
    bindrefresherrefresh="onPullDownRefresh"
  >
    <!-- Loading çŠ¶æ€ -->
    <view wx:if="{{loading && activities.length === 0}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- æ´»åŠ¨åˆ—è¡¨ -->
    <view wx:else class="activity-grid">
      <view 
        wx:for="{{activities}}" 
        wx:key="id" 
        class="activity-card"
        data-id="{{item.id}}"
        bindtap="goToDetail"
      >
        <!-- å°é¢ -->
        <view class="cover">
          <text class="emoji">{{item.cover}}</text>
        </view>

        <!-- ä¿¡æ¯ -->
        <view class="info">
          <text class="activity-title">{{item.title}}</text>
          <view class="activity-meta">
            <text class="meta-item">ğŸ• {{item.time}}</text>
            <text class="meta-item">ğŸ“ {{item.location}}</text>
            <text class="meta-item">ğŸ‘¥ {{item.participants.current}}/{{item.participants.max}}äºº</text>
          </view>

          <!-- æŠ¥åæŒ‰é’® -->
          <button 
            class="register-btn {{item.isParticipating ? 'registered' : ''}}"
            data-id="{{item.id}}"
            data-index="{{index}}"
            bindtap="handleParticipate"
            catchtap="handleParticipate"
          >
            {{item.isParticipating ? 'å·²æŠ¥å âœ“' : 'ç«‹å³æŠ¥å'}}
          </button>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{!loading && activities.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ“…</text>
        <text class="empty-text">æš‚æ— æ´»åŠ¨</text>
        <text class="empty-hint">æ•¬è¯·æœŸå¾…æ›´å¤šç²¾å½©æ´»åŠ¨</text>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{loading && activities.length > 0}}" class="load-more">
        <view class="loading-spinner small"></view>
        <text class="load-more-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤š -->
      <view wx:if="{{!loading && !hasMore && activities.length > 0}}" class="no-more">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>
  </scroll-view>
</view>

