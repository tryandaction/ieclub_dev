<!--pages/activities/index.wxml-->
<view class="activities-page">
  <!-- é¡¶éƒ¨æ ‡é¢˜å¡ç‰‡ -->
  <view class="header-card">
    <view class="header-content">
      <text class="header-title">ç²¾å½©æ´»åŠ¨</text>
      <text class="header-subtitle">å‚ä¸æ´»åŠ¨ï¼Œæ”¶è·æˆé•¿</text>
    </view>
    <view class="header-icon">ğŸ‰</view>
  </view>

  <!-- çŠ¶æ€æ ‡ç­¾ -->
  <view class="tabs-wrapper">
    <scroll-view scroll-x class="tabs-scroll" show-scrollbar="{{false}}">
      <view class="tabs">
        <view 
          wx:for="{{statusTabs}}" 
          wx:key="key" 
          class="tab-item {{currentTab === index ? 'active' : ''}}"
          data-index="{{index}}"
          data-key="{{item.key}}"
          bindtap="switchStatusTab"
          hover-class="tab-item-hover"
        >
          <text class="tab-label">{{item.label}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ´»åŠ¨åˆ—è¡¨ -->
  <scroll-view 
    scroll-y 
    class="content-scroll"
    enable-back-to-top
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
    lower-threshold="100"
  >
    <!-- éª¨æ¶å± -->
    <view wx:if="{{loading && activities.length === 0}}" class="skeleton-container">
      <view wx:for="{{[1,2,3,4]}}" wx:key="*this" class="skeleton-card">
        <view class="skeleton-cover skeleton-shimmer"></view>
        <view class="skeleton-content">
          <view class="skeleton-title skeleton-shimmer"></view>
          <view class="skeleton-meta">
            <view class="skeleton-meta-item skeleton-shimmer"></view>
            <view class="skeleton-meta-item skeleton-shimmer"></view>
            <view class="skeleton-meta-item skeleton-shimmer"></view>
          </view>
          <view class="skeleton-btn skeleton-shimmer"></view>
        </view>
      </view>
    </view>

    <!-- æ´»åŠ¨åˆ—è¡¨ -->
    <view wx:else class="activity-list">
      <view 
        wx:for="{{activities}}" 
        wx:key="id" 
        class="activity-card"
        data-id="{{item.id}}"
        bindtap="onActivityTap"
        hover-class="activity-card-hover"
        hover-stay-time="100"
      >
        <!-- å°é¢ -->
        <view class="activity-cover">
          <text class="cover-emoji">{{item.cover}}</text>
          <!-- çŠ¶æ€æ ‡ç­¾ -->
          <view wx:if="{{item.status}}" class="status-badge status-{{item.status}}">
            <text class="status-text">{{item.statusText || 'è¿›è¡Œä¸­'}}</text>
          </view>
        </view>

        <!-- å†…å®¹ -->
        <view class="activity-content">
          <text class="activity-title">{{item.title}}</text>
          
          <view class="activity-meta">
            <view class="meta-item">
              <text class="meta-icon">ğŸ•</text>
              <text class="meta-text">{{item.time}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">ğŸ“</text>
              <text class="meta-text">{{item.location}}</text>
            </view>
          </view>

          <!-- å‚ä¸è¿›åº¦ -->
          <view class="participants-section">
            <view class="participants-bar">
              <view class="participants-fill" style="width: {{item.participants.current / item.participants.max * 100}}%"></view>
            </view>
            <view class="participants-info">
              <text class="participants-count">ğŸ‘¥ {{item.participants.current}}/{{item.participants.max}}äºº</text>
              <text class="participants-percent">{{Math.floor(item.participants.current / item.participants.max * 100)}}%</text>
            </view>
          </view>

          <!-- æŠ¥åæŒ‰é’® -->
          <button 
            class="register-btn {{item.isParticipating ? 'registered' : ''}}"
            data-id="{{item.id}}"
            data-index="{{index}}"
            catchtap="toggleParticipate"
            hover-class="register-btn-hover"
          >
            <text class="btn-text">{{item.isParticipating ? 'å·²æŠ¥å âœ“' : 'ç«‹å³æŠ¥å'}}</text>
          </button>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{hasMore && !loading}}" class="load-more">
      <text class="load-more-text">åŠ è½½æ›´å¤š...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!hasMore && activities.length > 0}}" class="no-more">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && activities.length === 0}}" class="empty-state">
      <text class="empty-emoji">ğŸ“…</text>
      <text class="empty-title">æš‚æ— æ´»åŠ¨</text>
      <text class="empty-desc">æ•¬è¯·æœŸå¾…æ›´å¤šç²¾å½©æ´»åŠ¨</text>
    </view>
  </scroll-view>
</view>

