<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-content">
      <view class="header-title">å°ç»„åœˆå­</view>
      <view class="header-desc">å‘ç°å¿—åŒé“åˆçš„ä¼™ä¼´</view>
    </view>
    <view class="create-btn" bindtap="goToCreate">
      <text>â•</text>
      <text>åˆ›å»º</text>
    </view>
  </view>

  <!-- Tabåˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab {{activeTab === 'discover' ? 'active' : ''}}" 
      data-tab="discover"
      bindtap="switchTab"
    >
      ğŸ” å‘ç°
    </view>
    <view 
      class="tab {{activeTab === 'my' ? 'active' : ''}}" 
      data-tab="my"
      bindtap="switchTab"
    >
      ğŸ‘¥ æˆ‘çš„
    </view>
  </view>

  <!-- å‘ç°å°ç»„ -->
  <view wx:if="{{activeTab === 'discover'}}">
    <!-- æœç´¢æ¡† -->
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢å°ç»„" 
        value="{{keyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <view class="search-btn" bindtap="onSearch">æœç´¢</view>
    </view>

    <!-- åˆ†ç±»ç­›é€‰ -->
    <scroll-view class="categories" scroll-x>
      <view 
        wx:for="{{categories}}" 
        wx:key="value"
        class="category-item {{category === item.value ? 'active' : ''}}"
        data-category="{{item.value}}"
        bindtap="selectCategory"
      >
        {{item.icon}} {{item.label}}
      </view>
    </scroll-view>

    <!-- çƒ­é—¨å°ç»„ -->
    <view class="hot-section" wx:if="{{hotGroups.length > 0}}">
      <view class="section-title">ğŸ”¥ çƒ­é—¨å°ç»„</view>
      <scroll-view class="hot-list" scroll-x>
        <view 
          wx:for="{{hotGroups}}" 
          wx:key="id" 
          class="hot-item"
          data-id="{{item.id}}"
          bindtap="goToDetail"
        >
          <view class="hot-avatar">
            <image wx:if="{{item.avatar}}" src="{{item.avatar}}" mode="aspectFill" />
            <text wx:else>{{item.category === 'study' ? 'ğŸ“š' : item.category === 'tech' ? 'ğŸ’»' : 'ğŸ’¬'}}</text>
          </view>
          <view class="hot-name">{{item.name}}</view>
          <view class="hot-count">{{item.membersCount}}äºº</view>
        </view>
      </scroll-view>
    </view>

    <!-- å°ç»„åˆ—è¡¨ -->
    <view class="group-list">
      <view wx:if="{{loading && groups.length === 0}}" class="loading">
        <view class="loading-item" wx:for="{{[1,2,3]}}" wx:key="*this"></view>
      </view>

      <view wx:elif="{{groups.length === 0}}" class="empty">
        <text class="empty-icon">ğŸ”</text>
        <text class="empty-text">æš‚æ— å°ç»„</text>
      </view>

      <view wx:else>
        <view 
          wx:for="{{groups}}" 
          wx:key="id" 
          class="group-card"
          data-id="{{item.id}}"
          bindtap="goToDetail"
        >
          <view class="group-avatar">
            <image wx:if="{{item.avatar}}" src="{{item.avatar}}" mode="aspectFill" />
            <text wx:else class="avatar-icon">{{item.category === 'study' ? 'ğŸ“š' : item.category === 'tech' ? 'ğŸ’»' : item.category === 'interest' ? 'ğŸ¨' : 'ğŸ’¬'}}</text>
          </view>
          <view class="group-info">
            <view class="group-name">{{item.name}}</view>
            <view class="group-desc">{{item.description || 'æš‚æ— ç®€ä»‹'}}</view>
            <view class="group-stats">
              <text>ğŸ‘¥ {{item.membersCount}}</text>
              <text>ğŸ“ {{item.topicsCount}}</text>
            </view>
          </view>
          <view wx:if="{{item.isJoined}}" class="joined-tag">å·²åŠ å…¥</view>
          <view 
            wx:else 
            class="join-btn"
            data-id="{{item.id}}"
            data-need-approval="{{item.needApproval}}"
            catchtap="joinGroup"
          >
            {{item.needApproval ? 'ç”³è¯·' : 'åŠ å…¥'}}
          </view>
        </view>

        <view wx:if="{{loading}}" class="loading-more">åŠ è½½ä¸­...</view>
        <view wx:elif="{{!hasMore}}" class="no-more">æ²¡æœ‰æ›´å¤šäº†</view>
      </view>
    </view>
  </view>

  <!-- æˆ‘çš„å°ç»„ -->
  <view wx:else class="my-groups">
    <view wx:if="{{loading}}" class="loading">
      <view class="loading-item" wx:for="{{[1,2,3]}}" wx:key="*this"></view>
    </view>

    <view wx:elif="{{myGroups.length === 0}}" class="empty">
      <text class="empty-icon">ğŸ‘¥</text>
      <text class="empty-text">è¿˜æ²¡æœ‰åŠ å…¥ä»»ä½•å°ç»„</text>
      <view class="empty-btn" bindtap="switchTab" data-tab="discover">å»å‘ç°</view>
    </view>

    <view wx:else class="my-group-list">
      <view 
        wx:for="{{myGroups}}" 
        wx:key="id" 
        class="my-group-card"
        data-id="{{item.id}}"
        bindtap="goToDetail"
      >
        <view class="my-group-cover" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <image wx:if="{{item.cover}}" src="{{item.cover}}" mode="aspectFill" />
          <view class="role-tag {{item.myRole}}">
            {{item.myRole === 'owner' ? 'åˆ›å»ºè€…' : item.myRole === 'admin' ? 'ç®¡ç†å‘˜' : 'æˆå‘˜'}}
          </view>
        </view>
        <view class="my-group-avatar">
          <image wx:if="{{item.avatar}}" src="{{item.avatar}}" mode="aspectFill" />
          <text wx:else>{{item.category === 'study' ? 'ğŸ“š' : item.category === 'tech' ? 'ğŸ’»' : 'ğŸ’¬'}}</text>
        </view>
        <view class="my-group-info">
          <view class="my-group-name">{{item.name}}</view>
          <view class="my-group-stats">
            <text>ğŸ‘¥ {{item.membersCount}}</text>
            <text>ğŸ“ {{item.topicsCount}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
