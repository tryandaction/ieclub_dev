<view class="container" wx:if="{{group}}">
  <!-- å°é¢ -->
  <view class="cover" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <image wx:if="{{group.cover}}" src="{{group.cover}}" mode="aspectFill" />
  </view>

  <!-- å°ç»„ä¿¡æ¯å¡ç‰‡ -->
  <view class="info-card">
    <view class="info-header">
      <view class="avatar">
        <image wx:if="{{group.avatar}}" src="{{group.avatar}}" mode="aspectFill" />
        <text wx:else class="avatar-icon">{{getCategoryIcon(group.category)}}</text>
      </view>
      <view class="info-content">
        <view class="name">{{group.name}}</view>
        <view class="tags">
          <view class="tag category">{{getCategoryIcon(group.category)}} {{getCategoryLabel(group.category)}}</view>
          <view wx:if="{{!group.isPublic}}" class="tag private">ğŸ”’ ç§å¯†</view>
        </view>
      </view>
    </view>

    <!-- ç»Ÿè®¡ -->
    <view class="stats">
      <view class="stat-item">
        <view class="stat-value">{{group.membersCount}}</view>
        <view class="stat-label">æˆå‘˜</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{group.topicsCount}}</view>
        <view class="stat-label">è¯é¢˜</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{group.activitiesCount}}</view>
        <view class="stat-label">æ´»åŠ¨</view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions">
      <block wx:if="{{group.isJoined}}">
        <view wx:if="{{group.myRole !== 'owner'}}" class="btn btn-outline" bindtap="handleLeave">
          é€€å‡ºå°ç»„
        </view>
        <view class="btn btn-primary" bindtap="goToPost">
          âœï¸ å‘å¸ƒè¯é¢˜
        </view>
      </block>
      <block wx:elif="{{group.hasPendingRequest}}">
        <view class="btn btn-pending">ç”³è¯·å®¡æ ¸ä¸­</view>
      </block>
      <block wx:else>
        <view class="btn btn-primary full" bindtap="handleJoin">
          {{group.needApproval ? 'ç”³è¯·åŠ å…¥' : 'åŠ å…¥å°ç»„'}}
        </view>
      </block>
    </view>

    <!-- ç®€ä»‹ -->
    <view wx:if="{{group.description}}" class="description">
      <text>{{group.description}}</text>
    </view>

    <!-- åˆ›å»ºè€… -->
    <view class="creator">
      <image src="{{getAvatarUrl(group.creator.avatar)}}" class="creator-avatar" />
      <text>{{group.creator.nickname}} åˆ›å»ºäº {{formatTime(group.createdAt)}}</text>
    </view>
  </view>

  <!-- Tabåˆ‡æ¢ -->
  <view class="tab-bar">
    <view 
      class="tab-item {{activeTab === 'topics' ? 'active' : ''}}" 
      data-tab="topics"
      bindtap="switchTab"
    >
      ğŸ“ è¯é¢˜ ({{group.topicsCount}})
    </view>
    <view 
      class="tab-item {{activeTab === 'members' ? 'active' : ''}}" 
      data-tab="members"
      bindtap="switchTab"
    >
      ğŸ‘¥ æˆå‘˜ ({{group.membersCount}})
    </view>
  </view>

  <!-- å†…å®¹åŒº -->
  <view class="content">
    <!-- è¯é¢˜åˆ—è¡¨ -->
    <view wx:if="{{activeTab === 'topics'}}">
      <view wx:if="{{topics.length === 0}}" class="empty">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">è¿˜æ²¡æœ‰è¯é¢˜</text>
      </view>

      <view wx:else class="topic-list">
        <view wx:for="{{topics}}" wx:key="id" class="topic-card">
          <view class="topic-header">
            <image src="{{getAvatarUrl(item.author.avatar)}}" class="author-avatar" />
            <view class="author-info">
              <view class="author-name">{{item.author.nickname}}</view>
              <view class="topic-time">{{formatTime(item.createdAt)}}</view>
            </view>
            <view wx:if="{{item.isPinned}}" class="pin-tag">ç½®é¡¶</view>
          </view>
          <view class="topic-title">{{item.title}}</view>
          <view class="topic-content">{{item.content}}</view>
          
          <!-- å›¾ç‰‡ -->
          <view wx:if="{{item.images && item.images.length > 0}}" class="topic-images">
            <image 
              wx:for="{{item.images}}" 
              wx:for-item="img" 
              wx:key="*this"
              wx:if="{{index < 3}}"
              src="{{img}}" 
              mode="aspectFill"
            />
            <view wx:if="{{item.images.length > 3}}" class="more-images">
              +{{item.images.length - 3}}
            </view>
          </view>

          <view class="topic-stats">
            <text>ğŸ‘ï¸ {{item.viewsCount}}</text>
            <text>â¤ï¸ {{item.likesCount}}</text>
            <text>ğŸ’¬ {{item.commentsCount}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æˆå‘˜åˆ—è¡¨ -->
    <view wx:else class="member-list">
      <view 
        wx:for="{{members}}" 
        wx:key="id" 
        class="member-card"
        data-user-id="{{item.user.id}}"
        bindtap="goToMember"
      >
        <view class="member-avatar-wrap">
          <image src="{{getAvatarUrl(item.user.avatar)}}" class="member-avatar" />
          <view wx:if="{{item.role !== 'member'}}" class="role-badge {{item.role}}">
            {{item.role === 'owner' ? 'åˆ›' : 'ç®¡'}}
          </view>
        </view>
        <view class="member-name">{{item.nickname || item.user.nickname}}</view>
        <view class="member-level">Lv.{{item.user.level || 1}}</view>
      </view>
    </view>
  </view>
</view>

<!-- åŠ è½½ä¸­ -->
<view wx:else class="loading-container">
  <view class="loading-spinner"></view>
  <text>åŠ è½½ä¸­...</text>
</view>
