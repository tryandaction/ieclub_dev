<!--pages/community/index.wxml-->
<view class="community-page">
  <!-- é¡¶éƒ¨æ ‡é¢˜å¡ç‰‡ -->
  <view class="header-card">
    <view class="header-content">
      <text class="header-title">å‘ç°ä¼™ä¼´</text>
      <text class="header-subtitle">æ‰¾åˆ°å¿—åŒé“åˆçš„å­¦ä¹ ä¼™ä¼´</text>
    </view>
    <view class="header-icon">ğŸ¤</view>
  </view>

  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <scroll-view 
    scroll-y 
    class="content-scroll"
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
    lower-threshold="100"
    enable-back-to-top
  >
    <!-- éª¨æ¶å± -->
    <view wx:if="{{loading && users.length === 0}}" class="skeleton-container">
      <view wx:for="{{[1,2,3,4,5,6]}}" wx:key="*this" class="skeleton-card">
        <view class="skeleton-avatar skeleton-shimmer"></view>
        <view class="skeleton-name skeleton-shimmer"></view>
        <view class="skeleton-major skeleton-shimmer"></view>
        <view class="skeleton-stats">
          <view class="skeleton-stat skeleton-shimmer"></view>
          <view class="skeleton-stat skeleton-shimmer"></view>
        </view>
        <view class="skeleton-btn skeleton-shimmer"></view>
      </view>
    </view>

    <!-- ç”¨æˆ·ç½‘æ ¼ -->
    <view wx:else class="user-grid">
      <view 
        wx:for="{{users}}" 
        wx:key="id" 
        class="user-card"
        data-id="{{item.id}}"
        bindtap="viewUserDetail"
        hover-class="user-card-hover"
        hover-stay-time="100"
      >
        <!-- å¤´åƒ -->
        <view class="avatar-wrapper">
          <block wx:if="{{item.avatar && item.avatar.length > 2}}">
            <image 
              class="avatar-img" 
              src="{{item.avatar.indexOf('http') === 0 ? item.avatar : 'https://ieclub.online' + item.avatar}}" 
              mode="aspectFill"
            />
          </block>
          <text wx:else class="avatar">ğŸ‘¤</text>
          <!-- åœ¨çº¿çŠ¶æ€æŒ‡ç¤ºå™¨ -->
          <view wx:if="{{item.online}}" class="online-dot"></view>
        </view>

        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <view class="user-info">
          <text class="name">{{item.nickname || item.name || 'æœªè®¾ç½®æ˜µç§°'}}</text>
          <text class="major">{{item.major || 'æœªè®¾ç½®ä¸“ä¸š'}} Â· {{item.grade || 'æœªè®¾ç½®å¹´çº§'}}</text>
        </view>

        <!-- ç­‰çº§å’Œç§¯åˆ† -->
        <view class="user-stats">
          <view class="stat-badge level-badge">
            <text class="badge-text">LV{{item.level}}</text>
          </view>
          <view class="stat-badge score-badge">
            <text class="badge-icon">â­</text>
            <text class="badge-text">{{item.score}}</text>
          </view>
        </view>

        <!-- æ ‡ç­¾ -->
        <view wx:if="{{item.tags && item.tags.length > 0}}" class="user-tags">
          <view wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag" class="tag-item">
            <text class="tag-text">{{tag}}</text>
          </view>
        </view>

        <!-- å…³æ³¨æŒ‰é’® -->
        <button 
          class="follow-btn {{item.isFollowing ? 'following' : ''}}" 
          bindtap="toggleFollow" 
          data-index="{{index}}"
          data-id="{{item.id}}"
          catchtap="toggleFollow"
          hover-class="follow-btn-hover"
        >
          <text class="btn-text">{{item.isFollowing ? 'å·²å…³æ³¨' : '+ å…³æ³¨'}}</text>
        </button>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{hasMore && !loading}}" class="load-more">
      <text class="load-more-text">åŠ è½½æ›´å¤š...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!hasMore && users.length > 0}}" class="no-more">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && users.length === 0}}" class="empty-state">
      <text class="empty-emoji">ğŸ‘¥</text>
      <text class="empty-title">æš‚æ— ç”¨æˆ·</text>
      <text class="empty-desc">å¿«æ¥æˆä¸ºç¬¬ä¸€ä¸ªç”¨æˆ·å§ï¼</text>
    </view>
  </scroll-view>
</view>

