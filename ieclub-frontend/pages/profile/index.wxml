<!--pages/profile/index.wxml-->
<view class="profile-page">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view wx:if="{{!isLogin}}" class="guest-view">
    <view class="guest-card">
      <text class="guest-avatar">ğŸ‘¤</text>
      <text class="guest-title">æ¬¢è¿æ¥åˆ° IEClub</text>
      <text class="guest-desc">ç™»å½•åå¯ä»¥å‘å¸ƒè¯é¢˜ã€å‚ä¸è®¨è®ºã€ç»“è¯†ä¼™ä¼´</text>
      <button class="login-btn" bindtap="goToLogin">ç«‹å³ç™»å½•</button>
    </view>
  </view>

  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <view wx:else class="logged-in-view">
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="user-card">
      <view class="user-header">
        <view class="avatar-wrapper" bindtap="goToEditProfile">
          <block wx:if="{{user.avatar && user.avatar.length > 2}}">
            <image 
              class="avatar-img" 
              src="{{user.avatar.indexOf('http') === 0 ? user.avatar : 'https://ieclub.online' + user.avatar}}" 
              mode="aspectFill"
            />
          </block>
          <text wx:else class="avatar-placeholder">ğŸ‘¤</text>
        </view>
        <view class="user-info">
          <text class="user-name">{{user.nickname || user.name || 'æœªè®¾ç½®æ˜µç§°'}}</text>
          <text class="user-email">{{user.email}}</text>
          <text class="user-detail">{{user.major || 'æœªè®¾ç½®ä¸“ä¸š'}} {{user.grade ? 'Â· ' + user.grade : ''}}</text>
        </view>
        <view class="edit-profile-btn" bindtap="goToEditProfile">
          <text class="edit-icon">âœï¸</text>
        </view>
      </view>
      
      <!-- ç­‰çº§å’Œç§¯åˆ† -->
      <view class="user-badges">
        <view class="badge level-badge">
          <text class="badge-text">LV{{user.level || 1}}</text>
        </view>
        <view class="badge score-badge">
          <text class="badge-icon">â­</text>
          <text class="badge-text">{{user.score || 0}}</text>
        </view>
      </view>
    </view>

    <!-- ç»Ÿè®¡æ•°æ® -->
    <view class="stats-card">
      <view class="stat-item" bindtap="goToMyTopics">
        <text class="stat-value">{{stats.topics || 0}}</text>
        <text class="stat-label">è¯é¢˜</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item" bindtap="goToFollowers">
        <text class="stat-value">{{stats.followers || 0}}</text>
        <text class="stat-label">ç²‰ä¸</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item" bindtap="goToFollowing">
        <text class="stat-value">{{stats.following || 0}}</text>
        <text class="stat-label">å…³æ³¨</text>
      </view>
    </view>

    <!-- åŠŸèƒ½èœå• -->
    <view class="menu-section">
      <!-- æ¶ˆæ¯é€šçŸ¥å’Œç§ä¿¡ -->
      <view class="menu-group">
        <view class="menu-item notification-item" bindtap="goToNotifications" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">ğŸ””</text>
            <text class="menu-label">æ¶ˆæ¯é€šçŸ¥</text>
          </view>
          <view class="menu-right">
            <view class="unread-badge" wx:if="{{unreadCount > 0}}">{{unreadCount > 99 ? '99+' : unreadCount}}</view>
            <text class="menu-arrow">â€º</text>
          </view>
        </view>
        <view class="menu-item" bindtap="goToMessages" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">ğŸ’¬</text>
            <text class="menu-label">ç§ä¿¡</text>
          </view>
          <view class="menu-right">
            <view class="unread-badge" wx:if="{{messageUnread > 0}}">{{messageUnread > 99 ? '99+' : messageUnread}}</view>
            <text class="menu-arrow">â€º</text>
          </view>
        </view>
      </view>

      <!-- ä¸ªäººä¸»é¡µå’Œç¼–è¾‘èµ„æ–™ -->
      <view class="menu-group">
        <view class="menu-item" bindtap="goToMyProfile" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">ğŸ‘¤</text>
            <text class="menu-label">ä¸ªäººä¸»é¡µ</text>
          </view>
          <view class="menu-right">
            <text class="menu-desc">æŸ¥çœ‹æˆ‘çš„ä¸»é¡µ</text>
            <text class="menu-arrow">â€º</text>
          </view>
        </view>
        <view class="menu-item" bindtap="goToEditProfile" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">âœï¸</text>
            <text class="menu-label">ç¼–è¾‘èµ„æ–™</text>
          </view>
          <view class="menu-right">
            <text class="menu-desc">ä¿®æ”¹ä¸ªäººä¿¡æ¯</text>
            <text class="menu-arrow">â€º</text>
          </view>
        </view>
      </view>

      <!-- å†…å®¹ç®¡ç† -->
      <view class="menu-group">
        <view class="menu-item" bindtap="goToMyTopics" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">ğŸ“</text>
            <text class="menu-label">æˆ‘çš„è¯é¢˜</text>
          </view>
          <text class="menu-arrow">â€º</text>
        </view>
        <view class="menu-item" bindtap="goToFavorites" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">â¤ï¸</text>
            <text class="menu-label">æˆ‘çš„æ”¶è—</text>
          </view>
          <text class="menu-arrow">â€º</text>
        </view>
        <view class="menu-item" bindtap="goToParticipated" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">ğŸ‰</text>
            <text class="menu-label">æˆ‘çš„æ´»åŠ¨</text>
          </view>
          <text class="menu-arrow">â€º</text>
        </view>
        <view class="menu-item" bindtap="goToMyStats" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">ğŸ“ˆ</text>
            <text class="menu-label">æ•°æ®ç»Ÿè®¡</text>
          </view>
          <text class="menu-arrow">â€º</text>
        </view>
      </view>

      <!-- ç¤¾äº¤ -->
      <view class="menu-group">
        <view class="menu-item" bindtap="goToFollowing" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">ğŸ‘¥</text>
            <text class="menu-label">å…³æ³¨åˆ—è¡¨</text>
          </view>
          <view class="menu-right">
            <text class="menu-badge">{{stats.following || 0}}</text>
            <text class="menu-arrow">â€º</text>
          </view>
        </view>
        <view class="menu-item" bindtap="goToFollowers" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">ğŸ’–</text>
            <text class="menu-label">ç²‰ä¸åˆ—è¡¨</text>
          </view>
          <view class="menu-right">
            <text class="menu-badge">{{stats.followers || 0}}</text>
            <text class="menu-arrow">â€º</text>
          </view>
        </view>
        <view class="menu-item" bindtap="goToSettings" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">âš™ï¸</text>
            <text class="menu-label">è®¾ç½®</text>
          </view>
          <text class="menu-arrow">â€º</text>
        </view>
      </view>

      <view class="menu-group">
        <view class="menu-item" bindtap="goToFeedback" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">ğŸ’¬</text>
            <text class="menu-label">æ„è§åé¦ˆ</text>
          </view>
          <text class="menu-arrow">â€º</text>
        </view>
        <view class="menu-item" bindtap="goToAbout" hover-class="menu-item-hover">
          <view class="menu-left">
            <text class="menu-icon">â„¹ï¸</text>
            <text class="menu-label">å…³äºæˆ‘ä»¬</text>
          </view>
          <text class="menu-arrow">â€º</text>
        </view>
      </view>
    </view>

    <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
    <view class="logout-section">
      <button class="logout-btn" bindtap="handleLogout" hover-class="logout-btn-hover">
        <text class="logout-text">é€€å‡ºç™»å½•</text>
      </button>
    </view>
  </view>
</view>
