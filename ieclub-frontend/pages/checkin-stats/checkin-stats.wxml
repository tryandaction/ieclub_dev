<!--pages/checkin-stats/checkin-stats.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç»Ÿè®¡å†…å®¹ -->
  <view wx:else class="content">
    <!-- æ ‡é¢˜ -->
    <view class="header">
      <text class="title">{{stats.activityTitle}}</text>
      <text class="subtitle">ç­¾åˆ°ç»Ÿè®¡</text>
    </view>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-grid">
      <view class="stat-card stat-total">
        <text class="stat-value">{{stats.totalParticipants}}</text>
        <text class="stat-label">æ€»æŠ¥å</text>
      </view>
      <view class="stat-card stat-checked">
        <text class="stat-value">{{stats.checkedInCount}}</text>
        <text class="stat-label">å·²ç­¾åˆ°</text>
      </view>
      <view class="stat-card stat-unchecked">
        <text class="stat-value">{{stats.notCheckedInCount}}</text>
        <text class="stat-label">æœªç­¾åˆ°</text>
      </view>
      <view class="stat-card stat-rate">
        <text class="stat-value">{{stats.checkInRate}}%</text>
        <text class="stat-label">ç­¾åˆ°ç‡</text>
      </view>
    </view>

    <!-- ç­›é€‰å™¨ -->
    <view class="filters">
      <view class="search-box">
        <input 
          class="search-input"
          placeholder="æœç´¢å§“åæˆ–é‚®ç®±"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
        />
      </view>
      <view class="filter-tabs">
        <view 
          class="filter-tab {{filterType === 'all' ? 'active' : ''}}"
          data-type="all"
          bindtap="onFilterChange"
        >
          å…¨éƒ¨ ({{stats.totalParticipants}})
        </view>
        <view 
          class="filter-tab {{filterType === 'checked' ? 'active' : ''}}"
          data-type="checked"
          bindtap="onFilterChange"
        >
          å·²ç­¾åˆ° ({{stats.checkedInCount}})
        </view>
        <view 
          class="filter-tab {{filterType === 'unchecked' ? 'active' : ''}}"
          data-type="unchecked"
          bindtap="onFilterChange"
        >
          æœªç­¾åˆ° ({{stats.notCheckedInCount}})
        </view>
      </view>
    </view>

    <!-- å‚ä¸è€…åˆ—è¡¨ -->
    <view class="participants-list">
      <view wx:if="{{filteredParticipants.length === 0}}" class="empty">
        <text class="empty-icon">ğŸ”</text>
        <text class="empty-text">æš‚æ— æ•°æ®</text>
      </view>

      <view 
        wx:for="{{filteredParticipants}}" 
        wx:key="userId"
        class="participant-item"
      >
        <image 
          src="{{item.avatar || '/images/default-avatar.png'}}"
          class="participant-avatar"
        />
        <view class="participant-info">
          <view class="participant-name">{{item.nickname}}</view>
          <view class="participant-email">{{item.email}}</view>
          <view class="participant-time">
            æŠ¥å: {{formatTime(item.joinedAt)}}
          </view>
          <view wx:if="{{item.checkedIn}}" class="participant-time">
            ç­¾åˆ°: {{formatTime(item.checkedInAt)}}
          </view>
        </view>
        <view class="participant-status">
          <view wx:if="{{item.checkedIn}}" class="status-badge status-checked">
            å·²ç­¾åˆ° âœ…
          </view>
          <view wx:else class="status-badge status-unchecked">
            æœªç­¾åˆ°
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions">
      <button class="btn btn-secondary" bindtap="exportData">
        å¯¼å‡ºæ•°æ® ğŸ“Š
      </button>
      <button class="btn btn-primary" open-type="share">
        åˆ†äº«ç»Ÿè®¡ ğŸ“¤
      </button>
    </view>
  </view>
</view>

