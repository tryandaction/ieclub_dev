<!--pages/feedback/index.wxml-->
<view class="feedback-page">
  <!-- Tabåˆ‡æ¢ -->
  <view class="tabs-header">
    <view 
      wx:for="{{tabs}}" 
      wx:key="*this"
      class="tab-item {{currentTab === index ? 'active' : ''}}"
      bindtap="switchTab"
      data-index="{{index}}"
    >
      <text class="tab-text">{{item}}</text>
      <view wx:if="{{currentTab === index}}" class="tab-indicator"></view>
    </view>
  </view>

  <!-- æäº¤åé¦ˆTab -->
  <view wx:if="{{currentTab === 0}}" class="submit-tab">
    <!-- åé¦ˆç±»å‹é€‰æ‹© -->
    <view class="section">
      <view class="section-title">
        <text class="required">*</text>
        <text>åé¦ˆç±»å‹</text>
      </view>
      <view class="types-grid">
        <view 
          wx:for="{{types}}"
          wx:key="value"
          class="type-card {{form.type === item.value ? 'active' : ''}}"
          bindtap="selectType"
          data-type="{{item.value}}"
        >
          <text class="type-icon">{{item.icon}}</text>
          <text class="type-label">{{item.label}}</text>
          <text class="type-desc">{{item.desc}}</text>
        </view>
      </view>
    </view>

    <!-- æ ‡é¢˜ -->
    <view class="section">
      <view class="section-title">
        <text class="required">*</text>
        <text>æ ‡é¢˜</text>
        <text class="title-tip">(5-100å­—ç¬¦)</text>
      </view>
      <input 
        class="input-field"
        placeholder="ç®€è¦æè¿°ä½ çš„é—®é¢˜æˆ–å»ºè®®"
        value="{{form.title}}"
        maxlength="100"
        bindinput="onTitleInput"
      />
      <view class="char-count">{{form.title.length}}/100</view>
    </view>

    <!-- å†…å®¹ -->
    <view class="section">
      <view class="section-title">
        <text class="required">*</text>
        <text>è¯¦ç»†æè¿°</text>
        <text class="title-tip">(10-2000å­—ç¬¦)</text>
      </view>
      <textarea 
        class="textarea-field"
        placeholder="è¯·è¯¦ç»†æè¿°é—®é¢˜çš„å…·ä½“æƒ…å†µã€å¤ç°æ­¥éª¤æˆ–åŠŸèƒ½å»ºè®®..."
        value="{{form.content}}"
        maxlength="2000"
        auto-height
        bindinput="onContentInput"
      />
      <view class="char-count">{{form.content.length}}/2000</view>
    </view>

    <!-- ä¸Šä¼ å›¾ç‰‡ -->
    <view class="section">
      <view class="section-title">
        <text>æˆªå›¾/é™„ä»¶</text>
        <text class="title-tip">(å¯é€‰ï¼Œæœ€å¤š5å¼ )</text>
      </view>
      <view class="images-container">
        <view 
          wx:for="{{form.images}}"
          wx:key="*this"
          class="image-item"
        >
          <image 
            class="preview-image" 
            src="{{item}}" 
            mode="aspectFill"
            bindtap="previewImage"
            data-url="{{item}}"
          />
          <view 
            class="delete-btn"
            catchtap="deleteImage"
            data-index="{{index}}"
          >
            <text class="delete-icon">Ã—</text>
          </view>
        </view>
        
        <view 
          wx:if="{{form.images.length < 5}}"
          class="add-image-btn"
          bindtap="chooseImage"
        >
          <text class="add-icon">+</text>
          <text class="add-text">æ·»åŠ å›¾ç‰‡</text>
        </view>
      </view>
    </view>

    <!-- è”ç³»æ–¹å¼ -->
    <view class="section">
      <view class="section-title">
        <text>è”ç³»æ–¹å¼</text>
        <text class="title-tip">(å¯é€‰)</text>
      </view>
      <input 
        class="input-field"
        placeholder="é‚®ç®±æˆ–å¾®ä¿¡å·ï¼Œä¾¿äºæˆ‘ä»¬è”ç³»ä½ "
        value="{{form.contact}}"
        maxlength="100"
        bindinput="onContactInput"
      />
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-section">
      <button 
        class="submit-btn {{submitting ? 'submitting' : ''}}"
        bindtap="submitFeedback"
        disabled="{{submitting}}"
      >
        <text wx:if="{{submitting}}">æäº¤ä¸­...</text>
        <text wx:else>æäº¤åé¦ˆ</text>
      </button>
      <view class="submit-tip">
        <text class="tip-icon">ğŸ’¡</text>
        <text>æ„Ÿè°¢ä½ çš„åé¦ˆï¼Œæˆ‘ä»¬ä¼šè®¤çœŸå¤„ç†æ¯ä¸€æ¡æ„è§</text>
      </view>
    </view>
  </view>

  <!-- æˆ‘çš„åé¦ˆTab -->
  <view wx:if="{{currentTab === 1}}" class="my-feedback-tab">
    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="loading-state">
      <text class="loading-icon">â³</text>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- åé¦ˆåˆ—è¡¨ -->
    <view wx:elif="{{myFeedbacks.length > 0}}" class="feedback-list">
      <view 
        wx:for="{{myFeedbacks}}"
        wx:key="id"
        class="feedback-card"
        bindtap="viewFeedbackDetail"
        data-id="{{item.id}}"
        hover-class="feedback-card-hover"
      >
        <!-- å¤´éƒ¨ -->
        <view class="feedback-header">
          <view class="feedback-type">
            <text class="type-icon">{{item.type === 'bug' ? 'ğŸ›' : item.type === 'feature' ? 'ğŸ’¡' : item.type === 'improvement' ? 'âœ¨' : 'ğŸ’¬'}}</text>
          </view>
          <view class="feedback-status status-{{item.statusColor}}">
            <text>{{item.statusText}}</text>
          </view>
        </view>

        <!-- æ ‡é¢˜ -->
        <view class="feedback-title">{{item.title}}</view>

        <!-- å†…å®¹é¢„è§ˆ -->
        <view class="feedback-content">{{item.content}}</view>

        <!-- åº•éƒ¨ä¿¡æ¯ -->
        <view class="feedback-footer">
          <text class="feedback-time">{{item.timeText}}</text>
          <view 
            class="delete-feedback-btn"
            catchtap="deleteFeedback"
            data-id="{{item.id}}"
            data-index="{{index}}"
          >
            <text>åˆ é™¤</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-title">è¿˜æ²¡æœ‰æäº¤è¿‡åé¦ˆ</text>
      <text class="empty-desc">æ¬¢è¿æå‡ºä½ çš„å®è´µæ„è§</text>
      <button class="empty-btn" bindtap="switchTab" data-index="0">
        <text>å»æäº¤åé¦ˆ</text>
      </button>
    </view>
  </view>
</view>
