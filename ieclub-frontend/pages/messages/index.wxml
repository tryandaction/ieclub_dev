<!-- pages/messages/index.wxml -->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <text class="title">ç§ä¿¡</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading && conversations.length === 0}}" class="loading">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¼šè¯åˆ—è¡¨ -->
  <view wx:elif="{{conversations.length > 0}}" class="conversation-list">
    <view 
      wx:for="{{conversations}}" 
      wx:key="id" 
      class="conversation-item"
      bindtap="goToChat"
      data-id="{{item.id}}"
      data-user="{{item.otherUser}}"
    >
      <view class="avatar-wrapper">
        <image 
          class="avatar" 
          src="{{item.otherUser.avatar || '/images/default-avatar.png'}}" 
          mode="aspectFill"
        />
        <view wx:if="{{item.unreadCount > 0}}" class="badge">
          {{item.unreadCount > 99 ? '99+' : item.unreadCount}}
        </view>
      </view>
      
      <view class="content">
        <view class="top-row">
          <text class="nickname">{{item.otherUser.nickname}}</text>
          <text class="time">{{formatTime(item.lastMessageAt)}}</text>
        </view>
        <view class="bottom-row">
          <text class="last-message {{item.unreadCount > 0 ? 'unread' : ''}}">
            {{item.lastMessage || 'æš‚æ— æ¶ˆæ¯'}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty">
    <text class="empty-icon">ğŸ’¬</text>
    <text class="empty-text">æš‚æ— ç§ä¿¡</text>
    <text class="empty-tip">å»å…³æ³¨æ„Ÿå…´è¶£çš„ç”¨æˆ·å¼€å§‹èŠå¤©å§</text>
  </view>
</view>
