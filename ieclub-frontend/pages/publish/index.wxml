<!--pages/publish/index.wxml-->
<view class="publish-page">
  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <view class="header" style="background: {{typeConfig[publishType].color}}">
    <text class="header-icon">{{typeConfig[publishType].icon}}</text>
    <view class="header-text">
      <text class="header-title">{{typeConfig[publishType].label}}</text>
      <text class="header-desc">{{typeConfig[publishType].description}}</text>
    </view>
  </view>

  <!-- ç±»å‹é€‰æ‹©å™¨ -->
  <view class="type-selector">
    <view 
      class="type-item {{publishType === 'demand' ? 'active' : ''}}"
      style="{{publishType === 'demand' ? 'background: #06b6d4; color: #fff;' : ''}}"
      data-type="demand"
      bindtap="switchType"
    >
      <text class="type-icon">ğŸ‘‚</text>
      <text class="type-label">æˆ‘æƒ³å¬</text>
    </view>
    <view 
      class="type-item {{publishType === 'offer' ? 'active' : ''}}"
      style="{{publishType === 'offer' ? 'background: #8b5cf6; color: #fff;' : ''}}"
      data-type="offer"
      bindtap="switchType"
    >
      <text class="type-icon">ğŸ¤</text>
      <text class="type-label">æˆ‘æ¥è®²</text>
    </view>
    <view 
      class="type-item {{publishType === 'project' ? 'active' : ''}}"
      style="{{publishType === 'project' ? 'background: #10b981; color: #fff;' : ''}}"
      data-type="project"
      bindtap="switchType"
    >
      <text class="type-icon">ğŸš€</text>
      <text class="type-label">é¡¹ç›®</text>
    </view>
    <view 
      class="type-item {{publishType === 'share' ? 'active' : ''}}"
      style="{{publishType === 'share' ? 'background: #f59e0b; color: #fff;' : ''}}"
      data-type="share"
      bindtap="switchType"
    >
      <text class="type-icon">ğŸ’¡</text>
      <text class="type-label">åˆ†äº«</text>
    </view>
  </view>

  <!-- è¡¨å•åŒºåŸŸ -->
  <view class="form">
    <!-- é€šç”¨å­—æ®µï¼šæ ‡é¢˜ -->
    <view class="form-section">
      <view class="form-item">
        <text class="form-label">æ ‡é¢˜ <text class="required">*</text></text>
        <input 
          class="form-input" 
          placeholder="{{typeConfig[publishType].placeholder.title}}"
          value="{{title}}"
          bindinput="onTitleInput"
          maxlength="50"
        />
        <text class="form-count">{{title.length}}/50</text>
      </view>
    </view>

    <!-- é€šç”¨å­—æ®µï¼šå†…å®¹ -->
    <view class="form-section">
      <view class="form-item">
        <text class="form-label">è¯¦ç»†æè¿° <text class="required">*</text></text>
        <textarea 
          class="form-textarea" 
          placeholder="{{typeConfig[publishType].placeholder.content}}"
          value="{{content}}"
          bindinput="onContentInput"
          maxlength="2000"
        />
        <text class="form-count">{{content.length}}/2000</text>
      </view>
    </view>

    <!-- æˆ‘æƒ³å¬/æˆ‘æ¥è®² ä¸“å±å­—æ®µ -->
    <block wx:if="{{publishType === 'demand' || publishType === 'offer'}}">
      <view class="form-section">
        <text class="section-title">ğŸ“… æ—¶é—´å®‰æ’</text>
        
        <view class="form-item">
          <text class="form-label">æœŸæœ›æ—¶é•¿</text>
          <picker mode="selector" range="{{durationOptions}}" bindchange="onDurationChange">
            <view class="picker-value">
              <text>{{duration || 'è¯·é€‰æ‹©'}}</text>
              <text class="picker-arrow">â€º</text>
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">ç›®æ ‡å¬ä¼—</text>
          <input 
            class="form-input" 
            placeholder="ä¾‹å¦‚ï¼šæœ‰PythonåŸºç¡€çš„åŒå­¦"
            value="{{targetAudience}}"
            bindinput="onTargetAudienceInput"
          />
        </view>
        
        <!-- æˆ‘æ¥è®²ç‰¹æœ‰ï¼šæˆå›¢é˜ˆå€¼ -->
        <view wx:if="{{publishType === 'offer'}}" class="form-item threshold-item">
          <text class="form-label">æˆå›¢äººæ•°</text>
          <view class="threshold-input-group">
            <input 
              class="threshold-input" 
              type="number"
              value="{{threshold}}"
              bindinput="onThresholdInput"
            />
            <text class="threshold-hint">äººæƒ³å¬åå¼€è®²</text>
          </view>
        </view>
      </view>
    </block>

    <!-- é¡¹ç›®ä¸“å±å­—æ®µ -->
    <block wx:if="{{publishType === 'project'}}">
      <view class="form-section">
        <text class="section-title">ğŸš€ é¡¹ç›®ä¿¡æ¯</text>
        
        <view class="form-item">
          <text class="form-label">é¡¹ç›®é˜¶æ®µ <text class="required">*</text></text>
          <picker mode="selector" range="{{projectStages}}" bindchange="onProjectStageChange">
            <view class="picker-value">
              <text>{{projectStage || 'è¯·é€‰æ‹©'}}</text>
              <text class="picker-arrow">â€º</text>
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">å›¢é˜Ÿè§„æ¨¡</text>
          <input 
            class="form-input" 
            type="number"
            placeholder="ç›®å‰å›¢é˜Ÿäººæ•°"
            value="{{teamSize}}"
            bindinput="onTeamSizeInput"
          />
        </view>
      </view>
      
      <view class="form-section">
        <text class="section-title">ğŸ‘¥ æ‹›å‹Ÿéœ€æ±‚</text>
        
        <view class="form-item">
          <text class="form-label">æ‹›å‹Ÿè§’è‰²</text>
          <view class="tag-input-group">
            <input 
              class="tag-input" 
              placeholder="å¦‚ï¼šå‰ç«¯å·¥ç¨‹å¸ˆ"
              value="{{roleInput}}"
              bindinput="onRoleInput"
              bindconfirm="addRole"
            />
            <button class="tag-add-btn" bindtap="addRole">æ·»åŠ </button>
          </view>
          <view class="tags-list" wx:if="{{lookingForRoles.length > 0}}">
            <view class="tag-item" wx:for="{{lookingForRoles}}" wx:key="*this">
              <text>{{item}}</text>
              <text class="tag-remove" data-index="{{index}}" bindtap="removeRole">Ã—</text>
            </view>
          </view>
        </view>
        
        <view class="form-item">
          <text class="form-label">æ‰€éœ€æŠ€èƒ½</text>
          <view class="tag-input-group">
            <input 
              class="tag-input" 
              placeholder="å¦‚ï¼šReactã€Node.js"
              value="{{skillInput}}"
              bindinput="onSkillInput"
              bindconfirm="addSkill"
            />
            <button class="tag-add-btn" bindtap="addSkill">æ·»åŠ </button>
          </view>
          <view class="tags-list" wx:if="{{skillsNeeded.length > 0}}">
            <view class="tag-item skill" wx:for="{{skillsNeeded}}" wx:key="*this">
              <text>{{item}}</text>
              <text class="tag-remove" data-index="{{index}}" bindtap="removeSkill">Ã—</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="form-section">
        <text class="section-title">ğŸ”— è”ç³»æ–¹å¼</text>
        
        <view class="form-item">
          <text class="form-label">é¡¹ç›®ç½‘ç«™</text>
          <input 
            class="form-input" 
            placeholder="https://..."
            value="{{website}}"
            bindinput="onWebsiteInput"
          />
        </view>
        
        <view class="form-item">
          <text class="form-label">GitHub</text>
          <input 
            class="form-input" 
            placeholder="https://github.com/..."
            value="{{github}}"
            bindinput="onGithubInput"
          />
        </view>
        
        <view class="form-item">
          <text class="form-label">è”ç³»æ–¹å¼</text>
          <input 
            class="form-input" 
            placeholder="å¾®ä¿¡/é‚®ç®±/æ‰‹æœºå·"
            value="{{contactInfo}}"
            bindinput="onContactInput"
          />
        </view>
      </view>
    </block>

    <!-- æ ‡ç­¾é€‰æ‹© -->
    <view class="form-section">
      <text class="section-title">ğŸ·ï¸ æ ‡ç­¾</text>
      
      <!-- é¢„è®¾æ ‡ç­¾ -->
      <view class="preset-tags">
        <view 
          class="preset-tag {{tags.includes(item) ? 'selected' : ''}}" 
          wx:for="{{presetTags}}" 
          wx:key="*this"
          data-tag="{{item}}"
          bindtap="addPresetTag"
        >
          {{item}}
        </view>
      </view>
      
      <!-- è‡ªå®šä¹‰æ ‡ç­¾è¾“å…¥ -->
      <view class="form-item">
        <view class="tag-input-group">
          <input 
            class="tag-input" 
            placeholder="è‡ªå®šä¹‰æ ‡ç­¾"
            value="{{tagInput}}"
            bindinput="onTagInput"
            bindconfirm="addTag"
          />
          <button class="tag-add-btn" bindtap="addTag">æ·»åŠ </button>
        </view>
      </view>
      
      <!-- å·²é€‰æ ‡ç­¾ -->
      <view class="selected-tags" wx:if="{{tags.length > 0}}">
        <view class="selected-tag" wx:for="{{tags}}" wx:key="*this">
          <text>#{{item}}</text>
          <text class="tag-remove" data-index="{{index}}" bindtap="removeTag">Ã—</text>
        </view>
      </view>
    </view>

    <!-- å›¾ç‰‡ä¸Šä¼  -->
    <view class="form-section">
      <text class="section-title">ğŸ“· å›¾ç‰‡ï¼ˆæœ€å¤š9å¼ ï¼‰</text>
      
      <view class="image-upload-area">
        <view class="image-list">
          <view class="image-item" wx:for="{{images}}" wx:key="*this">
            <image src="{{item}}" mode="aspectFill" data-url="{{item}}" bindtap="previewImage" />
            <view class="image-remove" data-index="{{index}}" bindtap="removeImage">Ã—</view>
          </view>
          <view class="image-add" wx:if="{{images.length < 9}}" bindtap="chooseImage">
            <text class="add-icon">+</text>
            <text class="add-text">æ·»åŠ </text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="draft-btn" bindtap="saveDraft">ä¿å­˜è‰ç¨¿</button>
      <button 
        class="publish-btn" 
        bindtap="publish"
        disabled="{{submitting}}"
        loading="{{submitting}}"
      >
        {{submitting ? 'å‘å¸ƒä¸­...' : 'å‘å¸ƒ'}}
      </button>
    </view>
  </view>
</view>

