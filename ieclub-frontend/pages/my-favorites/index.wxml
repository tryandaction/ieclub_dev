<!--pages/my-favorites/index.wxml-->
<view class="my-favorites-page">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <view class="header-title">
        <text class="title-icon">â­</text>
        <text class="title-text">æˆ‘çš„æ”¶è—</text>
      </view>
      <view class="header-subtitle">
        <text>å…±æ”¶è— {{total}} ä¸ªè¯é¢˜</text>
      </view>
    </view>
  </view>

  <!-- æ”¶è—åˆ—è¡¨ -->
  <view class="favorites-container">
    <!-- åŠ è½½ä¸­éª¨æ¶å± -->
    <view wx:if="{{loading && topics.length === 0}}" class="skeleton-list">
      <view class="skeleton-item" wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="skeleton-header">
          <view class="skeleton-title"></view>
          <view class="skeleton-time"></view>
        </view>
        <view class="skeleton-content"></view>
        <view class="skeleton-footer">
          <view class="skeleton-tag"></view>
          <view class="skeleton-tag"></view>
        </view>
      </view>
    </view>

    <!-- æ”¶è—è¯é¢˜åˆ—è¡¨ -->
    <view wx:if="{{!isEmpty && topics.length > 0}}" class="topic-list">
      <view 
        class="topic-card"
        wx:for="{{topics}}"
        wx:key="id"
        data-id="{{item.id}}"
      >
        <!-- è¯é¢˜å†…å®¹åŒºåŸŸï¼ˆå¯ç‚¹å‡»ï¼‰ -->
        <view 
          class="topic-content-area"
          bindtap="goToTopicDetail"
          data-id="{{item.id}}"
          hover-class="topic-content-hover"
        >
          <!-- è¯é¢˜å¤´éƒ¨ -->
          <view class="topic-header">
            <view class="topic-category">
              <text class="category-icon">{{item.category === 'demand' ? 'ğŸ”' : item.category === 'supply' ? 'ğŸ’¡' : 'ğŸ“¢'}}</text>
              <text class="category-text">
                {{item.category === 'demand' ? 'éœ€æ±‚' : item.category === 'supply' ? 'ä¾›ç»™' : 'æ™®é€š'}}
              </text>
            </view>
            <text class="bookmark-time">{{item.bookmarkedAt}}</text>
          </view>

          <!-- è¯é¢˜æ ‡é¢˜ -->
          <view class="topic-title">{{item.title}}</view>

          <!-- è¯é¢˜å†…å®¹ -->
          <view class="topic-content">{{item.content}}</view>

          <!-- è¯é¢˜æ ‡ç­¾ -->
          <view wx:if="{{item.tags && item.tags.length > 0}}" class="topic-tags">
            <view class="tag-item" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">
              #{{tag}}
            </view>
          </view>

          <!-- è¯é¢˜æ•°æ® -->
          <view class="topic-stats">
            <view class="stat-badge">
              <text class="stat-icon">ğŸ‘</text>
              <text class="stat-count">{{item._count.likes || 0}}</text>
            </view>
            <view class="stat-badge">
              <text class="stat-icon">ğŸ’¬</text>
              <text class="stat-count">{{item._count.comments || 0}}</text>
            </view>
            <view class="stat-badge">
              <text class="stat-icon">ğŸ‘</text>
              <text class="stat-count">{{item.viewsCount || 0}}</text>
            </view>
          </view>
        </view>

        <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
        <view class="topic-actions">
          <button 
            class="unbookmark-btn"
            bindtap="handleUnbookmark"
            data-id="{{item.id}}"
            data-index="{{index}}"
            hover-class="unbookmark-btn-hover"
          >
            <text class="btn-icon">ğŸ’”</text>
            <text>å–æ¶ˆæ”¶è—</text>
          </button>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{isEmpty && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-title">è¿˜æ²¡æœ‰æ”¶è—å†…å®¹</text>
      <text class="empty-desc">å»å¹¿åœºå‘ç°æ„Ÿå…´è¶£çš„è¯é¢˜å§</text>
      <button class="empty-btn" bindtap="goToPlaza">
        <text class="btn-icon">ğŸ”</text>
        <text>å»å‘ç°</text>
      </button>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{topics.length > 0}}" class="load-more">
      <view wx:if="{{loading}}" class="loading-text">
        <text class="loading-icon">â³</text>
        <text>åŠ è½½ä¸­...</text>
      </view>
      <view wx:elif="{{!hasMore}}" class="no-more-text">
        <text class="divider-line"></text>
        <text class="no-more-label">æ²¡æœ‰æ›´å¤šäº†</text>
        <text class="divider-line"></text>
      </view>
    </view>
  </view>
</view>
