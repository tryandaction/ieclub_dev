{"version":3,"file":"document.js","sources":["../../../src/dom/document.ts"],"sourcesContent":["import { controlledComponent, isUndefined, toCamelCase } from '@tarojs/shared'\n\nimport {\n  A,\n  COMMENT,\n  DOCUMENT_ELEMENT_NAME,\n  ROOT_STR\n} from '../constants'\nimport { TaroElement } from '../dom/element'\nimport { createEvent } from '../dom/event'\nimport { eventSource } from '../dom/event-source'\nimport { FormElement } from '../dom/form'\nimport { NodeType } from '../dom/node_types'\nimport { TaroRootElement } from '../dom/root'\nimport { TaroText } from '../dom/text'\nimport env from '../env'\nimport { AnchorElement } from './anchor-element'\nimport { TransferElement } from './transfer'\n\nexport class TaroDocument extends TaroElement {\n  public documentElement: TaroElement\n  public head: TaroElement\n  public body: TaroElement\n  public createEvent = createEvent\n  cookie?: string\n\n  public constructor () {\n    super()\n    this.nodeType = NodeType.DOCUMENT_NODE\n    this.nodeName = DOCUMENT_ELEMENT_NAME\n  }\n\n  public createElement (type: string): TaroElement | TaroRootElement | FormElement {\n    const nodeName = type.toLowerCase()\n\n    let element: TaroElement\n    switch (true) {\n      case nodeName === ROOT_STR:\n        element = new TaroRootElement()\n        return element\n      case controlledComponent.has(nodeName):\n        element = new FormElement()\n        break\n      case nodeName === A:\n        element = new AnchorElement()\n        break\n      case nodeName === 'page-meta':\n      case nodeName === 'navigation-bar':\n        element = new TransferElement(toCamelCase(nodeName))\n        break\n      default:\n        element = new TaroElement()\n        break\n    }\n\n    element.nodeName = nodeName\n    element.tagName = type.toUpperCase()\n\n    return element\n  }\n\n  // an ugly fake createElementNS to deal with @vue/runtime-dom's\n  // support mounting app to svg container since vue@3.0.8\n  public createElementNS (_svgNS: string, type: string): TaroElement | TaroRootElement | FormElement {\n    return this.createElement(type)\n  }\n\n  public createTextNode (text: string): TaroText {\n    return new TaroText(text)\n  }\n\n  public getElementById<T extends TaroElement> (id: string | undefined | null): T | null {\n    const el = eventSource.get(id)\n    return isUndefined(el) ? null : el as T\n  }\n\n  public querySelector<T extends TaroElement> (query: string): T | null {\n    // 为了 Vue3 的乞丐版实现\n    if (/^#/.test(query)) {\n      return this.getElementById<T>(query.slice(1))\n    }\n    return null\n  }\n\n  public querySelectorAll () {\n    // fake hack\n    return []\n  }\n\n  // @TODO: @PERF: 在 hydrate 移除掉空的 node\n  public createComment (): TaroText {\n    const textnode = new TaroText('')\n    textnode.nodeName = COMMENT\n    return textnode\n  }\n\n  get defaultView () {\n    return env.window\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAmBM,MAAO,YAAa,SAAQ,WAAW,CAAA;AAO3C,IAAA,WAAA,GAAA;AACE,QAAA,KAAK,EAAE;QAJF,IAAW,CAAA,WAAA,GAAG,WAAW;QAK9B,IAAI,CAAC,QAAQ,GAAA,CAAA;AACb,QAAA,IAAI,CAAC,QAAQ,GAAG,qBAAqB;;AAGhC,IAAA,aAAa,CAAE,IAAY,EAAA;AAChC,QAAA,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE;AAEnC,QAAA,IAAI,OAAoB;QACxB,QAAQ,IAAI;YACV,KAAK,QAAQ,KAAK,QAAQ;AACxB,gBAAA,OAAO,GAAG,IAAI,eAAe,EAAE;AAC/B,gBAAA,OAAO,OAAO;AAChB,YAAA,KAAK,mBAAmB,CAAC,GAAG,CAAC,QAAQ,CAAC;AACpC,gBAAA,OAAO,GAAG,IAAI,WAAW,EAAE;gBAC3B;YACF,KAAK,QAAQ,KAAK,CAAC;AACjB,gBAAA,OAAO,GAAG,IAAI,aAAa,EAAE;gBAC7B;YACF,KAAK,QAAQ,KAAK,WAAW;YAC7B,KAAK,QAAQ,KAAK,gBAAgB;gBAChC,OAAO,GAAG,IAAI,eAAe,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;gBACpD;AACF,YAAA;AACE,gBAAA,OAAO,GAAG,IAAI,WAAW,EAAE;gBAC3B;;AAGJ,QAAA,OAAO,CAAC,QAAQ,GAAG,QAAQ;AAC3B,QAAA,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,EAAE;AAEpC,QAAA,OAAO,OAAO;;;;IAKT,eAAe,CAAE,MAAc,EAAE,IAAY,EAAA;AAClD,QAAA,OAAO,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC;;AAG1B,IAAA,cAAc,CAAE,IAAY,EAAA;AACjC,QAAA,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC;;AAGpB,IAAA,cAAc,CAAyB,EAA6B,EAAA;QACzE,MAAM,EAAE,GAAG,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC;AAC9B,QAAA,OAAO,WAAW,CAAC,EAAE,CAAC,GAAG,IAAI,GAAG,EAAO;;AAGlC,IAAA,aAAa,CAAyB,KAAa,EAAA;;AAExD,QAAA,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;YACpB,OAAO,IAAI,CAAC,cAAc,CAAI,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;;AAE/C,QAAA,OAAO,IAAI;;IAGN,gBAAgB,GAAA;;AAErB,QAAA,OAAO,EAAE;;;IAIJ,aAAa,GAAA;AAClB,QAAA,MAAM,QAAQ,GAAG,IAAI,QAAQ,CAAC,EAAE,CAAC;AACjC,QAAA,QAAQ,CAAC,QAAQ,GAAG,OAAO;AAC3B,QAAA,OAAO,QAAQ;;AAGjB,IAAA,IAAI,WAAW,GAAA;QACb,OAAO,GAAG,CAAC,MAAM;;AAEpB;;;;"}