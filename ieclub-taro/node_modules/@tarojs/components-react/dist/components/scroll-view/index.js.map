{"version":3,"file":"index.js","sources":["../../../src/components/scroll-view/index.tsx"],"sourcesContent":["import './style/index.scss'\n\nimport { isFunction } from '@tarojs/shared'\nimport classNames from 'classnames'\n\nimport { createForwardRefComponent, throttle } from '../../utils'\nimport { useEffect, useRef } from '../../utils/hooks'\n\nimport type React from 'react'\n\nfunction easeOutScroll (from = 0, to = 0, callback) {\n  if (from === to || typeof from !== 'number') {\n    return\n  }\n  const change = to - from\n  const dur = 500\n  const sTime = +new Date()\n  function linear (t, b, c, d) {\n    return (c * t) / d + b\n  }\n  const isLarger = to >= from\n\n  function step () {\n    from = linear(+new Date() - sTime, from, change, dur)\n    if ((isLarger && from >= to) || (!isLarger && to >= from)) {\n      callback(to)\n      return\n    }\n    callback(from)\n    requestAnimationFrame(step)\n  }\n  step()\n}\n\nfunction scrollIntoView (id = '', isHorizontal = false, animated = true, scrollIntoViewAlignment?: ScrollLogicalPosition) {\n  document.querySelector(`#${id}`)?.scrollIntoView({\n    behavior: animated ? 'smooth' : 'auto',\n    block: !isHorizontal ? (scrollIntoViewAlignment || 'center') : 'center',\n    inline: isHorizontal ? (scrollIntoViewAlignment || 'start') : 'start'\n  })\n}\n\nfunction scrollVertical (container, scrollTop, top, isAnimation) {\n  if (isAnimation) {\n    easeOutScroll(scrollTop.current, top, pos => {\n      if (container.current) container.current.scrollTop = pos\n    })\n  } else {\n    if (container.current) container.current.scrollTop = top\n  }\n  scrollTop.current = top\n}\n\nfunction scrollHorizontal (container, scrollLeft, left, isAnimation) {\n  if (isAnimation) {\n    easeOutScroll(scrollLeft.current, left, pos => {\n      if (container.current) container.current.scrollLeft = pos\n    })\n  } else {\n    if (container.current) container.current.scrollLeft = left\n  }\n  scrollLeft.current = left\n}\n\ninterface IProps extends React.HTMLAttributes<HTMLDivElement> {\n  scrollX: boolean\n  scrollY: boolean\n  upperThreshold: number\n  lowerThreshold: number\n  scrollTop: number\n  scrollLeft: number\n  scrollIntoView?: string\n  scrollIntoViewAlignment?: ScrollLogicalPosition\n  scrollWithAnimation: boolean\n  enableBackToTop?: boolean\n  forwardedRef?: React.MutableRefObject<HTMLDivElement>\n  onScrollToUpper: (e: React.SyntheticEvent<HTMLDivElement, Event>) => void\n  onScrollToLower: (e: React.SyntheticEvent<HTMLDivElement, Event>) => void\n  onScroll: (e: React.SyntheticEvent<HTMLDivElement, Event>) => void\n  onTouchMove: (e: React.SyntheticEvent<HTMLDivElement, Event>) => void\n  showScrollbar?: boolean // 新增参数，默认true\n  enhanced?: boolean // 新增参数，默认false\n}\n\nfunction ScrollView (props: IProps) {\n  const _scrollTop = useRef<any>(null)\n  const _scrollLeft = useRef<any>(null)\n  const container = useRef<any>(null)\n  const onTouchMove = (e) => {\n    e.stopPropagation()\n  }\n\n  const handleScroll = (props: IProps, isInit = false) => {\n    // scrollIntoView\n    if (\n      props.scrollIntoView &&\n      typeof props.scrollIntoView === 'string' &&\n      document &&\n      document.querySelector &&\n      document.querySelector(`#${props.scrollIntoView}`)\n    ) {\n      const isHorizontal = props.scrollX && !props.scrollY\n      if (isInit) {\n        setTimeout(() => scrollIntoView(props.scrollIntoView, props.scrollWithAnimation, isHorizontal, props.scrollIntoViewAlignment), 500)\n      } else {\n        scrollIntoView(props.scrollIntoView, props.scrollWithAnimation, isHorizontal, props.scrollIntoViewAlignment)\n      }\n    } else {\n      const isAnimation = !!props.scrollWithAnimation\n      // Y 轴滚动\n      if (props.scrollY && typeof props.scrollTop === 'number' && props.scrollTop !== _scrollTop.current) {\n        if (isInit) {\n          setTimeout(() => scrollVertical(container, _scrollTop, props.scrollTop, isAnimation), 10)\n        } else {\n          scrollVertical(container, _scrollTop, props.scrollTop, isAnimation)\n        }\n      }\n      // X 轴滚动\n      if (props.scrollX && typeof props.scrollLeft === 'number' && props.scrollLeft !== _scrollLeft.current) {\n        if (isInit) {\n          setTimeout(() => scrollHorizontal(container, _scrollLeft, props.scrollLeft, isAnimation), 10)\n        } else {\n          scrollHorizontal(container, _scrollLeft, props.scrollLeft, isAnimation)\n        }\n      }\n    }\n  }\n\n  useEffect(() => {\n    handleScroll(props, true)\n  }, [])\n\n  const {\n    className,\n    style = {},\n    onScroll,\n    onScrollToUpper,\n    onScrollToLower,\n    scrollX,\n    scrollY,\n    showScrollbar = true, // 默认显示滚动条\n    enhanced = false // 默认不增强\n  } = props\n  let { upperThreshold = 50, lowerThreshold = 50 } = props\n  const cls = classNames(\n    'taro-scroll',\n    {\n      'taro-scroll-view__scroll-x': scrollX,\n      'taro-scroll-view__scroll-y': scrollY,\n      'taro-scroll--hidebar': enhanced === true && showScrollbar === false,\n      'taro-scroll--enhanced': enhanced === true\n    },\n    className\n  )\n  upperThreshold = Number(upperThreshold)\n  lowerThreshold = Number(lowerThreshold)\n  const upperAndLower = e => {\n    if (!container.current) return\n    const { offsetWidth, offsetHeight, scrollLeft, scrollTop, scrollHeight, scrollWidth } = container.current\n    if (\n      onScrollToLower &&\n      ((props.scrollY && offsetHeight + scrollTop + lowerThreshold >= scrollHeight) ||\n        (props.scrollX && offsetWidth + scrollLeft + lowerThreshold >= scrollWidth))\n    ) {\n      onScrollToLower(e)\n    }\n    if (\n      onScrollToUpper &&\n      ((props.scrollY && scrollTop <= upperThreshold) || (props.scrollX && scrollLeft <= upperThreshold))\n    ) {\n      onScrollToUpper(e)\n    }\n  }\n  const upperAndLowerThrottle = throttle(upperAndLower, 200)\n  const _onScroll = e => {\n    const { scrollLeft, scrollTop, scrollHeight, scrollWidth } = container.current\n    _scrollLeft.current = scrollLeft\n    _scrollTop.current = scrollTop\n    Object.defineProperty(e, 'detail', {\n      enumerable: true,\n      writable: true,\n      value: {\n        scrollLeft,\n        scrollTop,\n        scrollHeight,\n        scrollWidth\n      }\n    })\n    upperAndLowerThrottle(e)\n    onScroll && onScroll(e)\n  }\n  const _onTouchMove = e => {\n    isFunction(props.onTouchMove) ? props.onTouchMove(e) : onTouchMove(e)\n  }\n  return (\n    <div\n      ref={e => {\n        if (e) {\n          container.current = e\n          if (props.forwardedRef) props.forwardedRef.current = e\n        }\n      }}\n      style={style}\n      className={cls}\n      onScroll={_onScroll}\n      onTouchMove={_onTouchMove}\n    >\n      {props.children}\n    </div>\n  )\n}\n\nexport default createForwardRefComponent(ScrollView)\n"],"names":["easeOutScroll","from","arguments","length","undefined","to","callback","change","dur","sTime","Date","linear","t","b","c","d","isLarger","step","requestAnimationFrame","scrollIntoView","id","isHorizontal","animated","scrollIntoViewAlignment","_a","document","querySelector","behavior","block","inline","scrollVertical","container","scrollTop","top","isAnimation","current","pos","scrollHorizontal","scrollLeft","left","ScrollView","props","_scrollTop","useRef","_scrollLeft","onTouchMove","e","stopPropagation","handleScroll","isInit","scrollX","scrollY","setTimeout","scrollWithAnimation","useEffect","className","style","onScroll","onScrollToUpper","onScrollToLower","showScrollbar","enhanced","upperThreshold","lowerThreshold","cls","classNames","Number","upperAndLower","offsetWidth","offsetHeight","scrollHeight","scrollWidth","upperAndLowerThrottle","throttle","_onScroll","Object","defineProperty","enumerable","writable","value","_onTouchMove","isFunction","_jsx","ref","forwardedRef","children","createForwardRefComponent"],"mappings":"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"}