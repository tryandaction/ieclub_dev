{"version":3,"file":"actionSheet.js","sources":["../../../../src/api/ui/interaction/actionSheet.ts"],"sourcesContent":["import { inlineStyle, setTransform } from '../../../utils'\n\nconst noop = function () {}\n\nexport default class ActionSheet {\n  options = {\n    itemList: [],\n    itemColor: '#000000',\n    success: noop,\n    fail: noop,\n    complete: noop\n  }\n\n  style = {\n    maskStyle: {\n      position: 'fixed',\n      'z-index': '1000',\n      top: '0',\n      right: '0',\n      left: '0',\n      bottom: '0',\n      background: 'rgba(0,0,0,0.6)'\n    },\n    actionSheetStyle: {\n      'z-index': '4999',\n      position: 'fixed',\n      left: '0',\n      bottom: '0',\n      '-webkit-transform': 'translate(0, 100%)',\n      transform: 'translate(0, 100%)',\n      width: '100%',\n      'line-height': '1.6',\n      background: '#EFEFF4',\n      '-webkit-transition': '-webkit-transform .3s',\n      transition: 'transform .3s'\n    },\n    menuStyle: {\n      'background-color': '#FCFCFD'\n    },\n    cellStyle: {\n      position: 'relative',\n      padding: '10px 0',\n      'text-align': 'center',\n      'font-size': '18px'\n    },\n    cancelStyle: {\n      'margin-top': '6px',\n      padding: '10px 0',\n      'text-align': 'center',\n      'font-size': '18px',\n      color: '#000000',\n      'background-color': '#FCFCFD'\n    }\n  }\n\n  lastConfig = {}\n  el: HTMLDivElement\n  mask: HTMLDivElement\n  actionSheet: HTMLDivElement\n  menu: HTMLDivElement\n  cells: HTMLDivElement[]\n  cancel: HTMLDivElement\n  hideOpacityTimer: ReturnType<typeof setTimeout>\n  hideDisplayTimer: ReturnType<typeof setTimeout>\n\n  create (options = {}) {\n    return new Promise<string | number>((resolve) => {\n      // style\n      const { maskStyle, actionSheetStyle, menuStyle, cellStyle, cancelStyle } = this.style\n\n      // configuration\n      const config = {\n        ...this.options,\n        ...options\n      }\n\n      this.lastConfig = config\n\n      // wrapper\n      this.el = document.createElement('div')\n      this.el.className = 'taro__actionSheet'\n      this.el.style.opacity = '0'\n      this.el.style.transition = 'opacity 0.2s linear'\n\n      // mask\n      this.mask = document.createElement('div')\n      this.mask.setAttribute('style', inlineStyle(maskStyle))\n\n      // actionSheet\n      this.actionSheet = document.createElement('div')\n      this.actionSheet.setAttribute('style', inlineStyle(actionSheetStyle))\n\n      // menu\n      this.menu = document.createElement('div')\n      this.menu.setAttribute('style', inlineStyle({\n        ...menuStyle,\n        color: config.itemColor\n      }))\n\n      // cells\n      this.cells = config.itemList.map((item, index) => {\n        const cell: HTMLDivElement = document.createElement('div')\n        cell.className = 'taro-actionsheet__cell'\n        cell.setAttribute('style', inlineStyle(cellStyle))\n        cell.textContent = item\n        cell.dataset.tapIndex = `${index}`\n        cell.onclick = e => {\n          this.hide()\n          const target = e.currentTarget as HTMLDivElement\n          const index = Number(target?.dataset.tapIndex) || 0\n          resolve(index)\n        }\n        return cell\n      })\n\n      // cancel\n      this.cancel = document.createElement('div')\n      this.cancel.setAttribute('style', inlineStyle(cancelStyle))\n      this.cancel.textContent = '取消'\n\n      // result\n      this.cells.forEach(item => this.menu.appendChild(item))\n      this.actionSheet.appendChild(this.menu)\n      this.actionSheet.appendChild(this.cancel)\n      this.el.appendChild(this.mask)\n      this.el.appendChild(this.actionSheet)\n\n      // callbacks\n      const cb = () => {\n        this.hide()\n        resolve('cancel')\n      }\n      this.mask.onclick = cb\n      this.cancel.onclick = cb\n\n      // show immediately\n      document.body.appendChild(this.el)\n      setTimeout(() => {\n        this.el.style.opacity = '1'\n        setTransform(this.actionSheet, 'translate(0, 0)')\n      }, 0)\n    })\n  }\n\n  show (options = {}) {\n    return new Promise<string | number>((resolve) => {\n      const config = {\n        ...this.options,\n        ...options\n      }\n\n      this.lastConfig = config\n\n      if (this.hideOpacityTimer) clearTimeout(this.hideOpacityTimer)\n      if (this.hideDisplayTimer) clearTimeout(this.hideDisplayTimer)\n\n      // itemColor\n      if (config.itemColor) this.menu.style.color = config.itemColor\n\n      // cells\n      const { cellStyle } = this.style\n\n      config.itemList.forEach((item, index) => {\n        let cell: HTMLDivElement\n        if (this.cells[index]) {\n          // assign new content\n          cell = this.cells[index]\n        } else {\n          // create new cell\n          cell = document.createElement('div')\n          cell.className = 'taro-actionsheet__cell'\n          cell.setAttribute('style', inlineStyle(cellStyle))\n          cell.dataset.tapIndex = `${index}`\n          this.cells.push(cell)\n          this.menu.appendChild(cell)\n        }\n        cell.textContent = item\n        cell.onclick = e => {\n          this.hide()\n          const target = e.currentTarget as HTMLDivElement\n          const index = Number(target?.dataset.tapIndex) || 0\n          resolve(index)\n        }\n      })\n      const cellsLen = this.cells.length\n      const itemListLen = config.itemList.length\n      if (cellsLen > itemListLen) {\n        for (let i = itemListLen; i < cellsLen; i++) {\n          this.menu.removeChild(this.cells[i])\n        }\n        this.cells.splice(itemListLen)\n      }\n\n      // callbacks\n      const cb = () => {\n        this.hide()\n        resolve('cancel')\n      }\n      this.mask.onclick = cb\n      this.cancel.onclick = cb\n\n      // show\n      this.el.style.display = 'block'\n      setTimeout(() => {\n        this.el.style.opacity = '1'\n        setTransform(this.actionSheet, 'translate(0, 0)')\n      }, 0)\n    })\n  }\n\n  hide () {\n    if (this.hideOpacityTimer) clearTimeout(this.hideOpacityTimer)\n    if (this.hideDisplayTimer) clearTimeout(this.hideDisplayTimer)\n\n    this.hideOpacityTimer = setTimeout(() => {\n      this.el.style.opacity = '0'\n      setTransform(this.actionSheet, 'translate(0, 100%)')\n      this.hideDisplayTimer = setTimeout(() => { this.el.style.display = 'none' }, 200)\n    }, 0)\n  }\n}\n"],"names":[],"mappings":"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"}