"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[299],{9427:function(e,n,t){var a=t(7842),s=t(3949),c=t(8500),r=t(6784),i=t(8140),l=t(118),o=t(8833),u=t(758),m=t.n(u),h=t(9231),f="https://api.ieclub.online";function p(e){return d.apply(this,arguments)}function d(){return d=(0,r.A)((0,s.A)().m(function e(n){var t;return(0,s.A)().w(function(e){while(1)switch(e.n){case 0:return t=m().getStorageSync("token"),e.a(2,new Promise(function(e,a){m().uploadFile({url:"".concat(f,"/api/upload/image"),filePath:n,name:"file",header:{Authorization:"Bearer ".concat(t)},success:function(n){try{var t=JSON.parse(n.data);200===t.code?e(t.data.url):a(new Error(t.message||"\u4e0a\u4f20\u5931\u8d25"))}catch(e){a(e)}},fail:function(e){a(e)}})}))}},e)})),d.apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return g=(0,r.A)((0,s.A)().m(function e(n){var t;return(0,s.A)().w(function(e){while(1)switch(e.n){case 0:return t=n.map(function(e){return p(e)}),e.a(2,Promise.all(t))}},e)})),g.apply(this,arguments)}var S=t(5349);function x(){var e=(0,h.e)(),n=e.createTopic,t=(0,o.useState)(""),a=(0,i.A)(t,2),u=a[0],f=a[1],p=(0,o.useState)(""),d=(0,i.A)(p,2),g=d[0],x=d[1],w=(0,o.useState)(""),b=(0,i.A)(w,2),N=b[0],j=b[1],A=(0,o.useState)([]),k=(0,i.A)(A,2),y=k[0],T=k[1],C=(0,o.useState)([]),P=(0,i.A)(C,2),B=P[0],F=P[1],I=(0,o.useState)(!1),J=(0,i.A)(I,2),O=J[0],z=J[1],D=(0,o.useState)(!1),E=(0,i.A)(D,2),H=E[0],M=E[1],R=[{value:"tech",label:"\u6280\u672f"},{value:"science",label:"\u79d1\u5b66"},{value:"life",label:"\u751f\u6d3b"},{value:"study",label:"\u5b66\u4e60"},{value:"other",label:"\u5176\u4ed6"}],V=function(){var e=(0,r.A)((0,s.A)().m(function e(){var n,t,a;return(0,s.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,m().chooseImage({count:9-B.length,sizeType:["compressed"],sourceType:["album","camera"]});case 1:return n=e.v,z(!0),e.p=2,e.n=3,v(n.tempFilePaths);case 3:t=e.v,F([].concat((0,c.A)(B),(0,c.A)(t))),e.n=5;break;case 4:e.p=4,e.v,m().showToast({title:"\u4e0a\u4f20\u5931\u8d25",icon:"none"});case 5:return e.p=5,z(!1),e.f(5);case 6:e.n=8;break;case 7:e.p=7,a=e.v,console.error("\u9009\u62e9\u56fe\u7247\u5931\u8d25:",a);case 8:return e.a(2)}},e,null,[[2,4,5,6],[0,7]])}));return function(){return e.apply(this,arguments)}}(),_=function(e){F(B.filter(function(){return!1}))},q=function(){m().showToast({title:"\u6807\u7b7e\u529f\u80fd\u5f00\u53d1\u4e2d",icon:"none"})},G=function(e){T(y.filter(function(){return!1}))},K=function(){var e=(0,r.A)((0,s.A)().m(function e(){var t;return(0,s.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(u.trim()){e.n=1;break}return m().showToast({title:"\u8bf7\u8f93\u5165\u6807\u9898",icon:"none"}),e.a(2);case 1:if(g.trim()){e.n=2;break}return m().showToast({title:"\u8bf7\u8f93\u5165\u5185\u5bb9",icon:"none"}),e.a(2);case 2:if(N){e.n=3;break}return m().showToast({title:"\u8bf7\u9009\u62e9\u5206\u7c7b",icon:"none"}),e.a(2);case 3:return M(!0),e.p=4,e.n=5,n({title:u.trim(),content:g.trim(),category:N,tags:y,images:B});case 5:m().showToast({title:"\u53d1\u5e03\u6210\u529f",icon:"success"}),setTimeout(function(){m().navigateBack()},1500),e.n=7;break;case 6:e.p=6,t=e.v,console.error("\u53d1\u5e03\u5931\u8d25:",t);case 7:return e.p=7,M(!1),e.f(7);case 8:return e.a(2)}},e,null,[[4,6,7,8]])}));return function(){return e.apply(this,arguments)}}();return(0,S.jsxs)(l.Ss,{className:"create-topic-page",children:[(0,S.jsxs)(l.Ss,{className:"form-item",children:[(0,S.jsx)(l.pd,{className:"title-input",placeholder:"\u8f93\u5165\u6807\u9898",value:u,maxlength:100,onInput:function(e){return f(e.detail.value)}}),(0,S.jsxs)(l.Ss,{className:"char-count",children:[u.length,"/100"]})]}),(0,S.jsxs)(l.Ss,{className:"form-item",children:[(0,S.jsx)(l.Ss,{className:"label",children:"\u5206\u7c7b"}),(0,S.jsx)(l.Ss,{className:"category-list",children:R.map(function(e){return(0,S.jsx)(l.Ss,{className:"category-item ".concat(N===e.value?"active":""),onClick:function(){return j(e.value)},children:e.label},e.value)})})]}),(0,S.jsxs)(l.Ss,{className:"form-item",children:[(0,S.jsx)(l.TM,{className:"content-input",placeholder:"\u5206\u4eab\u4f60\u7684\u60f3\u6cd5...",value:g,maxlength:2e3,autoHeight:!0,onInput:function(e){return x(e.detail.value)}}),(0,S.jsxs)(l.Ss,{className:"char-count",children:[g.length,"/2000"]})]}),(0,S.jsxs)(l.Ss,{className:"form-item",children:[(0,S.jsxs)(l.Ss,{className:"label",children:["\u56fe\u7247 (",B.length,"/9)"]}),(0,S.jsxs)(l.Ss,{className:"image-list",children:[B.map(function(e,n){return(0,S.jsxs)(l.Ss,{className:"image-item",children:[(0,S.jsx)(l._V,{className:"image",src:e,mode:"aspectFill"}),(0,S.jsx)(l.Ss,{className:"remove-btn",onClick:function(){return _(n)},children:"\xd7"})]},n)}),B.length<9&&(0,S.jsx)(l.Ss,{className:"add-image-btn",onClick:V,children:O?"\u4e0a\u4f20\u4e2d...":"+"})]})]}),(0,S.jsxs)(l.Ss,{className:"form-item",children:[(0,S.jsx)(l.Ss,{className:"label",children:"\u6807\u7b7e"}),(0,S.jsxs)(l.Ss,{className:"tags-list",children:[y.map(function(e){return(0,S.jsxs)(l.Ss,{className:"tag-item",children:["#",e,(0,S.jsx)(l.Ss,{className:"remove-tag",onClick:function(){return G(e)},children:"\xd7"})]},e)}),y.length<5&&(0,S.jsx)(l.Ss,{className:"add-tag-btn",onClick:q,children:"+ \u6dfb\u52a0\u6807\u7b7e"})]})]}),(0,S.jsx)(l.Ss,{className:"submit-section",children:(0,S.jsx)(l.Ss,{className:"submit-btn ".concat(H?"disabled":""),onClick:K,children:H?"\u53d1\u5e03\u4e2d...":"\u53d1\u5e03"})})]})}var w={navigationBarTitleText:"\u53d1\u5e03\u8bdd\u9898",enablePullDownRefresh:!1};Page((0,a.createPageConfig)(x,"pages/create-topic/index",{root:{cn:[]}},w||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[907,96,76],function(){return n(9427)});e.O()}]);