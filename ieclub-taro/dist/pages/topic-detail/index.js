"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[404],{6555:function(e,n,t){var s=t(7842),a=t(3949),c=t(6784),r=t(8140),i=t(118),l=t(8833),o=t(758),u=t.n(o),m=t(9231),h=t(5006),d=t(8500),p=t(1621),f=t(9732);function x(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;return(0,f.E)({url:"/topics/".concat(e,"/comments"),method:"GET",data:{page:n,limit:t}})}function v(e){return(0,f.E)({url:"/comments",method:"POST",data:e})}function j(e){return(0,f.E)({url:"/comments/".concat(e,"/like"),method:"POST"})}function N(e){return(0,f.E)({url:"/comments/".concat(e,"/unlike"),method:"POST"})}function g(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return(0,f.E)({url:"/comments/".concat(e,"/replies"),method:"GET",data:{page:n,limit:t}})}var w=(0,p.vt)(function(e,n){return{comments:[],total:0,hasMore:!0,loading:!1,replyingTo:null,fetchComments:function(){var n=(0,c.A)((0,a.A)().m(function n(t){var s,c,r,i,l=arguments;return(0,a.A)().w(function(n){while(1)switch(n.p=n.n){case 0:return s=l.length>1&&void 0!==l[1]?l[1]:1,c=l.length>2&&void 0!==l[2]&&l[2],e({loading:!0}),n.p=1,n.n=2,x(t,s);case 2:r=n.v,e(function(e){return{comments:c?[].concat((0,d.A)(e.comments),(0,d.A)(r.comments)):r.comments,total:r.total,hasMore:r.hasMore,loading:!1}}),n.n=4;break;case 3:throw n.p=3,i=n.v,e({loading:!1}),u().showToast({title:i.message||"\u52a0\u8f7d\u5931\u8d25",icon:"none"}),i;case 4:return n.a(2)}},n,null,[[1,3]])}));function t(e){return n.apply(this,arguments)}return t}(),createComment:function(){var n=(0,c.A)((0,a.A)().m(function n(t){var s,c;return(0,a.A)().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,n.n=1,v(t);case 1:return s=n.v,t.parentId||e(function(e){return{comments:[s.comment].concat((0,d.A)(e.comments)),total:e.total+1}}),u().showToast({title:"\u8bc4\u8bba\u6210\u529f",icon:"success"}),n.a(2,s.comment);case 2:throw n.p=2,c=n.v,u().showToast({title:c.message||"\u8bc4\u8bba\u5931\u8d25",icon:"none"}),c;case 3:return n.a(2)}},n,null,[[0,2]])}));function t(e){return n.apply(this,arguments)}return t}(),likeComment:function(){var n=(0,c.A)((0,a.A)().m(function n(t){var s;return(0,a.A)().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,n.n=1,j(t);case 1:e(function(e){return{comments:e.comments.map(function(e){return e.id===t?(0,h.A)((0,h.A)({},e),{},{isLiked:!0,likesCount:e.likesCount+1}):e})}}),n.n=3;break;case 2:throw n.p=2,s=n.v,u().showToast({title:s.message||"\u64cd\u4f5c\u5931\u8d25",icon:"none"}),s;case 3:return n.a(2)}},n,null,[[0,2]])}));function t(e){return n.apply(this,arguments)}return t}(),unlikeComment:function(){var n=(0,c.A)((0,a.A)().m(function n(t){var s;return(0,a.A)().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,n.n=1,N(t);case 1:e(function(e){return{comments:e.comments.map(function(e){return e.id===t?(0,h.A)((0,h.A)({},e),{},{isLiked:!1,likesCount:Math.max(0,e.likesCount-1)}):e})}}),n.n=3;break;case 2:throw n.p=2,s=n.v,u().showToast({title:s.message||"\u64cd\u4f5c\u5931\u8d25",icon:"none"}),s;case 3:return n.a(2)}},n,null,[[0,2]])}));function t(e){return n.apply(this,arguments)}return t}(),fetchReplies:function(){var e=(0,c.A)((0,a.A)().m(function e(n){var t,s,c,r=arguments;return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return t=r.length>1&&void 0!==r[1]?r[1]:1,e.p=1,e.n=2,g(n,t);case 2:return s=e.v,e.a(2,s.comments);case 3:throw e.p=3,c=e.v,u().showToast({title:c.message||"\u52a0\u8f7d\u5931\u8d25",icon:"none"}),c;case 4:return e.a(2)}},e,null,[[1,3]])}));function n(n){return e.apply(this,arguments)}return n}(),setReplyingTo:function(n){e({replyingTo:n})},clearComments:function(){e({comments:[],total:0,hasMore:!0})}}}),k=t(4416),S=t(5349);function A(e){var n=e.comments,t=e.onReply;return 0===n.length?(0,S.jsx)(i.Ss,{className:"empty-comments",children:(0,S.jsx)(i.EY,{children:"\u6682\u65e0\u8bc4\u8bba\uff0c\u5feb\u6765\u62a2\u6c99\u53d1\u5427~"})}):(0,S.jsx)(i.Ss,{className:"comment-list",children:n.map(function(e){return(0,S.jsxs)(i.Ss,{className:"comment-item",children:[(0,S.jsx)(i._V,{className:"avatar",src:e.author.avatar,mode:"aspectFill"}),(0,S.jsxs)(i.Ss,{className:"comment-content",children:[(0,S.jsxs)(i.Ss,{className:"comment-header",children:[(0,S.jsx)(i.EY,{className:"nickname",children:e.author.nickname}),(0,S.jsx)(i.EY,{className:"time",children:(0,k.fw)(e.createdAt)})]}),(0,S.jsx)(i.EY,{className:"content",children:e.content}),e.replyTo&&(0,S.jsx)(i.Ss,{className:"reply-content",children:(0,S.jsxs)(i.EY,{className:"reply-text",children:["\u56de\u590d @",e.replyTo.author.nickname,": ",e.replyTo.content]})}),(0,S.jsxs)(i.Ss,{className:"comment-footer",children:[(0,S.jsxs)(i.Ss,{className:"like-btn",children:[(0,S.jsx)(i.EY,{className:"icon",children:"\u2764\ufe0f"}),(0,S.jsx)(i.EY,{className:"count",children:e.likesCount})]}),(0,S.jsx)(i.Ss,{className:"reply-btn",onClick:function(){return t(e)},children:(0,S.jsx)(i.EY,{children:"\u56de\u590d"})})]})]})]},e.id)})})}function E(e){var n=e.placeholder,t=void 0===n?"\u5199\u4e0b\u4f60\u7684\u8bc4\u8bba...":n,s=e.onSend,a=e.onCancel,c=(0,l.useState)(""),o=(0,r.A)(c,2),u=o[0],m=o[1],h=function(){u.trim()&&(s(u.trim()),m(""))};return(0,S.jsxs)(i.Ss,{className:"comment-input",children:[(0,S.jsx)(i.pd,{className:"input",placeholder:t,value:u,onInput:function(e){return m(e.detail.value)}}),u.trim()?(0,S.jsx)(i.Ss,{className:"send-btn",onClick:h,children:"\u53d1\u9001"}):null,a&&(0,S.jsx)(i.Ss,{className:"cancel-btn",onClick:a,children:"\u53d6\u6d88"})]})}var C=t(6330);function T(){var e=(0,o.useRouter)(),n=e.params.id,t=(0,m.e)(),s=t.currentTopic,h=t.fetchTopicDetail,d=t.likeTopic,p=t.unlikeTopic,f=w(),x=f.comments,v=f.fetchComments,j=f.createComment,N=f.replyingTo,g=f.setReplyingTo,T=(0,l.useState)(!0),b=(0,r.A)(T,2),Y=b[0],y=b[1],P=function(){var e=(0,c.A)((0,a.A)().m(function e(){var t;return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return y(!0),e.p=1,e.n=2,Promise.all([h(n),v(n)]);case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("\u52a0\u8f7d\u6570\u636e\u5931\u8d25:",t);case 4:return e.p=4,y(!1),e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])}));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)(function(){return P(),function(){g(null)}},[n,P,g]);var R=function(){var e=(0,c.A)((0,a.A)().m(function e(){var t;return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(s){e.n=1;break}return e.a(2);case 1:if(e.p=1,!s.isLiked){e.n=3;break}return e.n=2,p(n);case 2:e.n=4;break;case 3:return e.n=4,d(n);case 4:e.n=6;break;case 5:e.p=5,t=e.v,console.error("\u70b9\u8d5e\u64cd\u4f5c\u5931\u8d25:",t);case 6:return e.a(2)}},e,null,[[1,5]])}));return function(){return e.apply(this,arguments)}}(),M=function(){var e=(0,c.A)((0,a.A)().m(function e(t){var s;return(0,a.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,j({topicId:n,content:t,parentId:null===N||void 0===N?void 0:N.id});case 1:return g(null),e.n=2,v(n);case 2:e.n=4;break;case 3:e.p=3,s=e.v,console.error("\u53d1\u9001\u8bc4\u8bba\u5931\u8d25:",s);case 4:return e.a(2)}},e,null,[[0,3]])}));return function(n){return e.apply(this,arguments)}}(),I=function(e){null!==s&&void 0!==s&&s.images&&u().previewImage({urls:s.images,current:s.images[e]})};return Y?(0,S.jsx)(C.A,{}):s?(0,S.jsxs)(i.Ss,{className:"topic-detail-page",children:[(0,S.jsxs)(i.BM,{className:"detail-scroll",scrollY:!0,children:[(0,S.jsxs)(i.Ss,{className:"author-section",children:[(0,S.jsx)(i._V,{className:"avatar",src:s.author.avatar,mode:"aspectFill"}),(0,S.jsxs)(i.Ss,{className:"author-info",children:[(0,S.jsx)(i.EY,{className:"nickname",children:s.author.nickname}),(0,S.jsx)(i.EY,{className:"time",children:(0,k.fw)(s.createdAt)})]})]}),(0,S.jsx)(i.Ss,{className:"title-section",children:(0,S.jsx)(i.EY,{className:"title",children:s.title})}),(0,S.jsx)(i.Ss,{className:"content-section",children:(0,S.jsx)(i.EY,{className:"content",children:s.content})}),s.images&&s.images.length>0&&(0,S.jsx)(i.Ss,{className:"images-section",children:s.images.map(function(e,n){return(0,S.jsx)(i._V,{className:"image-item",src:e,mode:"aspectFill",onClick:function(){return I(n)}},n)})}),s.tags&&s.tags.length>0&&(0,S.jsx)(i.Ss,{className:"tags-section",children:s.tags.map(function(e){return(0,S.jsxs)(i.Ss,{className:"tag",children:["#",e]},e)})}),(0,S.jsxs)(i.Ss,{className:"stats-section",children:[(0,S.jsxs)(i.Ss,{className:"stat-item",children:[(0,S.jsx)(i.EY,{className:"stat-value",children:s.viewsCount}),(0,S.jsx)(i.EY,{className:"stat-label",children:"\u6d4f\u89c8"})]}),(0,S.jsxs)(i.Ss,{className:"stat-item",children:[(0,S.jsx)(i.EY,{className:"stat-value",children:s.likesCount}),(0,S.jsx)(i.EY,{className:"stat-label",children:"\u70b9\u8d5e"})]}),(0,S.jsxs)(i.Ss,{className:"stat-item",children:[(0,S.jsx)(i.EY,{className:"stat-value",children:s.commentsCount}),(0,S.jsx)(i.EY,{className:"stat-label",children:"\u8bc4\u8bba"})]})]}),(0,S.jsxs)(i.Ss,{className:"comments-section",children:[(0,S.jsx)(i.Ss,{className:"comments-header",children:(0,S.jsxs)(i.EY,{className:"comments-title",children:["\u8bc4\u8bba ",s.commentsCount]})}),(0,S.jsx)(A,{comments:x,onReply:g})]})]}),(0,S.jsxs)(i.Ss,{className:"bottom-bar",children:[(0,S.jsx)(E,{placeholder:N?"\u56de\u590d @".concat(N.author.nickname):"\u5199\u4e0b\u4f60\u7684\u8bc4\u8bba...",onSend:M,onCancel:function(){return g(null)}}),(0,S.jsx)(i.Ss,{className:"action-btns",children:(0,S.jsxs)(i.Ss,{className:"action-btn ".concat(s.isLiked?"liked":""),onClick:R,children:[(0,S.jsx)(i.EY,{className:"icon",children:"\u2764\ufe0f"}),(0,S.jsx)(i.EY,{className:"label",children:s.likesCount})]})})]})]}):(0,S.jsx)(i.Ss,{className:"error-state",children:(0,S.jsx)(i.EY,{children:"\u8bdd\u9898\u4e0d\u5b58\u5728"})})}var b={navigationBarTitleText:"\u8bdd\u9898\u8be6\u60c5",enablePullDownRefresh:!1};Page((0,s.createPageConfig)(T,"pages/topic-detail/index",{root:{cn:[]}},b||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[907,96,76],function(){return n(6555)});e.O()}]);