"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[559],{"1559":function(e,a,s){s.r(a),s.d(a,{"default":function(){return TopicsPage}});var n=s(9379),l=s(1212),r=s(467),c=s(296),t=s(3707),i=s(6540),o=s(3699),u=s(2449),h=s(9501),d=s(4848);function TopicCard(e){var a=e.topic,s=e.onClick;return(0,d.jsxs)(t.Ss,{"className":"topic-card","onClick":s,"children":[(0,d.jsxs)(t.Ss,{"className":"card-header","children":[(0,d.jsx)(t._V,{"className":"avatar","src":a.author.avatar,"mode":"aspectFill"}),(0,d.jsxs)(t.Ss,{"className":"author-info","children":[(0,d.jsx)(t.EY,{"className":"nickname","children":a.author.nickname}),(0,d.jsx)(t.EY,{"className":"time","children":(0,h.fw)(a.createdAt)})]})]}),(0,d.jsxs)(t.Ss,{"className":"card-content","children":[(0,d.jsx)(t.EY,{"className":"title","children":a.title}),(0,d.jsx)(t.EY,{"className":"content","children":a.content})]}),a.images&&a.images.length>0&&(0,d.jsx)(t.Ss,{"className":"card-images","children":a.images.slice(0,3).map(function(e,a){return(0,d.jsx)(t._V,{"className":"image-item","src":e,"mode":"aspectFill"},a)})}),a.tags&&a.tags.length>0&&(0,d.jsx)(t.Ss,{"className":"card-tags","children":a.tags.slice(0,3).map(function(e){return(0,d.jsxs)(t.Ss,{"className":"tag","children":["#",e]},e)})}),(0,d.jsxs)(t.Ss,{"className":"card-footer","children":[(0,d.jsxs)(t.Ss,{"className":"stat-item","children":[(0,d.jsx)(t.EY,{"className":"icon","children":"👁"}),(0,d.jsx)(t.EY,{"className":"value","children":a.viewsCount})]}),(0,d.jsxs)(t.Ss,{"className":"stat-item","children":[(0,d.jsx)(t.EY,{"className":"icon","children":"❤️"}),(0,d.jsx)(t.EY,{"className":"value","children":a.likesCount})]}),(0,d.jsxs)(t.Ss,{"className":"stat-item","children":[(0,d.jsx)(t.EY,{"className":"icon","children":"💬"}),(0,d.jsx)(t.EY,{"className":"value","children":a.commentsCount})]})]})]})}function TopicFilters(e){e.filters;var a=e.onChange,s=[{"label":"最新","value":"latest"},{"label":"最热","value":"hot"},{"label":"精华","value":"featured"}],n=[{"label":"全部","value":""},{"label":"技术","value":"tech"},{"label":"科学","value":"science"},{"label":"生活","value":"life"},{"label":"学习","value":"study"},{"label":"其他","value":"other"}],l=(0,i.useState)(0),r=(0,c.A)(l,2),o=r[0],u=r[1],h=(0,i.useState)(0),m=(0,c.A)(h,2),f=m[0],p=m[1];return(0,d.jsxs)(t.Ss,{"className":"topic-filters","children":[(0,d.jsx)(t.LC,{"mode":"selector","range":s.map(function(e){return e.label}),"value":o,"onChange":function handleSortChange(e){var n=e.detail.value;u(n),a({"sortBy":s[n].value})},"children":(0,d.jsxs)(t.Ss,{"className":"filter-item","children":[(0,d.jsx)(t.Ss,{"className":"filter-label","children":s[o].label}),(0,d.jsx)(t.Ss,{"className":"filter-arrow","children":"▼"})]})}),(0,d.jsx)(t.LC,{"mode":"selector","range":n.map(function(e){return e.label}),"value":f,"onChange":function handleCategoryChange(e){var s=e.detail.value;p(s),a({"category":n[s].value||void 0})},"children":(0,d.jsxs)(t.Ss,{"className":"filter-item","children":[(0,d.jsx)(t.Ss,{"className":"filter-label","children":n[f].label}),(0,d.jsx)(t.Ss,{"className":"filter-arrow","children":"▼"})]})})]})}var m=s(4398),f=s(143);function TopicsPage(){var e=(0,u.e)(),a=e.topics,s=e.hasMore,h=e.loading,p=e.filters,x=e.fetchTopics,g=e.setFilters,j=e.clearTopics,v=(0,i.useState)(!1),N=(0,c.A)(v,2),S=N[0],A=N[1];(0,i.useEffect)(function(){var e=function(){var e=(0,r.A)((0,l.A)().m(function _callee(){var e;return(0,l.A)().w(function(a){for(;;)switch(a.p=a.n){case 0:return a.p=0,a.n=1,x({"page":1});case 1:a.n=3;break;case 2:a.p=2,e=a.v,console.error("加载话题失败:",e);case 3:return a.a(2)}},_callee,null,[[0,2]])}));return function loadTopics(){return e.apply(this,arguments)}}();return e(),function(){j()}},[x,j]);var b=function(){var e=(0,r.A)((0,l.A)().m(function _callee2(){return(0,l.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return A(!0),e.p=1,e.n=2,x({"page":1});case 2:return e.p=2,A(!1),e.f(2);case 3:return e.a(2)}},_callee2,null,[[1,,2,3]])}));return function onRefresh(){return e.apply(this,arguments)}}(),C=function(){var e=(0,r.A)((0,l.A)().m(function _callee3(){var e;return(0,l.A)().w(function(a){for(;;)switch(a.p=a.n){case 0:if(s&&!h){a.n=1;break}return a.a(2);case 1:return a.p=1,a.n=2,x({"page":p.page+1},!0);case 2:a.n=4;break;case 3:a.p=3,e=a.v,console.error("加载更多失败:",e);case 4:return a.a(2)}},_callee3,null,[[1,3]])}));return function onLoadMore(){return e.apply(this,arguments)}}(),T=function(){var e=(0,r.A)((0,l.A)().m(function _callee4(e){return(0,l.A)().w(function(a){for(;;)switch(a.n){case 0:return g((0,n.A)((0,n.A)({},e),{},{"page":1})),a.n=1,x((0,n.A)((0,n.A)({},e),{},{"page":1}));case 1:return a.a(2)}},_callee4)}));return function onFilterChange(a){return e.apply(this,arguments)}}(),w=function goToCreate(){o.Ay.navigateTo({"url":"/pages/create-topic/index"})};return(0,d.jsxs)(t.Ss,{"className":"topics-page","children":[(0,d.jsx)(TopicFilters,{"filters":p,"onChange":T}),(0,d.jsx)(t.BM,{"className":"topics-scroll","scrollY":!0,"refresherEnabled":!0,"refresherTriggered":S,"onRefresherRefresh":b,"onScrollToLower":C,"lowerThreshold":100,"children":h&&0===a.length?(0,d.jsx)(f.A,{}):0===a.length?(0,d.jsx)(m.A,{"title":"暂无话题","description":"快来发布第一个话题吧","actionText":"发布话题","onAction":w}):(0,d.jsxs)(t.Ss,{"className":"topics-list","children":[a.map(function(e){return(0,d.jsx)(TopicCard,{"topic":e,"onClick":function onClick(){return function goToDetail(e){o.Ay.navigateTo({"url":"/pages/topic-detail/index?id=".concat(e)})}(e.id)}},e.id)}),s&&(0,d.jsx)(t.Ss,{"className":"load-more","children":h?"加载中...":"上拉加载更多"}),!s&&a.length>0&&(0,d.jsx)(t.Ss,{"className":"no-more","children":"没有更多了"})]})}),(0,d.jsx)(t.Ss,{"className":"create-btn","onClick":w,"children":(0,d.jsx)(t.Ss,{"className":"create-icon","children":"+"})})]})}}}]);